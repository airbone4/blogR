<!DOCTYPE html>
<html><head>
  <title>7.9 ç‰©ä»¶å°å‘S3</title>  
      
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href='/blogR/images/favicon.ico'/>
      
    <link rel="stylesheet" href="/blogR/css/atom-one-dark-reasonable.css">
    
    <link href="/blogR/css/syntax.css?1641445339" rel="stylesheet">
    <script src="/blogR/js/jquery-3.3.1.min.js?1641445339"></script>
    <link href='/blogR/css/bootstrap.min.css' rel="stylesheet" crossorigin="anonymous">
    <script src='/blogR/js/bootstrap.bundle.min.js' crossorigin="anonymous"></script>
    
    <script src='/blogR/js/datatables.min.js'></script>    
    <link href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css" rel="stylesheet">    
    
    <link href="/blogR/css/fontawesome-all.min.css?1641445339" rel="stylesheet">
    
    <link href="/blogR/css/theme-mine.css?1641445339" rel="stylesheet">
    
    <link href="/blogR/css/theme.css?1641445339" rel="stylesheet">
    
    
    <link rel="stylesheet" href="https://airbone4.github.io/blogR/scss/notice.7158afc7a24ea3d0073077b3699dbfad7f3df2be8d4e19956e934587413013ee.css" integrity="sha256-cVivx6JOo9AHMHezaZ2/rX898r6NThmVbpNFh0EwE&#43;4=">
    <script src='/blogR/js/class.js'></script>    
    
  </head><body><div id="top-pane" class="navbar  fixed-top ">
  <div class="container-fluid">
  <span >
    <a  href='/blogR/' class="fs-5 accessory"><i class="fas fa-home"></i>R in Class</a>
    <span id="sidebar-toggle-span" class="fs-5"><i class="fas fa-align-justify"></i></span>
  </span><span >
      <span id="toc-menu">
    <label><i class="fas fa-list-alt" ></i> </label>    
<div id="variant-toc-content" >
    <div class="wrapper">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#oop">OOP</a>
      <ul>
        <li><a href="#base-objects-vs-oo-objects">Base objects vs OO objects</a></li>
        <li><a href="#è®Šæ•¸å±¬æ€§æŸ¥è©¢å‡½æ•¸">è®Šæ•¸å±¬æ€§æŸ¥è©¢å‡½æ•¸</a></li>
      </ul>
    </li>
    <li><a href="#s3">S3</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
      </ul>
    </li>
    <li><a href="#basics">Basics</a></li>
    <li><a href="#classes">Classes</a>
      <ul>
        <li><a href="#constructors">Constructors</a></li>
      </ul>
    </li>
    <li><a href="#generics-and-methods">Generics and methods</a>
      <ul>
        <li><a href="#coercion">Coercion</a></li>
        <li><a href="#s3-arguments">Arguments</a></li>
      </ul>
    </li>
    <li><a href="#method-dispatch">Method dispatch</a>
      <ul>
        <li><a href="#usemethod"><code>UseMethod()</code></a></li>
        <li><a href="#nextmethod"><code>NextMethod()</code></a></li>
      </ul>
    </li>
    <li><a href="#inheritance">Inheritance</a>
      <ul>
        <li><a href="#constructors-1">Constructors</a></li>
        <li><a href="#coercion-1">Coercion</a></li>
        <li><a href="#methods">Methods</a></li>
      </ul>
    </li>
    <li><a href="#dispatch-details">Dispatch details</a>
      <ul>
        <li><a href="#environments-and-namespaces">Environments and namespaces</a></li>
        <li><a href="#s3-and-base-types">S3 and base types</a></li>
        <li><a href="#internal-generics">Internal generics</a></li>
        <li><a href="#group-generics">Group generics</a></li>
        <li><a href="#double-dispatch">Double dispatch</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    <hr class="p-0 m-0" />
    <div class="toa"></div>
</div>
</span>
<span class="fs-5 accessory" data-bs-toggle="tooltip" data-bs-placement="bottom" 
      title='æœ€å¾Œä¿®æ”¹October 31, 2021'>7.9 ç‰©ä»¶å°å‘S3</span>
        
    

    </span>
  
  <span></span><span >
    <span >
    <label for="search-query" id="search-button"><i class="fas fa-search"></i></label>
    <input id="search-query" type="search" placeholder="æœå°‹" autocomplete="off">
</span>    
 
<div id="search-pane">
 <ol id="search-results"></ul>
</div>

    </span>
</div> 
</div>


<div id="content-wrapper"><nav id="sidebar">
  
    <ul class="nav flex-column topics" id="home-topics">
      
        
          
          


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="åŸºç¤R">
     

  <a class="nav-link" 
    href="/blogR/rlang.html"><i class="far fa-folder"></i>åŸºç¤R  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_92db98bffe2d6697b3536cbbf7b00074" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_92db98bffe2d6697b3536cbbf7b00074"  
  class="submenu collapse show" 
  data-bs-parent="#home-topics">

    
  
  
   
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_0_requirement.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1 Requirement</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_1_%E7%B3%BB%E7%B5%B1.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1 é‹ä½œç’°å¢ƒ</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_2_filesystem.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2 æª”æ¡ˆç³»çµ±</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_3_%E5%9F%B7%E8%A1%8C.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3 åŸ·è¡Œ</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_4_rpackages.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4 R Package</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_5_%E7%B7%A8%E7%A2%BC.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5 ç·¨ç¢¼</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_0_%E8%BC%B8%E5%87%BA%E8%BC%B8%E5%85%A5.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0 åŸºæœ¬è¼¸å‡ºè¼¸å…¥</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_1_%E8%AE%80%E6%AA%94%E5%AF%AB%E6%AA%94.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1 è®€æª”å¯«æª”</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_2_data_explorer.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2 è³‡æ–™æ¢ç´¢</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_3_data_explorer.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3 è³‡æ–™æ¢ç´¢</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/3_quickview1.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3. Quick view 1</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_1_1_type_%E5%9F%BA%E6%9C%AC.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1 åŸºæœ¬</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_1_2_type%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1.2 ç·´ç¿’</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_2_type_vector.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.2 å‘é‡</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_3_type_matrix.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.3 çŸ©é™£</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_4_type_list.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.4 ä¸²åˆ— list</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_5_type_string_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.5 å­—ä¸²è™•ç†å‡½æ•¸</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_6_type_dataframe.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.6 è³‡æ–™é›† data frame</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_7_type_factor.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.7 å› å­</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_11_%E6%AD%A3%E8%A6%8F%E8%A1%A8%E9%81%94%E8%AA%9E%E6%B3%95.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.11 æ­£è¦è¡¨é”èªæ³•</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_15_json.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.15 json</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/6_1_programming.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">6.1 Programming basic</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/6_3_apply_family.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">6.3 function - apply family</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_1_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.1 R å‡½æ•¸çš„åŸºæœ¬æ’°å¯«</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_2_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.2 Rå‡½æ•¸é€²éš</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_3_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.3 R å‡½æ•¸å®šç¾©çš„å¹¾ç¨®åˆ†é¡</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_8_objectbasic.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.8 Rçš„ç‰©ä»¶ç›¸é—œæ¦‚å¿µ</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_9_%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91s3.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.9 ç‰©ä»¶å°å‘S3</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/9_1_plot.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">9.1 åŸºæœ¬ç¹ªåœ–</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/9_2_%E5%A4%9A%E5%9C%96%E7%96%8A%E5%9C%96.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">9.2 å¤šåœ–ç–Šåœ–</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/9_3_plot.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">9.3 ç•«åœ–ç·´ç¿’</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/10_00_dplyrbasic01.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">10. tidyr, dplyr basic</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/11_00_sampling.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">11. sampling</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/11_environments.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">11 Environments</a></li>
     
   
     
   
     
   
        <li>


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="æš«æ™‚">
     

  <a class="nav-link" 
    href="/blogR/rlang/demo.html"><i class="far fa-folder"></i>æš«æ™‚  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f03d3d24b564dd9c39af6eb86300021f" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_f03d3d24b564dd9c39af6eb86300021f"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_92db98bffe2d6697b3536cbbf7b00074">

    
  
  
   
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/demo/citation.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">å¼•ç”¨</a></li>
    </ul>
</li>
     
  
</li>
     
   
        <li>


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="ç·´ç¿’ç”¨">
     

  <a class="nav-link" 
    href="/blogR/rlang/hw.html"><i class="far fa-folder"></i>ç·´ç¿’ç”¨  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_b4809f6375b9dda8660e4938c2644e82" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_b4809f6375b9dda8660e4938c2644e82"  
  class="submenu collapse show" 
  data-bs-parent="#menu_item_92db98bffe2d6697b3536cbbf7b00074">

    
  
  
   
    
        <li class="nav-item active"><a class="nav-link" href="/blogR/rlang/hw/hw_basic.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">assignment-1</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/hw/hw_regexp.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">regexpr</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/hw/hw_filesystem.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">æª”æ¡ˆç³»çµ±</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/hw/dataset_class.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">è³‡æ–™é›†</a></li>
    </ul>
</li>
     
  
</li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/resources.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">ç·´ç¿’ç›¸é—œæª”æ¡ˆ</a></li>
    </ul>
</li>
     
  

        
          
          


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="åŸºç¤è¨ˆé‡">
     

  <a class="nav-link" 
    href="/blogR/econometrics.html"><i class="far fa-folder"></i>åŸºç¤è¨ˆé‡  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_c59a6b16a979dae063e00e4a916e3284" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_c59a6b16a979dae063e00e4a916e3284"  
  class="submenu collapse" 
  data-bs-parent="#home-topics">

    
  
  
   
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/0_prerequest.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0 å‰ç½®æº–å‚™</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/1_t%E6%AA%A2%E5%AE%9A.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0 tæª¢å®š</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/2_anova.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2. ANOVA</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/a_a_%E8%B3%87%E6%96%99%E8%99%95%E7%90%86.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">A.a è³‡æ–™è™•ç†</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/a_b_mpg%E7%82%BA%E4%BE%8B%E7%9A%84ggplot.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">A.b mpgç‚ºä¾‹çš„ggplot</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/lmm.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">lmm</a></li>
     
   
    </ul>
</li>
     
  

        
          
          


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="å°ˆé¡Œ">
     

  <a class="nav-link" 
    href="/blogR/topic.html"><i class="far fa-folder"></i>å°ˆé¡Œ  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f7b6d4231ab239a316b7f2d9edf32817" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_f7b6d4231ab239a316b7f2d9edf32817"  
  class="submenu collapse" 
  data-bs-parent="#home-topics">

    
  
  
   
   
     
   
        <li>


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="å¯¦é©—">
     

  <a class="nav-link" 
    href="/blogR/topic/simulation.html"><i class="far fa-folder"></i>å¯¦é©—  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_e617bdc52da54290f99855ac9d5037aa" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_e617bdc52da54290f99855ac9d5037aa"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_f7b6d4231ab239a316b7f2d9edf32817">

    
  
  
   
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/shinyapps/tutorial/01_hello/readme.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title=""></a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/01_shiny_basic.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">01_shiny_basic</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/navarpage.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2. navarPage</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/2_1_%E9%9A%A8%E6%A9%9F%E8%AE%8A%E6%95%B8.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1 éš¨æ©Ÿè®Šæ•¸</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/2_1_%E4%BA%82%E6%95%B8%E5%87%BD%E6%95%B8%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.1 äº‚æ•¸å‡½æ•¸ç·´ç¿’</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/3_shinydist.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3. shinyDist</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/4_01_sim.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1 æ¨¡æ“¬åŸºæœ¬ 1</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/4_02_sim.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.2 æ¨¡æ“¬åŸºæœ¬ 2</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/50_2_%E8%A7%A3%E7%AD%94.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">50_1_è§£ç­”</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/50_1_%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">50.1 ç·´ç¿’</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/mc_%E5%9F%BA%E6%9C%AC.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">MC_åŸºæœ¬</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/poisson%E5%88%86%E9%85%8D.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">Poissonåˆ†é…</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/shinyapps/tutorial/tagsdemo/readme.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">Readme</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/sinytest.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">sinytest</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/central.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">ä¸­å¤®</a></li>
    </ul>
</li>
     
  
</li>
     
   
    </ul>
</li>
     
  

          
        
  </ul> 
    
    <hr/>
    <section id="footer">
      æœ€è¿‘3ç¯‡<br/><ul><li><a href="https://airbone4.github.io/blogR/topic/simulation/50_3_%E5%8D%8A%E6%88%90%E5%93%81.html"> <i class="far fa-clock" ></i>50_2_åŠæˆå“[2022-01-06 PM 01:01]</a></li><li><a href="https://airbone4.github.io/blogR/topic/simulation/50_2_%E8%A7%A3%E7%AD%94.html"> <i class="far fa-clock" ></i>50_1_è§£ç­”[2022-01-06 PM 12:23]</a></li><li><a href="https://airbone4.github.io/blogR/topic/simulation/50_1_%E7%B7%B4%E7%BF%92.html"> <i class="far fa-clock" ></i>50.1 ç·´ç¿’[2022-01-05 PM 10:45]</a></li></ul>
    </section>
  
</nav><article class="article mx-2 mt-3" id="body-inner">
    <h2 id="oop">OOP</h2>
<p><a href="https://adv-r.hadley.nz/base-types.html">advance R</a>
<a href="https://www.r-bloggers.com/2019/05/simple-yet-elegant-object-oriented-programming-in-r-with-s3/">S3 generic method</a></p>
<h3 id="base-objects-vs-oo-objects">Base objects vs OO objects</h3>
<p>è¾¨åˆ¥è®Šæ•¸æ˜¯åŸºç¤å‹åˆ¥æˆ–æ˜¯ç‰©ä»¶å‹åˆ¥ï¼Œå¯ä»¥ç°¡å–®åˆ©ç”¨å‡½æ•¸ï¼š <code>is.object()</code>:</p>
<p>åŸºç¤ç‰©ä»¶base object:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">is.object(1:10)
#&gt; [1] FALSE
</code></pre>
<p>[1] FALSE</p>
<p>ç‰©ä»¶å°å‘ç‰©ä»¶ OO object</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">is.object(mtcars)
#&gt; [1] TRUE
</code></pre>
<p>[1] TRUE</p>
<p>ä¸»è¦çš„å€åˆ¥åœ¨æ–¼åŸºæœ¬ç‰©ä»¶æ²’æœ‰class é€™å€‹attribute</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">attr(1:10, &quot;class&quot;) #  NULL
#&gt; NULL
attr(mtcars, &quot;class&quot;) # [1] &quot;data.frame&quot;
#&gt; [1] &quot;data.frame&quot;
</code></pre>
<p>class()é€™å€‹å‡½æ•¸,ä¸è¦‹å¾—ç¸½æ˜¯æœƒå’Œattr()çš„çµæœä¸€è‡´,å› ç‚ºï¼Œå°åŸºæœ¬ç‰©ä»¶è€Œè¨€,å‚³å›çš„æ˜¯å¾Œé¢è¨è«–,è€Œä¸æ˜¯ NULLã€‚</p>
<h3 id="è®Šæ•¸å±¬æ€§æŸ¥è©¢å‡½æ•¸">è®Šæ•¸å±¬æ€§æŸ¥è©¢å‡½æ•¸</h3>
<ul>
<li>names()</li>
<li>dimnames()</li>
<li>length()</li>
<li>dim(): å„ç¶­åº¦é•·åº¦</li>
<li>class() : è®Šæ•¸é¡åˆ¥</li>
<li>table()ï¼šå„é¡è³‡æ–™è¨ˆæ•¸</li>
<li>str()ï¼šè®Šæ•¸çš„è³‡æ–™çµæ§‹(å…¶å¯¦æ˜¯ä¸€å€‹list)</li>
</ul>
<p>é€énames()å‡½æ•¸ï¼Œå¯å–å¾—å„ç¨®listå…ƒç´ çš„åç¨±,ä½†æ˜¯å¦‚æœæ˜¯data.frameå‰‡æ˜¯é¡¯ç¤ºæ¬„ä½åç¨±
islandsæ˜¯å…§å»ºè³‡æ–™</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">str(islands)
#&gt;  Named num [1:48] 11506 5500 16988 2968 16 ...
#&gt;  - attr(*, &quot;names&quot;)= chr [1:48] &quot;Africa&quot; &quot;Antarctica&quot; &quot;Asia&quot; &quot;Australia&quot; ...
</code></pre>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">head(names(islands)) 
#&gt; [1] &quot;Africa&quot;       &quot;Antarctica&quot;   &quot;Asia&quot;         &quot;Australia&quot;    &quot;Axel Heiberg&quot;
#&gt; [6] &quot;Baffin&quot;
</code></pre>
<p>æ–¹å½¢è³‡æ–™ï¼ˆä¾‹å¦‚ï¼ŒçŸ©é™£ï¼Œtable, data.frame)ï¼Œå¯ä»¥é€édimnames()å‡½æ•¸å¯é¡¯ç¤ºdata.frame æ©«è¡Œå’Œç›´è¡Œçš„åç¨± å…ˆæ©«è¡Œï¼Œç„¶å¾Œç›´è¡Œã€‚</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">dimnames(USArrests) 
#&gt; [[1]]
#&gt;  [1] &quot;Alabama&quot;        &quot;Alaska&quot;         &quot;Arizona&quot;        &quot;Arkansas&quot;      
#&gt;  [5] &quot;California&quot;     &quot;Colorado&quot;       &quot;Connecticut&quot;    &quot;Delaware&quot;      
#&gt;  [9] &quot;Florida&quot;        &quot;Georgia&quot;        &quot;Hawaii&quot;         &quot;Idaho&quot;         
#&gt; [13] &quot;Illinois&quot;       &quot;Indiana&quot;        &quot;Iowa&quot;           &quot;Kansas&quot;        
#&gt; [17] &quot;Kentucky&quot;       &quot;Louisiana&quot;      &quot;Maine&quot;          &quot;Maryland&quot;      
#&gt; [21] &quot;Massachusetts&quot;  &quot;Michigan&quot;       &quot;Minnesota&quot;      &quot;Mississippi&quot;   
#&gt; [25] &quot;Missouri&quot;       &quot;Montana&quot;        &quot;Nebraska&quot;       &quot;Nevada&quot;        
#&gt; [29] &quot;New Hampshire&quot;  &quot;New Jersey&quot;     &quot;New Mexico&quot;     &quot;New York&quot;      
#&gt; [33] &quot;North Carolina&quot; &quot;North Dakota&quot;   &quot;Ohio&quot;           &quot;Oklahoma&quot;      
#&gt; [37] &quot;Oregon&quot;         &quot;Pennsylvania&quot;   &quot;Rhode Island&quot;   &quot;South Carolina&quot;
#&gt; [41] &quot;South Dakota&quot;   &quot;Tennessee&quot;      &quot;Texas&quot;          &quot;Utah&quot;          
#&gt; [45] &quot;Vermont&quot;        &quot;Virginia&quot;       &quot;Washington&quot;     &quot;West Virginia&quot; 
#&gt; [49] &quot;Wisconsin&quot;      &quot;Wyoming&quot;       
#&gt; 
#&gt; [[2]]
#&gt; [1] &quot;Murder&quot;   &quot;Assault&quot;  &quot;UrbanPop&quot; &quot;Rape&quot;
</code></pre>
<p>æ–¹å½¢è³‡æ–™ï¼Œå¯ä»¥é€élength()å‡½æ•¸å¯é¡¯ç¤ºè³‡æ–™é•·åº¦ï¼Œä½†æ˜¯å¦‚æœæ˜¯data.frameå‰‡é¡¯ç¤ºæ¬„ä½æ•¸ã€‚</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">length(islands) 
#&gt; [1] 48
</code></pre>
<p>é€édim() é¡¯ç¤ºæ–¹å½¢è³‡æ–™çš„ã€Œè³‡æ–™ç­†æ•¸ã€å’Œã€Œæ¬„ä½æ•¸ç›®ã€ï¼Œå…ˆã€Œæ©«è¡Œã€ï¼Œå¾Œã€Œç›´è¡Œã€</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">dim(USArrests) 
#&gt; [1] 50  4
</code></pre>
<p>ä½¿ç”¨class()å‡½æ•¸å¯çŸ¥é“è®Šæ•¸é¡åˆ¥</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">class(pi)
#&gt; [1] &quot;numeric&quot;
class(Sys.Date())
#&gt; [1] &quot;Date&quot;
</code></pre>
<p>ä½¿ç”¨table()å‡½æ•¸å¯çŸ¥é“å‘é‡ä¸­æ¯å€‹å€¼å‡ºç¾å¹¾æ¬¡</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">
table(iris$Species) ##çµ±è¨ˆçµæœ
#&gt; 
#&gt;     setosa versicolor  virginica 
#&gt;         50         50         50
</code></pre>
<h2 id="s3">S3</h2>
<h3 id="prerequisites">Prerequisites</h3>
<p>We'll use the sloop package to fill in some missing pieces when it comes to S3.</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5"># install_github(&quot;hadley/sloop&quot;)
library(sloop)
</code></pre>
<h2 id="basics">Basics</h2>
<p>åŸºæœ¬ä¸Šæ˜¯çµæ§‹çš„ä¸€ç¨®å”å®šã€‚æˆ‘çš„æ„æ€é€™å€‹ç‰©ä»¶æ˜¯åŸºæ–¼çµæ§‹è€Œè¦å®šï¼Œæ˜¯èªæ„ä¸Šçš„å…§è¦è€Œä¸æ˜¯èªæ³•ä¸Šçš„è¦å®šã€‚
ä¾‹å¦‚ï¼Œæ‰€è¬‚çš„é¡åˆ¥ï¼Œåªä¸éæ˜¯çµæ§‹ä¸Šçš„ä¸€å€‹å…¶ä¸­ä¸€å€‹æ¬„ä½ï¼Œè€Œé€™å€‹æ¬„ä½åç¨±ç‚º<code>class</code></p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">f &lt;- factor(&quot;a&quot;)

typeof(f)
#&gt; [1] &quot;integer&quot;
attributes(f)
#&gt; $levels
#&gt; [1] &quot;a&quot;
#&gt; 
#&gt; $class
#&gt; [1] &quot;factor&quot;
</code></pre>
<p>é…åˆé€šç”¨å‡½æ•¸<code>generic function</code>çš„è§€å¿µ(ä¾‹å¦‚å¸¸è¦‹çš„<code>print()</code>)ï¼Œè€Œé”åˆ°ï¼¯ï¼¯ï¼°çš„ç›®çš„ã€‚</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">print(f)
#&gt; [1] a
#&gt; Levels: a
class(unclass(f))
#&gt; [1] &quot;integer&quot;
print(unclass(f))ã€€#<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="ğŸ‘unclassæœƒå»æ‰å±¬æ€§&lt;code&gt;class&lt;/code&gt;">ğŸ·</span><!--/html_preserve-->
#&gt; [1] 1
#&gt; attr(,&quot;levels&quot;)
#&gt; [1] &quot;a&quot;
</code></pre>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">time &lt;- strptime(&quot;2017-01-01&quot;, &quot;%Y-%m-%d&quot;)
str(time)
#&gt;  POSIXlt[1:1], format: &quot;2017-01-01&quot;
str(unclass(time), list.len = 5)
#&gt; List of 11
#&gt;  $ sec   : num 0
#&gt;  $ min   : int 0
#&gt;  $ hour  : int 0
#&gt;  $ mday  : int 1
#&gt;  $ mon   : int 0
#&gt;   [list output truncated]
</code></pre>
<p>A <strong>generic</strong> and its <strong>methods</strong> are functions that operate on classes. The role of a generic is to find the right method for the arguments that it is provided, the process of <strong>method dispatch</strong>.  A method is a function that implements the generic behaviour for a specific class. In other words the job of the generic is to find the right method; the job of the method is to do the work.</p>
<p>You can find some S3 methods (those in the base package and those that you've created) by typing their names. However, this will not work with most packages because S3 methods are not exported: they live only inside the package, and are not available from the global environment. Instead, you can use <code>getS3method()</code>, which will work regardless of where the method lives:</p>
<p>S3 methods æ˜¯æˆ‘å€‘å®šç¾©äº†ä¸€å€‹é€šç”¨åç¨±ï¼Œç„¶å¾Œç¶“ç”±é€™å€‹é€šç”¨åç¨±ï¼Œæ‰¾åˆ°ç‰¹å®šå‡½æ•¸<code>é€šç”¨.é¡åˆ¥()</code>ï¼Œä¾‹å¦‚ ç•¶æˆ‘è¦è¨ˆç®—æ—¥æœŸçš„å¹³å‡ï¼Œæˆ‘æŠŠä¸€å€‹æ—¥æœŸè®Šæ•¸å‚³åˆ°å‡½æ•¸<code>mean()</code>ï¼Œé€šç”¨å‡½æ•¸mean()åˆå‘¼å«äº† <code>mean.Date()</code>ï¼ˆå› ç‚ºæ—¥æœŸè®Šæ•¸çš„é¡åˆ¥æ˜¯<code>Date</code>ï¼‰, åˆä¾‹å¦‚<code>factor</code>è®Šæ•¸ï¼Œè¦åˆ—å°çš„æ™‚å€™æˆ‘å€‘æœƒæ‰“<code>print(factor var)</code> æ­¤æ™‚<code>print()</code>åˆæœƒå‘¼å« <code>print.factor()</code>.</p>
<pre><code class="language-r?preclass=.ms-5.w-75">
mean.Date  #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="ğŸ‘">ğŸ·</span><!--/html_preserve-->
#&gt; function (x, ...) 
#&gt; .Date(mean(unclass(x), ...))
#&gt; &lt;bytecode: 0x0000000017c30d30=&quot;&quot;&gt;
#&gt; &lt;environment: namespace:base=&quot;&quot;&gt;

# Always works
getS3method(&quot;mean&quot;, &quot;Date&quot;)
#&gt; function (x, ...) 
#&gt; .Date(mean(unclass(x), ...))
#&gt; &lt;bytecode: 0x0000000017c30d30=&quot;&quot;&gt;
#&gt; &lt;environment: namespace:base=&quot;&quot;&gt;
&lt;/environment:&gt;&lt;/bytecode:&gt;&lt;/environment:&gt;&lt;/bytecode:&gt;
</code></pre>
<p>note: é™¤äº†è‡ªå·±å®šç¾©çš„å‡½æ•¸å’Œåœ¨<code>base</code>å¥—ä»¶çš„å‡½æ•¸ä»¥å¤–ï¼Œå¤§éƒ¨åˆ†éƒ½æ‹¿ä¸åˆ°ï¼Œè€Œè¦é€é <code>getS3method(&quot;generic&quot;, &quot;class&quot;)</code> ä¾†çœ‹åˆ°ç¨‹å¼ç¢¼</p>
<h2 id="classes">Classes</h2>
<p>è‡ªè¡Œå»ºç«‹è‡ªå·±çš„é¡åˆ¥ï¼Œåˆ©ç”¨<code>structure()</code></p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5"># Create and assign class in one step
foo &lt;- structure(list(), class = &quot;foo&quot;)

# Create, then set class
foo &lt;- list()
class(foo) &lt;- &quot;foo&quot;
</code></pre>
<p>é¡åˆ¥å¯èƒ½å…©ç¨®ä»¥ä¸Šï¼Œæ­¤æ™‚å¯ä»¥ç”¨å‡½æ•¸<code>inherits()</code></p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">class(foo)
#&gt; [1] &quot;foo&quot;
inherits(foo, &quot;foo&quot;)
#&gt; [1] TRUE
</code></pre>
<p>ä¸€æ¬¡å®šç¾©å¤šå€‹é¡åˆ¥çš„ä¾‹å­ï¼š</p>
<pre><code class="language-r?preclass=.ms-5.w-75"> structure(x, 
    class = c(&quot;POSIXct&quot;, &quot;POSIXt&quot;),
    tzone = tzone
  )
</code></pre>
<p>S3 has no checks for correctness. This means you can change the class of existing objects:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5"># Create a linear model
mod &lt;- lm(log(mpg) ~ log(disp), data = mtcars)
class(mod)
#&gt; [1] &quot;lm&quot;
print(mod)
#&gt; 
#&gt; Call:
#&gt; lm(formula = log(mpg) ~ log(disp), data = mtcars)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)    log(disp)  
#&gt;      5.3810      -0.4586

# Turn it into a data frame (?!)
class(mod) &lt;- &quot;data.frame&quot;

# Unsurprisingly this doesn't work very well
print(mod)
#&gt;  [1] coefficients  residuals     effects       rank          fitted.values
#&gt;  [6] assign        qr            df.residual   xlevels       call         
#&gt; [11] terms         model        
#&gt; &lt;0 åˆ—&gt; (æˆ–é›¶é•·åº¦çš„ row.names)
</code></pre>
<h3 id="constructors">Constructors</h3>
<p>å› ç‚ºæ˜¯èªæ„ä¸Šçš„ï¼¯ï¼¯ï¼°ï¼Œå› æ­¤ï¼Œå»ºæ§‹å­ä¹Ÿæ˜¯è‡ªå·±è¦å®šè¦æ€æ¨£ï¼Œä¾‹å¦‚æ¨¡ä»¿ï¼¯ï¼¯ï¼°çš„é€šå‰‡ç”¨<code>new</code>é€™å€‹é—œéµå­—</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">new_Date &lt;- function(x) {
  stopifnot(is.double(x))
  structure(x, class = &quot;Date&quot;)
}

new_Date(c(-1, 0, 1))
#&gt; [1] &quot;1969-12-31&quot; &quot;1970-01-01&quot; &quot;1970-01-02&quot;
</code></pre>
<p>çœ‹çœ‹æŒ‡ä»¤<code>lm()</code>ç”¢ç”Ÿçš„ç‰©ä»¶</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">mod &lt;- lm(mpg ~ wt, data = mtcars)
typeof(mod)
#&gt; [1] &quot;list&quot;
names(mod)
#&gt;  [1] &quot;coefficients&quot;  &quot;residuals&quot;     &quot;effects&quot;       &quot;rank&quot;         
#&gt;  [5] &quot;fitted.values&quot; &quot;assign&quot;        &quot;qr&quot;            &quot;df.residual&quot;  
#&gt;  [9] &quot;xlevels&quot;       &quot;call&quot;          &quot;terms&quot;         &quot;model&quot;
</code></pre>
<p>é€™è£¡èˆ‰ä¸€å€‹å­—éµé¡å‹ï¼ˆæœ¬ä¾‹ä¸­ï¼Œdf_classï¼‰çš„ä¾‹å­</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">new_df_class &lt;- function(df, attr1, attr2) {
  stopifnot(is.data.frame(df))
  
  structure(
    df, 
    attr1 = attr1,
    attr2 = attr2,
    class = c(&quot;df_class&quot;, &quot;data.frame&quot;)  
  )
}
</code></pre>
<p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œclassçš„é †åºæ˜¯æœ‰æ„ç¾©çš„ï¼Œæ„æ€æ˜¯<code>df_class</code>ç¹¼æ‰¿è‡ª<code>data.frame</code></p>
<h2 id="generics-and-methods">Generics and methods</h2>
<p>é€éé€šç”¨å‡½æ•¸è¦é”æˆï¼¯ï¼¯ï¼°çš„å¤šå‹å‡½æ•¸(dispatch)ã€‚
S3é€™å€‹å¤šå‹å‡½æ•¸ï¼Œåˆ©ç”¨ <code>UseMethod()</code>, ä¾†å‘¼å«é¡åˆ¥å°æ‡‰çš„å‡½æ•¸ã€‚ <code>UseMethod()</code> å…©å€‹åƒæ•¸ï¼Œä¸€å€‹æ˜¯å‡½æ•¸åç¨±ï¼Œç„¶å¾Œæ˜¯è¦å‚³é€²å»çš„åƒæ•¸ï¼ˆå¯çœç•¥ï¼‰ã€‚</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5"># Dispatches on x
generic &lt;- function(x, y, ...) {
  UseMethod(&quot;generic&quot;)
}

# Dispatches on y
generic2 &lt;- function(x, y, ...) {
  UseMethod(&quot;generic2&quot;, y)
}
</code></pre>
<p>Note that you don't pass any of the arguments of the generic to <code>UseMethod()</code>; it uses black magic to pass them on automatically. Generally, you should avoid doing any computation in a generic, because the semantics are complicated and few people know the details. In general, any modifications to the arguments of the generic will be undone, leading to much confusion.</p>
<p>A generic isn't useful without some methods, which are just functions that follow a naming scheme (<code>generic.class</code>). Because a method is just a function with a special name, you <em>can</em> call methods directly, but you generally <em>shouldn't</em>. The main reason to call the method directly is that it sometimes leads to considerable performance improvements. See <a href="#be-lazy">performance</a> for an example.</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">generic.foo &lt;- function(x, y, ...) {
  message(&quot;foo method&quot;)
}

generic(new_s3_scalar(class = &quot;foo&quot;))
#&gt; Error in new_s3_scalar(class = &quot;foo&quot;): æ²’æœ‰é€™å€‹å‡½å¼ &quot;new_s3_scalar&quot;
</code></pre>
<p>You can see all the methods defined for a generic with <code>s3_methods_generic()</code>:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">s3_methods_generic(&quot;generic&quot;)
#&gt; Error in .S3methods(generic.function, class, envir): no function 'generic' is visible
</code></pre>
<h3 id="coercion">Coercion</h3>
<p>Many S3 objects can be naturally created from an existing object through <strong>coercion</strong>. If this is the case for your class, you should provide a coercion function, an S3 generic called <code>as_class_name</code>. Base R generally does not follow this convention, which can cause problems as illustrated by <code>as.factor()</code>:
åœ¨ï¼²ä¸­<code>as.factor</code>ä¸¦ä¸æ˜¯å‡½æ•¸<code>as</code>ï¼ˆéé€šç”¨å‡½æ•¸ï¼‰çš„æ´¾ç™¼å‡½æ•¸ã€‚
å¦‚æœç¾åœ¨æˆ‘å€‘è¦è‡ªå·±å»ºä¸€å€‹è½‰æ›æˆ<code>factor</code>é¡åˆ¥çš„é€šç”¨å‡½æ•¸</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">as_factor &lt;- function(x, ...) {
  UseMethod(&quot;as_factor&quot;)
}
</code></pre>
<p>å…ˆå®šç¾©ä¸€å€‹å°å·²ç¶“æ˜¯factorçš„å‡½æ•¸ï¼Œå°±æ˜¯èªªå¦‚æœå·²ç¶“æ˜¯factoré‚£å°±ä¸åšä»»ä½•äº‹ï¼Œå› ç‚ºä¸ç”¨è½‰æ›</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">as_factor.factor &lt;- function(x, ...) x
</code></pre>
<p>ç¾åœ¨é‡å°å­—ä¸²å’Œæ•´æ•¸å®šç¾©ç›¸å°æ‡‰çš„æ´¾ç™¼å‡½æ•¸ï¼š</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">as_factor.character &lt;- function(x, ...) {
  factor(x, levels = unique(x))
}
as_factor.integer &lt;- function(x, ...) {
  factor(x, levels = as.character(unique(x)))
}
</code></pre>
<p>å°æ–¼ä¸è™•ç†çš„é¡åˆ¥ï¼Œå¯ä»¥åˆ©ç”¨<code>default</code></p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">as_factor(1)
#&gt; Error in UseMethod(&quot;as_factor&quot;): æ²’æœ‰é©ç”¨çš„æ–¹æ³•å¯å°‡ 'as_factor' å¥—ç”¨åˆ° &quot;c('double', 'numeric')&quot; é¡åˆ¥çš„ç‰©ä»¶

as_factor.default &lt;- function(x, ...) {
  stop(
    &quot;Don't know how to coerce object of class &quot;, 
    paste(class(x), collapse = &quot;/&quot;), &quot; into a factor&quot;, 
    call. = FALSE
  )
}
as_factor(1)
#&gt; Error: Don't know how to coerce object of class numeric into a factor
</code></pre>
<h3 id="s3-arguments">Arguments</h3>
<p>é€šå¸¸é€šç”¨å‡½æ•¸å’Œæ´¾ç™¼å‡½æ¨¹æœ‰ç›¸åŒçš„åƒæ•¸å€‹æ•¸ï¼ˆå¦‚æœæ˜¯å¥—ä»¶é–‹ç™¼ï¼Œå‰‡ R CMD check æœƒå¼·è¿«é€™å€‹è¦å®šï¼‰ï¼Œä½†æ˜¯åŠ äº† <code>...</code>, å°±å¯ä»¥ä¸å—é€™å€‹é™åˆ¶ã€‚</p>
<h2 id="method-dispatch">Method dispatch</h2>
<p><code>UseMethod()</code> and <code>NextMethod()</code>. ã€€</p>
<h3 id="usemethod"><code>UseMethod()</code></h3>
<p>The purpose of <code>UseMethod()</code> åˆ©ç”¨æŒ‡ä»¤ <code>paste0(&quot;é€šç”¨&quot;, &quot;.&quot;, c(class(x), &quot;default&quot;))</code>,ç„¶å¾Œåœ¨å…¶ä¸­æ‰¾å‡ºå°æ‡‰çš„æ´¾ç™¼å‡½æ•¸ã€‚é€™è£¡åˆ©ç”¨ <code>sloop::s3_dispatch()</code>. ä¾†åˆ—å‡ºæ´¾ç™¼å‡½æ•¸</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">x &lt;- Sys.time()
s3_dispatch(print(x))
#&gt; =&gt; print.POSIXct
#&gt;    print.POSIXt
#&gt;  * print.default
</code></pre>
<p>å¦‚ä¸Šï¼Œç•¶æˆ‘å€‘è¦printå‡º <code>POSIXct</code> ç‰©ä»¶æ™‚æœƒæ€æ¨£?</p>
<p><code>print()</code> will look for three possible methods, of which two exist, and one, <code>print.POSIXct()</code>, will be called. The last method is always the &quot;default&quot; method. This doesn't correspond to a specific class, so is a useful catch all.</p>
<h3 id="nextmethod"><code>NextMethod()</code></h3>
<p><code>NextMethod()</code>ç”¨ä¾†èª¿ç”¨è¦ªä»£é¡åˆ¥ä¸­çš„å°æ‡‰æ´¾ç™¼å‡½æ•¸ã€‚é”æˆï¼¯ï¼¯ï¼°ä¸­å°±æ˜¯é¡ä¼¼ç¹¼æ‰¿è¦ªä»£å‡½æ•¸çš„æ–¹æ³•ã€‚</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">showoff &lt;- function(x) {
  UseMethod(&quot;showoff&quot;)
}
showoff.default &lt;- function(x) {
  message(&quot;showoff.default&quot;)
  TRUE
}
showoff.a &lt;- function(x) {
  message(&quot;showoff.a&quot;)
  NextMethod()ã€€#<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="ğŸ‘èª¿ç”¨">ğŸ·</span><!--/html_preserve-->
}
showoff.b &lt;- function(x) {
  message(&quot;showoff.b&quot;)
  NextMethod()
}
</code></pre>
<p>å»ºç«‹ä¸€å€‹ç¹¼æ‰¿è‡ªbé¡åˆ¥çš„,è€Œä¸”æ˜¯açš„ç‰©ä»¶ã€‚</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">x &lt;- structure(1,class = c(&quot;b&quot;, &quot;a&quot;)) # <!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="ğŸ‘b ç¹¼æ‰¿è‡ª a">ğŸ·</span><!--/html_preserve-->
s3_dispatch(showoff(x))ã€€#<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="ğŸ‘  &lt;code&gt;s3_dispatch()&lt;/code&gt; shows that all three potential methods are available">ğŸ·</span><!--/html_preserve-->
#&gt; =&gt; showoff.b
#&gt; -&gt; showoff.a
#&gt; -&gt; showoff.default
</code></pre>
<p>çœ‹çœ‹æœƒæ€æ¨£</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">showoff(x)
#&gt; showoff.b
#&gt; showoff.a
#&gt; showoff.default
#&gt; [1] TRUE
</code></pre>
<p>Generally, you call <code>NextMethod()</code> without any arguments. However, if you do give arguments, they are passed on to the next method, as if they'd been supplied to the generic.</p>
<h2 id="inheritance">Inheritance</h2>
<p>The class attribute is not limited to a single string, but can be a character vector. This, along with S3 method dispatch and <code>NextMethod()</code>, gives a surprising amount of flexibility that can be used creatively to reduce code duplication. However, this flexibility can also lead to code that is hard to understand or reason about, so you are best constraining yourself to simple styles of inheritance. Here we will focus on defining subclasses that inherit their fields, and some behaviour, from a parent class.</p>
<p>Subclasses use a character <strong>vector</strong> for the class attribute. There are two examples of subclasses that you might have come across in base R:</p>
<ul>
<li>
<p>Generalised linear models are a generalisation of linear models that allow
the error term to belong to a richer set of distributions, not just the normal
distribution like the linear model. This is a natural case for the use of 
inheritance and indeed, in R, <code>glm()</code> returns objects of class 
<code>c(&quot;glm&quot;, &quot;lm&quot;)</code>.</p>
</li>
<li>
<p>Ordered factors are used when the levels of a factor have some intrinsic
ordering, like <code>c(&quot;Good&quot;, &quot;Better&quot;, &quot;Best&quot;)</code>. Ordered factors are produced
by <code>ordered()</code> which returns an object with class <code>c(&quot;ordered&quot;, &quot;factor&quot;)</code>.</p>
</li>
</ul>
<p>You can think of the glm class &quot;inheriting&quot; behaviour from the lm class, and the ordered class inheriting behaviour from the factor class because of the way method dispatch works. If there is a method available for the subclass, R will use it, otherwise it will fall back to the &quot;parent&quot; class. For example, if you &quot;plot&quot; a glm object, it falls back to the lm method, but if you compute the ANOVA, it uses a glm-specific method.</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">mod1 &lt;- glm(mpg ~ wt, data = mtcars)

s3_dispatch(plot(mod1))
#&gt;    plot.glm
#&gt; =&gt; plot.lm
#&gt;  * plot.default
s3_dispatch(anova(mod1))
#&gt; =&gt; anova.glm
#&gt;  * anova.lm
#&gt;    anova.default
</code></pre>
<h3 id="constructors-1">Constructors</h3>
<p>There are three principles to adhere to when creating a subclass:</p>
<ul>
<li>
<p>A subclass should be built on the same base type as a parent.</p>
</li>
<li>
<p>The <code>class()</code> of the subclass should be of the form 
<code>c(subclass, parent_class)</code></p>
</li>
<li>
<p>The fields of the subclass should include the fields of the parent.</p>
</li>
</ul>
<p>And these properties should be enforced by the constructor.</p>
<p>When you create a class, you need to decide if you want to allow subclasses, because it requires changes to the constructor and careful thought in your methods. To allow subclasses, the parent constructor needs to have <code>...</code> and <code>subclass</code> arguments:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">new_my_class &lt;- function(x, y, ..., subclass = NULL) {
  stopifnot(is.numeric(x))
  stopifnot(is.logical(y))
  
  structure(
    x,
    y = y,
    ...,
    class = c(subclass, &quot;my_class&quot;)
  )
}
</code></pre>
<p>Then the implementation of the subclass constructor is simple: it checks the types of the new fields, then calls the parent constructor.</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">new_subclass &lt;- function(x, y, z) {
  stopifnot(is.character(z))
  new_my_class(x, y, z, subclass = &quot;subclass&quot;)
}
</code></pre>
<p>If you wanted to allow this subclass to be futher subclassed, you'd need to include <code>...</code> and <code>subclass</code> arguments:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">new_subclass &lt;- function(x, y, z, ..., subclass = NULL) {
  stopifnot(is.character(z))
  
  new_my_class(x, y, z, ..., subclass = c(subclass, &quot;subclass&quot;))
}
</code></pre>
<p>If your subclass is more complicated, you'd also provide validator and helper functions, as described previously.</p>
<h3 id="coercion-1">Coercion</h3>
<p>You also need to make sure that there's some way to convert the subclass back to the parent class. The best way to do that is to add a method to the coercion generic. Generally, this method should call the parent constructor:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">as_my_class.sub_class &lt;- function(x) {
  new_my_class(attr(x, &quot;x&quot;), attr(x, &quot;y&quot;))
}
</code></pre>
<h3 id="methods">Methods</h3>
<p>The goal of creating a subclass is to reuse as much code as possible from the parent class. This means that you should not have to define every method that the parent class provides (if you do, reconsider if you actually need a subclass!). Generally, defining new methods is straightforward: you simply create a new method (<code>generic.subclass</code>) whenever the parent method doesn't do quite the right thing. In many cases, the new method will be able to call <code>NextMethod()</code> in order to take advantage of the computation done in the parent.</p>
<p>One wrinkle arises when you have methods that return the same type of object as the primary input. For example, dplyr has many functions (<code>arrange()</code>, <code>summarise()</code>, <code>mutate()</code>, ...) that input a data frame (or data frame-like object) and output a modified version of that data frame. Imagine you want to store the provenance of each data frame, i.e. who created it and when. To do so, you might create a data frame subclass called <code>provenance</code>:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">new_provenance &lt;- function(data, author, date = Sys.Date()) {
  stopifnot(is.data.frame(data))
  stopifnot(is.character(author), length(author) == 1)
  stopifnot(is.Date(date), length(date) == 1)
  
  structure(
    data,
    author = author, 
    date = date,
    class = c(&quot;provenance&quot;, &quot;data.frame&quot;)
  )
}
</code></pre>
<p>And now you want to make this class work with dplyr. The class doesn't change any of the computation related to the data frame, it just needs to preserve the attributes, which dplyr doesn't know anything about. That means you need to provide a method for each dplyr generic. The computation is unchanged, so you can use <code>NextMethod()</code> to do all the hard work, but you need to manually reconstruct the provenance object.</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">arrange.provenance &lt;- function(.data, ...) {
  new_provenance(
    NextMethod(), 
    author = attr(.data, &quot;author&quot;),
    date = attr(.data, &quot;date&quot;)
  )
}

mutate.provenance &lt;- function(.data, ...) {
  new_provenance(
    NextMethod(), 
    author = attr(.data, &quot;author&quot;),
    date = attr(.data, &quot;date&quot;)
  )
}
</code></pre>
<p>To do this for all the dplyr generics would require a lot of copying and pasting. Let's reduce some of that duplication by taking advantage of <code>sloop::reconstruct()</code>. <code>reconstruct()</code> is a generic function designed to reconstruct a subclass from an instance of the parent class, typically created by <code>NextMethod()</code>, and the original subclass. In other words, the job of a reconstructor is to take an object from a parent class, and copy over attributes from the subclass. (Note that <code>reconstruct()</code> is unusual in that it dispatches on the second argument. This allows a more natural specification.)</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">reconstruct.provenance  &lt;- function(new, old) {
  new_provenance(
    new, 
    author = attr(old, &quot;author&quot;),
    date = attr(old, &quot;date&quot;)
  )
}
</code></pre>
<p>Now we can rewrite the methods to minimise the amount of duplicated code:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">arrange.provenance &lt;- function(.data, ...) {
  reconstruct(NextMethod(), .data)
}

mutate.provenance &lt;- function(.data, ...) {
  reconstruct(NextMethod(), .data)
}
</code></pre>
<p>This duplicated code could be avoided completely if <code>arrange.data.frame()</code>, provided by dplyr, called <code>reconstruct()</code> for you. And indeed, a future version of that function will.</p>
<p>When designing a class that can be subclassed, you need to carefully think through these issues. Generally, whenever you implement a method that returns the same type of object as the primary input, you should call <code>reconstruct()</code> to ensure that it also works for subclasses. That way implementors of a subclass will only need to provide methods when the computation is actually different.</p>
<h2 id="dispatch-details">Dispatch details</h2>
<p>This chapter concludes with a few additional details about method dispatch that is not well documented elsewhere. It is safe to skip these details if you're new to S3.</p>
<h3 id="environments-and-namespaces">Environments and namespaces</h3>
<p>The precise rules for where a generic looks for the methods are a little complicated because there are two paths for discovery:</p>
<ol>
<li>
<p>In the calling environment of the function that called the generic.</p>
</li>
<li>
<p>In the special <code>.__S3MethodsTable__.</code> object in the function environment of 
the generic. Every package has an <code>.__S3MethodsTable__</code> which lists all
the S3 methods exported by the package.</p>
</li>
</ol>
<p>These details are not usually important, but are necessary in order for S3 generics to find the correct method when the generic and method are in different packages.</p>
<h3 id="s3-and-base-types">S3 and base types</h3>
<p>What happens when you call an S3 generic with a non-S3 object, i.e. an object that doesn't have the class attribute set? You might think it would dispatch on what <code>class()</code> returns:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">class(matrix(1:5))
#&gt; [1] &quot;matrix&quot; &quot;array&quot;
</code></pre>
<p>But unfortunately dispatch actually occurs on the <strong>implicit class</strong>, which has three components:</p>
<ul>
<li>&quot;array&quot; or &quot;matrix&quot; (if the object has dimensions).</li>
<li><code>typeof()</code> (with a few minor tweaks).</li>
<li>If it's &quot;integer&quot; or &quot;double&quot;, &quot;numeric&quot;.</li>
</ul>
<p>There is no base function that will compute the implicit class, but you can use a helper from the sloop package: \index{implicit class} \index{base types!implicit class}</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">s3_class(matrix(1:5))
#&gt; [1] &quot;matrix&quot;  &quot;integer&quot; &quot;numeric&quot;
</code></pre>
<p><code>s3_dispatch()</code> knows about the implicit class, so use it if you're ever in doubt about method dispatch:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">s3_dispatch(print(matrix(1:5)))
#&gt;    print.matrix
#&gt;    print.integer
#&gt;    print.numeric
#&gt; =&gt; print.default
</code></pre>
<p>Note that this can lead to different dispatch for objects that look similar:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">x1 &lt;- 1:5
class(x1)
#&gt; [1] &quot;integer&quot;
s3_dispatch(mean(x1))
#&gt;    mean.integer
#&gt;    mean.numeric
#&gt; =&gt; mean.default

x2 &lt;- structure(x1, class = &quot;integer&quot;)
class(x2)
#&gt; [1] &quot;integer&quot;
s3_dispatch(mean(x2))
#&gt;    mean.integer
#&gt; =&gt; mean.default
</code></pre>
<h3 id="internal-generics">Internal generics</h3>
<p>Some S3 generics, like <code>[</code>, <code>sum()</code>, and <code>cbind()</code>, don't call <code>UseMethod()</code> because they are implemented in C. Instead, they call the C functions <code>DispatchGroup()</code> or <code>DispatchOrEval()</code>. These functions are called <strong>internal generics</strong>, because they do dispatch internally, in C code. Internal generics only exist in base R, so you can not create an internal generic in a package.</p>
<p><code>s3_dispatch()</code> shows internal generics by including the name of the generic at the bottom of the method class. If this method is called, all the work happens in C code, typically using [switchpatch].</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">s3_dispatch(Sys.time()[1])
#&gt; =&gt; [.POSIXct
#&gt;    [.POSIXt
#&gt;    [.default
#&gt; -&gt; [ (internal)
</code></pre>
<p>For performance reasons, internal generics do not dispatch to methods unless the class attribute has been set (<code>is.object()</code> is true). This means that internal generics do not use the implicit class. Again, if you're confused, rely on <code>s3_dispatch()</code> to show you the difference.</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">x &lt;- sample(10)
class(x)
#&gt; [1] &quot;integer&quot;
s3_dispatch(x[1])
#&gt;    [.integer
#&gt;    [.numeric
#&gt;    [.default
#&gt; =&gt; [ (internal)

class(y) 
#&gt; Error in eval(expr, envir, enclos): æ‰¾ä¸åˆ°ç‰©ä»¶ 'y'
s3_dispatch(mtcars[1])
#&gt; =&gt; [.data.frame
#&gt;    [.default
#&gt; -&gt; [ (internal)
</code></pre>
<h3 id="group-generics">Group generics</h3>
<p>Group generics are the most complicated part of S3 method dispatch because they involve both <code>NextMethod()</code> and internal generics. Group generics are worth learning about, however, because they allow you to implement a whole swath of methods with one function. Like internal generics, they only exist in base R, and you can not define your own group generic.</p>
<p>Base R has four group generics, which are made up of the following generics: \index{group generics} \index{S3!group generics}</p>
<ul>
<li>
<p><strong>Math</strong>: <code>abs</code>, <code>sign</code>, <code>sqrt</code>, <code>floor</code>, <code>cos</code>, <code>sin</code>, <code>log</code>, <code>exp</code>, ...</p>
</li>
<li>
<p><strong>Ops</strong>: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>, <code>%%</code>, <code>%/%</code>, <code>&amp;</code>, <code>|</code>, <code>!</code>, <code>==</code>, <code>!=</code>, <code>&lt;</code>, 
<code>&lt;=</code>, <code>&gt;=</code>, <code>&gt;</code></p>
</li>
<li>
<p><strong>Summary</strong>: <code>all</code>, <code>any</code>, <code>sum</code>, <code>prod</code>, <code>min</code>, <code>max</code>, <code>range</code></p>
</li>
<li>
<p><strong>Complex</strong>: <code>Arg</code>, <code>Conj</code>, <code>Im</code>, <code>Mod</code>, <code>Re</code></p>
</li>
</ul>
<p>Defining a single group generic for your class overrides the default behaviour for all of the members of the group. Methods for group generics are looked for only if the methods for the specific generic do not exist:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">s3_dispatch(sum(Sys.time()))
#&gt;    sum.POSIXct
#&gt;    sum.POSIXt
#&gt;    sum.default
#&gt; =&gt; Summary.POSIXct
#&gt;    Summary.POSIXt
#&gt;    Summary.default
#&gt; -&gt; sum (internal)
</code></pre>
<p>Most group generics involve a call to <code>NextMethod()</code>. For example, take <code>difftime()</code> objects. If you look at the method dispatch for <code>abs()</code>, you'll see there's a <code>Math</code> group generic defined.</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">y &lt;- as.difftime(10, units = &quot;mins&quot;)
s3_dispatch(abs(y))
#&gt;    abs.difftime
#&gt;    abs.default
#&gt; =&gt; Math.difftime
#&gt;    Math.default
#&gt; -&gt; abs (internal)
</code></pre>
<p><code>Math.difftime</code> basically looks like this:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">Math.difftime &lt;- function(x, ...) {
  new_difftime(NextMethod(), units = attr(x, &quot;units&quot;))
}
</code></pre>
<p>It dispatches to the next method, here the internal default, to perform the actual computation, then copies back over the the class and attributes.</p>
<p>Note that inside a group generic function a special variable <code>.Generic</code> provides the actual generic function called. This can be useful when producing error messages, and can sometimes be useful if you need to manually re-call the generic with different arguments.</p>
<h3 id="double-dispatch">Double dispatch</h3>
<p>Generics in the &quot;Ops&quot; group, which includes the two-argument mathematical and logical operators like <code>-</code> and <code>&amp;</code>, implement a special type of method dispatch. They dispatch on the type of <em>both</em> of the arguments, so called <strong>double dispatch</strong>. This is necessary to preserve the commutative property of many operators, i.e. <code>a + b</code> should equal <code>b + a</code>. Take the following simple example:</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">date &lt;- as.Date(&quot;2017-01-01&quot;)
integer &lt;- 1L

date + integer
#&gt; [1] &quot;2017-01-02&quot;
integer + date
#&gt; [1] &quot;2017-01-02&quot;
</code></pre>
<p>If <code>+</code> dispatched only on the first argument, it would return different values for the two cases. To overcome this problem, generics in the Ops group use a slightly different strategy from usual. Rather than doing a single method dispatch, they do two, one for each input. There are three possible outcomes of this lookup:</p>
<ul>
<li>
<p>The methods are the same, so it doesn't matter which method is used.</p>
</li>
<li>
<p>The methods are different, and R calls the first method with a warning.</p>
</li>
<li>
<p>One method is internal, in which case R calls the other method.</p>
</li>
</ul>
<p>For the example above, we can look at the possible methods for each argument, taking advantage of the fact that we can call <code>+</code> with a single argument.  In this case, the second argument would dispatch to the internal <code>+</code> function, so R will call <code>+.Date</code>.</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">s3_dispatch(+date)
#&gt; =&gt; +.Date
#&gt;    +.default
#&gt;  * Ops.Date
#&gt;    Ops.default
#&gt;  * + (internal)
s3_dispatch(+integer)
#&gt;    +.integer
#&gt;    +.numeric
#&gt;    +.default
#&gt;    Ops.integer
#&gt;    Ops.numeric
#&gt;    Ops.default
#&gt; =&gt; + (internal)
</code></pre>
<p>Let's take a look at another case. What happens if you try to add a date to a factor? There is no method in common, so R calls the internal <code>+</code> method (which preserves the attributes of the LHS), with a warning.</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">factor &lt;- factor(&quot;a&quot;)
s3_dispatch(+factor)
#&gt;    +.factor
#&gt;    +.default
#&gt; =&gt; Ops.factor
#&gt;    Ops.default
#&gt; -&gt; + (internal)

date + factor
#&gt; Warning: ä¸ç›¸å®¹çš„æ–¹æ³• (&quot;+.Date&quot;, &quot;Ops.factor&quot;) ç”¨æ–¼ &quot;+&quot;
#&gt; [1] &quot;2017-01-02&quot;
factor + date
#&gt; Warning: ä¸ç›¸å®¹çš„æ–¹æ³• (&quot;Ops.factor&quot;, &quot;+.Date&quot;) ç”¨æ–¼ &quot;+&quot;
#&gt; Error in as.character.factor(x): ç•°å¸¸çš„å› å­
</code></pre>
<p>Finally, what happens if we try to substract a POSIXct from a POSIXlt? A common <code>-.POSIXt</code> method is found and called.</p>
<pre><code class="language-r?lang=r?class=.source?preclass=ms-5">dt1 &lt;- as.POSIXct(date)
dt2 &lt;- as.POSIXlt(date)

s3_dispatch(-dt1)
#&gt;    -.POSIXct
#&gt; =&gt; -.POSIXt
#&gt;    -.default
#&gt;    Ops.POSIXct
#&gt;  * Ops.POSIXt
#&gt;    Ops.default
#&gt;  * - (internal)
s3_dispatch(-dt2)
#&gt;    -.POSIXlt
#&gt; =&gt; -.POSIXt
#&gt;    -.default
#&gt;    Ops.POSIXlt
#&gt;  * Ops.POSIXt
#&gt;    Ops.default
#&gt;  * - (internal)

dt1 - dt2
#&gt; Time difference of 0 secs
</code></pre>
  </article><div class="collapse fs-6 pt-2" id="qnote-list">
    <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-white ">
        <span >
            
            <span class="fw-semibold">
                <button  class="btn btn-primary btn-inline" 
                   data-bs-toggle="collapse" data-bs-target="#qnote-edit"><span data-bs-toggle="tooltip" title="åŠ å…¥é€Ÿè¨˜">åŠ </span></button>
                <button id="qnote-gsave" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="å­˜åˆ°ç¡¬ç¢Ÿ"
                   onclick="qnSaveGoogle()">å­˜</button>
                <label for="qnote-load" class="btn btn-primary btn-inline"  data-bs-toggle="tooltip" data-bs-placement="left" title="å¾æª”æ¡ˆè¼‰å…¥">è¼‰</label>   
                <input style="display:none" type="file" id="qnote-load" onchange="qnLoadGoogle(this)" />
                <button id="qnote-clear" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="æ¸…é™¤å…¨éƒ¨é€Ÿè¨˜"
                   onclick="cleanNotes()">æ¸…</button>
            </span>
        </span>
        <span class="fw-semibold collapse" id="qnote-edit"> 
            <input type="text" class="txtitle d-block w-100 h-25 " placeholder="æŠ¬é ­" />
            <textarea class="txtBox  d-block w-100 h-75 " placeholder="æœ¬æ–‡"></textarea>
            
            <button id="qnote-add-item" onclick="addNote()" class="btn btn-primary">å­˜</button> 
        </span>

    </div>
</div>

<link href="/blogR/css/quicknote.css?1641445339" rel="stylesheet">
<script src="/blogR/js/quicknote.js?1641445339"></script>
<div id="page-guide" class="bg-dark">  
  <a id="avator" href="/api/list" 
  class="btn btn-primary d-none"  data-bs-toggle="tooltip"  data-bs-placement="left" title=""><img style="padding:0px"class="img-fluid "></a>

  
    
          
          <a href="/blogR/rlang/7_8_objectbasic.html" 
                   class="btn btn-primary" 
                   data-bs-toggle="tooltip" 
                   data-bs-placement="left" title=7.8&#32;Rçš„ç‰©ä»¶ç›¸é—œæ¦‚å¿µ>å‰</a>
                   
          
            <a href="/blogR/rlang/9_1_plot.html" 
               class="btn btn-primary" data-bs-toggle="tooltip" data-bs-placement="left" 
               title=9.1&#32;åŸºæœ¬ç¹ªåœ–>å¾Œ</a>            
          
          

  
<script src="/blogR/js/packhtml.js?1641445339"></script>    
<button class="btn btn-primary " onclick="packthis(this)"
data-bs-toggle="tooltip" data-bs-placement="left" title="æ‰“åŒ…æˆå–®ä¸€æª”æ¡ˆ">åŒ…</button>
<button class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="div#qnote-list">
  <span data-bs-toggle="tooltip" data-bs-placement="left" title="å¿«é€Ÿè¨»è¨˜">é€Ÿ</span></button>
 
</div>
</div>


  <script src="/blogR/js/featherlight.min.js?1641445339"></script>
  <script src="/blogR/js/featherlight.gallery.min.js?1641445339"></script>
  <link href="/blogR/css/featherlight.min.css?1641445339" rel="stylesheet">
  <link href="/blogR/css/featherlight.gallery.min.css?1641445339" rel="stylesheet">
  
  <script src="/blogR/js/highlight.min.js"></script>
  
  <script src="/blogR/js/hugohelper.js?1641445339"></script>
  <link href="/blogR/css/rmd.css?1641445339" rel="stylesheet">
  <link href="/blogR/css/mystyle.css?1641445339" rel="stylesheet">    
  <script src='/blogR/js/variant.js?1641445339'></script>

<script>
  
   let idxfile = "https:\/\/airbone4.github.io\/blogR\/index.json"  
  
</script>
<script src='/blogR/js/localsearch.js?1641445339'></script>
  
      
          <script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script>
      
      <script>
          mermaid.initialize({ startOnLoad: true });
      </script>
  

  <script>
      MathJax = {
        tex: {
          inlineMath: [['\($', '$\)'], ['\\(', '\\)']],
          displayMath: [['$$','$$']  , ['\\[','\\]']] 
        },
        svg: {
          fontCache: 'global'
        }
      };
      
      
    
      </script>

      <script type="text/javascript" id="MathJax-script" async
      src='/blogR/js/tex-svg.js'>
      </script>



<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    jumpto = document.querySelector("#sidebar .active");
     if (jumpto!=null) jumpto.scrollIntoViewIfNeeded(true);
  
  });    
  
  </script>
</body>
</html>