<!DOCTYPE html>
<html><head>
  <title>7.8 Function more</title>  
      
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href='../images/favicon.ico'/>
      
    <script src="../js/jquery-3.3.1.min.js?1632928432"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    
    <script src='../js/datatables.min.js'></script>    
    <link href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css" rel="stylesheet">    
    
    <link href="../css/fontawesome-all.min.css?1632928432" rel="stylesheet">
    <link href="../css/atom-one-dark-reasonable.css?1632928432" rel="stylesheet">
    <link href="../css/syntax.css?1632928432" rel="stylesheet">
    
    <link href="../css/theme-mine.css?1632928432" rel="stylesheet">
    
    <link href="../css/theme.css?1632928432" rel="stylesheet">
    
    
    <link rel="stylesheet" href="../scss/notice.32c96872d0db2364b666008c0f71550ae9c2554b32a9475a28780f3696539df4.css" integrity="sha256-MsloctDbI2S2ZgCMD3FVCunCVUsyqUdaKHgPNpZTnfQ=">

    
  </head><body><div id="top-pane" class="navbar  fixed-top ">
  <div class="container-fluid">
  <span >
    <a  href='../' class="fs-5 accessory"><i class="fas fa-home"></i>R in Class</a>
    <span id="sidebar-toggle-span" class="fs-5"><i class="fas fa-align-justify"></i></span>
  </span><span >
      <span id="toc-menu">
    <label><i class="fas fa-list-alt" ></i> </label>    
<div id="variant-toc-content" >
    <div class="wrapper">
        
    </div>
    <hr class="p-0 m-0" />
    <div class="toa"></div>
</div>
</span>
<span class="fs-5 accessory" data-bs-toggle="tooltip" data-bs-placement="bottom" 
      title='æœ€å¾Œä¿®æ”¹September 16, 2021'>7.8 Function more</span>
        
    

    </span>
  
  <span></span><span >
    <span >
    <label for="search-query" id="search-button"><i class="fas fa-search"></i></label>
    <input id="search-query" type="search" placeholder="æœå°‹" autocomplete="off">
</span>    
 
<div id="search-pane">
 <ol id="search-results"></ul>
</div>

    </span>
</div> 
</div>


<div id="content-wrapper"><nav id="sidebar">

  

    
    
    <ul class="nav flex-column topics" id="home-topics">
      
        
          
          

 


<li class="nav-item" data-bs-toggle="tooltip" title="Rlangs">
     

  <a class="nav-link" 
    href="../rlang.html"><i class="far fa-folder"></i>Rlangs  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_"  
  class="submenu collapse show" 
  data-bs-parent="#home-topics"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_0_requirement.html" data-bs-toggle="tooltip" title="1 Requirement">1 Requirement</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_1_%E7%B3%BB%E7%B5%B1.html" data-bs-toggle="tooltip" title="1.1 é‹ä½œç’°å¢ƒ">1.1 é‹ä½œç’°å¢ƒ</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_2_filesystem.html" data-bs-toggle="tooltip" title="1.2 æª”æ¡ˆç³»çµ±">1.2 æª”æ¡ˆç³»çµ±</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_3_%E5%9F%B7%E8%A1%8C.html" data-bs-toggle="tooltip" title="1.3 åŸ·è¡Œ">1.3 åŸ·è¡Œ</a></li>
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_5_%E7%B7%A8%E7%A2%BC.html" data-bs-toggle="tooltip" title="1.5 ç·¨ç¢¼">1.5 ç·¨ç¢¼</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/2_1_%E8%AE%80%E6%AA%94%E5%AF%AB%E6%AA%94.html" data-bs-toggle="tooltip" title="2.1 è®€æª”å¯«æª”">2.1 è®€æª”å¯«æª”</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/2_2_data_explorer.html" data-bs-toggle="tooltip" title="2.2 data explorer">2.2 data explorer</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/2_3_data_explorer.html" data-bs-toggle="tooltip" title="2.3 data explorer">2.3 data explorer</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/3_quickview1.html" data-bs-toggle="tooltip" title="3. Quick view 1">3. Quick view 1</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/3_01_regular_expression.html" data-bs-toggle="tooltip" title="3.1 Regular expression syntax">3.1 Regular expression syntax</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/3_02_regular%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" title="3.02.regularç·´ç¿’">3.02.regularç·´ç¿’</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_1_1_type_basic.html" data-bs-toggle="tooltip" title="4.1.1 type basic">4.1.1 type basic</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_1_2_type%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" title="4.1.2_typeç·´ç¿’">4.1.2_typeç·´ç¿’</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_1_3_type_list.html" data-bs-toggle="tooltip" title="4.1.3 type list">4.1.3 type list</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_1_4_type_more.html" data-bs-toggle="tooltip" title="4.1.4 type more">4.1.4 type more</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_2_type_post.html" data-bs-toggle="tooltip" title="4.2 type post">4.2 type post</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_3_type_matrix.html" data-bs-toggle="tooltip" title="4.3 type matrix">4.3 type matrix</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_3_a_type_matrix.html" data-bs-toggle="tooltip" title="4.3-a type matrix">4.3-a type matrix</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_4_type_string_function.html" data-bs-toggle="tooltip" title="4.4 type string">4.4 type string</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_4_1_json.html" data-bs-toggle="tooltip" title="4.4.1 json">4.4.1 json</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_5_type_vector.html" data-bs-toggle="tooltip" title="4.5 type vector">4.5 type vector</a></li>
    
  
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/6_programming_1.html" data-bs-toggle="tooltip" title="6. Programming 1">6. Programming 1</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/7_function_1.html" data-bs-toggle="tooltip" title="7 Function basic">7 Function basic</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/7_1_apply_family.html" data-bs-toggle="tooltip" title="7.1 function - apply family">7.1 function - apply family</a></li>
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/8_1_%E8%87%AA%E8%A3%BD%E5%A5%97%E4%BB%B6.html" data-bs-toggle="tooltip" title="8.1. è‡ªè£½å¥—ä»¶">8.1. è‡ªè£½å¥—ä»¶</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/9_plot01.html" data-bs-toggle="tooltip" title="9. Plot 01">9. Plot 01</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/9_1_plot02.html" data-bs-toggle="tooltip" title="9.1 Plot more">9.1 Plot more</a></li>
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/11_00_sampling.html" data-bs-toggle="tooltip" title="11. sampling">11. sampling</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/11_environments.html" data-bs-toggle="tooltip" title="11 Environments">11 Environments</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/13_0_eco_01_intro.html" data-bs-toggle="tooltip" title="13. Econometrics">13. Econometrics</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/14_00_sim_1.html" data-bs-toggle="tooltip" title="14. simulation 1">14. simulation 1</a></li>
    
  
    
  <li>

 


<li class="nav-item" data-bs-toggle="tooltip" title="æš«æ™‚">
     

  <a class="nav-link" 
    href="../rlang/demo.html"><i class="far fa-folder"></i>æš«æ™‚  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f03d3d24b564dd9c39af6eb86300021f" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_f03d3d24b564dd9c39af6eb86300021f"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_"> 
    

  
  
  
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/demo/citation.html" data-bs-toggle="tooltip" title="å¼•ç”¨">å¼•ç”¨</a></li>
    </ul>
  

</li>   
     
  
</li>
    
  <li>

 


<li class="nav-item" data-bs-toggle="tooltip" title="ç·´ç¿’ç”¨">
     

  <a class="nav-link" 
    href="../rlang/hw.html"><i class="far fa-folder"></i>ç·´ç¿’ç”¨  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_b4809f6375b9dda8660e4938c2644e82" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_b4809f6375b9dda8660e4938c2644e82"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/hw_basic.html" data-bs-toggle="tooltip" title="assignment-1">assignment-1</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/hw_regexp.html" data-bs-toggle="tooltip" title="regexpr">regexpr</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/hw_filesystem.html" data-bs-toggle="tooltip" title="æª”æ¡ˆç³»çµ±">æª”æ¡ˆç³»çµ±</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/dataset_class.html" data-bs-toggle="tooltip" title="è³‡æ–™é›†">è³‡æ–™é›†</a></li>
    </ul>
  

</li>   
     
  
</li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/resources.html" data-bs-toggle="tooltip" title="ç·´ç¿’ç›¸é—œæª”æ¡ˆ">ç·´ç¿’ç›¸é—œæª”æ¡ˆ</a></li>
    </ul>
  

</li>   
     
  

        
          
          

 


<li class="nav-item" data-bs-toggle="tooltip" title="åŸºç¤è¨ˆé‡">
     

  <a class="nav-link" 
    href="../economics.html"><i class="far fa-folder"></i>åŸºç¤è¨ˆé‡  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_730f0eb5dc4c58ad3a9e95566d43ba9e" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_730f0eb5dc4c58ad3a9e95566d43ba9e"  
  class="submenu collapse" 
  data-bs-parent="#home-topics"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../economics/mc_%E5%9F%BA%E6%9C%AC.html" data-bs-toggle="tooltip" title="MC_åŸºæœ¬">MC_åŸºæœ¬</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../economics/mpg.html" data-bs-toggle="tooltip" title="mpg">mpg</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../economics/%E5%89%8D%E7%BD%AE.html" data-bs-toggle="tooltip" title="å‰ç½®æº–å‚™">å‰ç½®æº–å‚™</a></li>
    </ul>
  

</li>   
     
  

        
          
          

 


<li class="nav-item" data-bs-toggle="tooltip" title="å°ˆé¡Œ">
     

  <a class="nav-link" 
    href="../topic.html"><i class="far fa-folder"></i>å°ˆé¡Œ  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f7b6d4231ab239a316b7f2d9edf32817" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_f7b6d4231ab239a316b7f2d9edf32817"  
  class="submenu collapse" 
  data-bs-parent="#home-topics"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/interesting.html" data-bs-toggle="tooltip" title="interesting">interesting</a></li>
    
  
    
  
    
  <li>

 


<li class="nav-item" data-bs-toggle="tooltip" title="å¯¦é©—">
     

  <a class="nav-link" 
    href="../topic/experiment.html"><i class="far fa-folder"></i>å¯¦é©—  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_0978ab1a6384269bbc2979cd5798a24f" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_0978ab1a6384269bbc2979cd5798a24f"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_f7b6d4231ab239a316b7f2d9edf32817"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/experiment/central.html" data-bs-toggle="tooltip" title="ä¸­å¤®">ä¸­å¤®</a></li>
    </ul>
  

</li>   
     
  
</li>
    
  
    </ul>
  

</li>   
     
  

          
        
  </ul> 

    
    

    <hr/>
    <section id="footer">
      æœ€è¿‘3ç¯‡<br/><ul><li><a href="../rlang/1_5_%E7%B7%A8%E7%A2%BC.html"> <i class="far fa-clock" ></i>1.5 ç·¨ç¢¼[2021-09-29 PM 09:38]</a></li><li><a href="../rlang/2_1_%E8%AE%80%E6%AA%94%E5%AF%AB%E6%AA%94.html"> <i class="far fa-clock" ></i>2.1 è®€æª”å¯«æª”[2021-09-25 PM 10:54]</a></li><li><a href="../rlang/4_1_2_type%E7%B7%B4%E7%BF%92.html"> <i class="far fa-clock" ></i>4.1.2_typeç·´ç¿’[2021-09-25 PM 06:06]</a></li></ul>
    </section>
  
</nav><article class="article mx-2 mt-3" id="body-inner">
    <h1 id="functions">Functions</h1>
<h2 id="introduction">Introduction</h2>
<p>ç°¡å–®æ¸¬è©¦</p>
<h3 id="quiz">Quiz</h3>
<p>Answer the following questions to see if you can safely skip this chapter. You can find the answers in <a href="#function-answer">function-answer</a>.</p>
<ol type="1">
<li><p>What are the three components of a function?</p></li>
<li><p>What does the following code return?</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>() {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">+</span> <span class="dv">10</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">f1</span>(<span class="dv">1</span>)()</span></code></pre></div></li>
<li><p>How would you usually write this code?</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">1</span>, <span class="st">`</span><span class="at">*</span><span class="st">`</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span></code></pre></div></li>
<li><p>How could you make this call easier to read?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(, <span class="cn">TRUE</span>, <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>))</span></code></pre></div></li>
<li><p>Does the following code throw an error when executed? Why/why not?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  a <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">f2</span>(<span class="dv">10</span>, <span class="fu">stop</span>(<span class="st">&quot;This is an error!&quot;</span>))</span></code></pre></div></li>
<li><p>What is an infix function? How do you write it? Whatâ€™s a replacement function? How do you write it?</p></li>
<li><p>How do you ensure that cleanup action occurs regardless of how a function exits?</p></li>
</ol>
<h3 id="outline">Outline</h3>
<ul>
<li>Section <a href="#function-fundamentals">Function fundamentals</a> describes the basics of creating a function, the three main components of a function, and the exception to many function rules: primitive functions (which are implemented in C, not R).</li>
<li>Section <a href="#lexical-scoping">lexical scoping</a> shows you how R finds the value associated with a given name, i.e.Â the rules of lexical scoping.</li>
<li>Section <a href="#lazy-evaluation">lazy evaluation</a> is devoted to an important property of function arguments: they are only evaluated when used for the first time.</li>
<li>Section <a href="#exiting-a-function">existing a function</a> discusses the two primary ways that a function can exit, and how to define an exit handler, code that is run on exit, regardless of what triggers it.</li>
<li>Section <a href="#function-forms">function-forms</a> shows you the various ways in which R disguises ordinary function calls, and how you can use the standard prefix form to better understand whatâ€™s going on.</li>
</ul>
<h2 id="function-fundamentals">Function fundamentals</h2>
<p>å¹¾å€‹é‡è¦è§€å¿µ</p>
<ul>
<li>å‡½æ•¸ä¹Ÿæ˜¯ç‰©ä»¶,å°±åƒæ˜¯vectors ä¹Ÿæ˜¯ç‰©ä»¶ã€‚</li>
<li>ç”±ä¸‰å€‹éƒ¨ä»½çµ„æˆ: arguments, body, and environment.</li>
</ul>
<p>ä½†æ˜¯è¦å‰‡éƒ½æœƒè¢«æ‰“ç ´,ä¾‹å¤–å¤§æ¦‚éƒ½åˆ©ç”¨Cå¯«æˆçš„ â€œprimitiveâ€ base functionsã€‚</p>
<h3 id="first-class-functions">First-class functions</h3>
<p>åœ¨Rä¸­,å‡½æ•¸ä¹Ÿæ˜¯ç‰©ä»¶,é€™ç¨®ç‰¹æ€§ä¹Ÿå«åš â€œfirst-class functionsâ€. å¦‚ä¸‹:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>f01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sin</span>(<span class="dv">1</span> <span class="sc">/</span> x <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="diagrams/functions/first-class.png" style="display: block; margin: auto;" /></p>
<p>åŒ¿åå‡½æ•¸:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(mtcars, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Filter</span>(<span class="cf">function</span>(x) <span class="sc">!</span><span class="fu">is.numeric</span>(x), mtcars)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">integrate</span>(<span class="cf">function</span>(x) <span class="fu">sin</span>(x) <span class="sc">^</span> <span class="dv">2</span>, <span class="dv">0</span>, pi)</span></code></pre></div>
<p>åœ¨listä¸­,ä¹Ÿå¯ä»¥æ”¾å…¥å‡½æ•¸:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>funs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">half =</span> <span class="cf">function</span>(x) x <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">double =</span> <span class="cf">function</span>(x) x <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>funs<span class="sc">$</span><span class="fu">double</span>(<span class="dv">10</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 20</span></span></code></pre></div>
<p>åœ¨Rèªè¨€ä¸­,å‡½æ•¸æœ‰æ™‚å«åšclosureå› ç‚º,Rå‡½æ•¸åŒ…å«(enclose)å®ƒå€‘çš„ç’°å¢ƒ environments.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(f01)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;closure&quot;</span></span></code></pre></div>
<h3 id="function-components">Function components</h3>
<p>1å€‹å‡½æ•¸æœ‰3å€‹éƒ¨åˆ†:</p>
<ul>
<li><code>formals()</code>, åƒæ•¸</li>
<li><code>body()</code>, {}å…§éƒ¨.</li>
<li><code>environment()</code>, æ±ºå®šå‡½æ•¸æ€æ¨£æ‰¾å‡ºè®Šæ•¸(names)çš„å…§å®¹ã€‚.</li>
</ul>
<p><img src="diagrams/functions/components.png" style="display: block; margin: auto;" /></p>
<p>æ¸¬è©¦3éƒ¨åˆ†</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>f02 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># A comment</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(f02)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $x</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(f02)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     x^2</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(f02)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: R_GlobalEnv&gt;</span></span></code></pre></div>
<div data-nopre class="expand">
    <div data-nopre class="expand-label" onclick="vexpand(this)">
        <i data-nopre style="font-size:x-small;color:yellow" class="fa fa-chevron-right"></i>
        <span data-nopre >:?:</span>
    </div><div data-nopre class="expand-content incode" style="overflow-x:auto"> å‡½æ•¸çš„environment éƒ½æœƒå­˜åœ¨,ä½†æ˜¯åœ¨æ•´é«”ç’°å¢ƒä¸­å®šç¾©çš„å‡½æ•¸,ä¸æœƒè¢«é¡¯ç¤ºã€‚
ä¸Šé¢çš„environment(f02)æœ‰é¡¯ç¤ºenvironment. why()?</div></div>
<p>ğŸ‘å°±åƒæ‰€ä»¥å…¶ä»–Rçš„ç‰©ä»¶,å‡½æ•¸ä¹Ÿæœ‰å¾ˆå¤š <code>attributes()</code>. å…¶ä¸­ä¸€å€‹ â€œsrcrefâ€, æ˜¯ source referenceçš„ç¸®å¯«ã€‚ ã€€</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(f02, <span class="st">&quot;srcref&quot;</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function(x) {</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   # A comment</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x ^ 2</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<h3 id="primitive-functions">Primitive functions</h3>
<p>ï¼“å€‹çµ„ä»¶çš„è¦å‰‡æœ‰ä¾‹å¤–ï¼Œåƒæ˜¯ Primitive functions, like <code>sum()</code> and <code>[</code>, ç›´æ¥èª¿ç”¨ï¼£èªè¨€ã€‚</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sum</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (..., na.rm = FALSE)  .Primitive(&quot;sum&quot;)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">[</span><span class="st">`</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; .Primitive(&quot;[&quot;)</span></span></code></pre></div>
<p>çœ‹ä¸€ä¸‹type åˆ†åˆ¥å±¬æ–¼ â€œbuiltinâ€ or â€œspecialâ€:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(sum)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;builtin&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="st">`</span><span class="at">[</span><span class="st">`</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;special&quot;</span></span></code></pre></div>
<p>å› æ­¤ï¼Œ <code>formals()</code>, <code>body()</code>, and <code>environment()</code> éƒ½å›å‚³ <code>NULL</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(sum)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(sum)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(sum)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>é€™äº›æ‰€è¬‚çš„åŸå§‹å‡½æ•¸ï¼Œåªå­˜åœ¨æ–¼åŸºæœ¬å¥—ä»¶(base packages) ã€‚.</p>
<h3 id="exercises">Exercises</h3>
<ol type="1">
<li><p>Itâ€™s possible (although typically not useful) to call an anonymous function. Which of the two approaches below is correct? Why?</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x) <span class="dv">3</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function(x) 3()</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>(<span class="cf">function</span>(x) <span class="dv">3</span>)()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span></code></pre></div></li>
<li><p>A good rule of thumb is that an anonymous function should fit on one line and shouldnâ€™t need to use <code>{}</code>.</p></li>
<li><p>This code makes a list of all functions in the base package.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>objs <span class="ot">&lt;-</span> <span class="fu">mget</span>(<span class="fu">ls</span>(<span class="st">&quot;package:base&quot;</span>), <span class="at">inherits =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>funs <span class="ot">&lt;-</span> <span class="fu">Filter</span>(is.function, objs)</span></code></pre></div>
<p>Use it to answer the following questions:</p>
<ol type="a">
<li>Which base function has the most arguments?</li>
<li>How many base functions have no arguments? Whatâ€™s special about those functions?</li>
<li>How could you adapt the code to find all primitive functions?</li>
</ol></li>
<li><p>What are the three important components of a function?</p></li>
<li><p>When does printing a function not show the environment it was created in?</p></li>
</ol>
<h2 id="lexical-scoping">Lexical scoping</h2>
<p>In [Names and values], we discussed assignment, the act of binding a name to a value. Here weâ€™ll discuss <strong>scoping</strong>, the act of finding the value associated with a name.</p>
<p>ä¸‹é¢çš„åŸ·è¡Œçµæœå‚³å›10é‚„æ˜¯20?</p>
<div data-nopre class="expand">
    <div data-nopre class="expand-label" onclick="vexpand(this)">
        <i data-nopre style="font-size:x-small;color:yellow" class="fa fa-chevron-right"></i>
        <span data-nopre >answer</span>
    </div><div data-nopre class="expand-content incode" style="overflow-x:auto"> `20`.</div></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>g01 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">g01</span>()</span></code></pre></div>
<p>äº†è§£ç¯„åœè¦å‰‡,æœ‰åŠ©æ–¼å‡½æ•¸çš„æ¨¡çµ„é–‹ç™¼,ç”šè‡³æœ‰åŠ©æ–¼å°‡Rç¿»è­¯åˆ°å…¶ä»–èªè¨€ã€‚</p>
<p><em>lexical scoping</em>ã€€<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>: it looks up the values of names based on how a function is defined, not how it is called. â€œLexicalâ€ here is not the English adjective â€œrelating to words or a vocabularyâ€. Itâ€™s a technical CS term that tells us that the scoping rules use a parse-time, rather than a run-time structure.</p>
<p>Rçš„â€™s lexical scoping éµå¾ª4å€‹ä¸»è¦è¦å‰‡::</p>
<ul>
<li>Name masking</li>
<li>Functions vs.Â variables</li>
<li>A fresh start</li>
<li>Dynamic lookup</li>
</ul>
<h3 id="name-masking">Name masking</h3>
<p>å…§éƒ¨ç¯„åœçš„å®£å‘Š(ç¬¬ä¸€æ¬¡ä½¿ç”¨)è¦†è“‹å¤–éƒ¨ç¯„åœçš„å®£å‘Šã€‚.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>g02 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(x, y)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">g02</span>()</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1 2</span></span></code></pre></div>
<p>å¦‚æœåœ¨å…§éƒ¨å®£å‘Šæ‰¾ä¸åˆ°,å°±æ‰¾å¤–ä¸€å±¤ï¼Œä¸€ç›´åˆ°global environmentã€‚</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>g03 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(x, y)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">g03</span>()</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2 1</span></span></code></pre></div>
<p>ä¸Šé¢çš„è¦å‰‡ä»ç„¶é©ç”¨æ–¼å‡½æ•¸ä¸­çš„å‡½æ•¸.</p>
<p>æ¸¬è©¦:ä¸‹é¢çš„Rç¨‹å¼æœƒæœ‰ç”šéº¼çµæœ ? <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>g04 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(x, y, z)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">i</span>()</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">g04</span>()</span></code></pre></div>
<p>åŒæ¨£ä¹Ÿé©ç”¨æ–¼å»ºç«‹å‡½æ•¸çš„å‡½æ•¸( <strong>closures</strong>).åƒè€ƒ [closures]; é€™è£¡åªæ˜¯ç”¨ä¾†èªªæ˜ä¸Šè¿°è¦å‰‡çš„ä½¿ç”¨ã€‚ <code>g05()</code>, å‚³å›å‡½æ•¸,çŒœçŒœåŸ·è¡Œçµæœ?<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>g05 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>() {</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(x, y)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>g06 <span class="ot">&lt;-</span> <span class="fu">g05</span>()</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">g06</span>()</span></code></pre></div>
<p>This seems a little magical: how does R know what the value of <code>y</code> is after <code>j()</code> has returned? It works because <code>k</code> preserves the environment in which it was defined and because the environment includes the value of <code>y</code>. Youâ€™ll learn more about how environments work in <a href="#environments">Environments</a>.</p>
<h3 id="functions-vs.-variables">Functions vs.Â variables</h3>
<p>æ—¢ç„¶å‡½æ•¸ä¹Ÿåªæ˜¯æ™®é€šçš„ç‰©ä»¶,é‚£éº¼åŒæ¨£çš„åç¨±å°‹æ‰¾è¦å‰‡ä¹Ÿé©ç”¨æ–¼å‡½æ•¸:é€™å€‹ä¾‹å­ä¸­,g07åœ¨å¤–éƒ¨å’Œå…§éƒ¨çš†æœ‰å®šç¾©ã€‚</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>g07 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>g08 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  g07 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g07</span>(<span class="dv">10</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">g08</span>()</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 110</span></span></code></pre></div>
<p>ä½†æ˜¯å¦‚æœåŒä¸€å€‹åç¨±,åœ¨ä¸åŒç¯„åœæœ‰ä¸ä¸€æ¨£çš„å‹æ…‹å‘¢?ä¾‹å¦‚g9ä¸€å€‹æ˜¯è®Šæ•¸,ä¸€å€‹æ˜¯å‡½æ•¸:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>g09 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>g10 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  g09 <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g09</span>(g09)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">g10</span>()</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 110</span></span></code></pre></div>
<p>ä¸€èˆ¬ä¾†è¬›,ä¸Šé¢çš„ç”¨æ³•åœ¨èªæ³•ä¸Šæ˜¯æ²’å•é¡Œ,ä½†æ˜¯æœ€å¥½é¿å…ã€‚</p>
<h3 id="fresh-start">A fresh start</h3>
<p>ç¬¬ä¸€æ¬¡åŸ·è¡Œå’Œç¬¬äºŒæ¬¡åŸ·è¡Œæœ‰ç”šéº¼ä¸åŒ?<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>å‡½æ•¸ <code>exists(x)</code> :æœƒå°‹æ‰¾è®Šæ•¸åç¨±xæ˜¯å¦å­˜åœ¨,å­˜åœ¨å‰‡ç„¡å› <code>TRUE</code>,å¦å‰‡å‚³å› <code>FALSE</code>.)</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>g11 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">&quot;a&quot;</span>)) {</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> a <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  a</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">g11</span>()</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">g11</span>()</span></code></pre></div>
<p>æ¯æ¬¡åŸ·è¡Œg11()çš„æ™‚å€™,ä¸€å€‹æ–°çš„environmentæœƒè¢«å»ºç«‹,ä¹Ÿå°±æ˜¯é€™å€‹å‡½æ•¸çš„<strong>å±€éƒ¨ç©ºé–“</strong>ã€‚ é€™å€‹å±€éƒ¨ç©ºé–“æœƒåœ¨å‡½æ•¸çµæŸçš„æ™‚å€™æ¶ˆå¤±ã€‚</p>
<h3 id="dynamic-lookup">Dynamic lookup</h3>
<p>ä½†æ˜¯å¦‚æœå‡½æ•¸åŸ·è¡Œçš„æ™‚å€™ç”¨å€’åœ¨å±€éƒ¨ç’°å¢ƒæ‰¾ä¸åˆ°çš„è®Šæ•¸çš„æ™‚å€™,æœƒç›®å‰çš„ç¸½é«”ç’°å¢ƒ(ä¹Ÿå°±æ˜¯å‡½æ•¸æ‰€åœ¨çš„ç’°å¢ƒ)æ‰¾è®Šæ•¸å€¼ã€‚</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>g12 <span class="ot">&lt;-</span> <span class="cf">function</span>() x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">g12</span>()</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 16</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">g12</span>()</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 21</span></span></code></pre></div>
<p>ä¸Šé¢çš„ç¸½é«”ç’°å¢ƒåŒ…å«äº†å…©å€‹è®Šæ•¸,ä¸€å€‹æ˜¯å‡½æ•¸<code>g12()</code>,ä¸€å€‹æ˜¯è®Šæ•¸<code>x</code>:<br />
- g12() - x</p>
<p>å¦‚æœè¦æª¢æŸ¥å‡½æ•¸çš„è®Šæ•¸åƒè€ƒæ˜¯ä¸æ˜¯æœ‰å•é¡Œ,å¯ä»¥ä½¿ç”¨å·¥å…· <code>codetools::findGlobals()</code>. This function lists all the external dependencies (unbound symbols) within a function:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>codetools<span class="sc">::</span><span class="fu">findGlobals</span>(g12)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;+&quot; &quot;x&quot;</span></span></code></pre></div>
<p>Another way to solve the problem would be to manually change the environment of the function to the <code>emptyenv()</code>, an environment which contains nothing:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(g12) <span class="ot">&lt;-</span> <span class="fu">emptyenv</span>()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">g12</span>()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in x + 1: æ²’æœ‰é€™å€‹å‡½å¼ &quot;+&quot;</span></span></code></pre></div>
<h3 id="exercises-1">Exercises</h3>
<ol type="1">
<li><p>What does the following code return? Why? Describe how each of the three <code>c</code>â€™s is interpreted.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">c =</span> c)</span></code></pre></div></li>
<li><p>What are the four principles that govern how R looks for values?</p></li>
<li><p>What does the following function return? Make a prediction before running the code yourself.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f</span>() <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(x) <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">10</span>)</span></code></pre></div></li>
</ol>
<h2 id="lazy-evaluation">Lazy evaluation</h2>
<p>In R, function arguments are <strong>lazily evaluated</strong>: theyâ€™re only evaluated if accessed. For example, this code doesnâ€™t generate an error because <code>x</code> is never used:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>h01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">h01</span>(<span class="fu">stop</span>(<span class="st">&quot;This is an error!&quot;</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<p>This is an important feature because it allows you to do things like include potentially expensive computations in function arguments that will only be evaluated if needed.</p>
<h3 id="forcing-evaluation">Forcing evaluation</h3>
<p>To <strong>compel</strong> the evaluation of an argument, use <code>force()</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>h02 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">force</span>(x)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">h02</span>(<span class="fu">stop</span>(<span class="st">&quot;This is an error!&quot;</span>))</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in force(x): This is an error!</span></span></code></pre></div>
<p>It is usually not necessary to force evaluation. Itâ€™s needed primarily for certain functional programming techniques which weâ€™ll cover in detail in [function operators]. Here, I want to show you the basic issue.</p>
<p>Take this small but surprisingly tricky function. It takes a single argument <code>x</code>, and returns a function that returns <code>x</code> when called.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>capture1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>() {</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Thereâ€™s a subtle issue with this function: the value of <code>x</code> will be captured not when you call <code>capture()</code>, but when you call the function that <code>capture()</code> returns:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>h03 <span class="ot">&lt;-</span> <span class="fu">capture1</span>(x)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>h04 <span class="ot">&lt;-</span> <span class="fu">capture1</span>(x)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">h03</span>()</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="fu">h04</span>()</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 20</span></span></code></pre></div>
<p>Even more confusingly this only happens once: the value is locked in after you have called <code>h03()</code>/<code>h04()</code> for the first time.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h03</span>()</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">h04</span>()</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 20</span></span></code></pre></div>
<p>This behaviour is a consequence of lazy evaluation. The <code>x</code> argument is evaluated once <code>h03()</code>/<code>h04()</code> is called, and then its value is cached. We can avoid the confusion by forcing <code>x</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>capture2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">force</span>(x)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>() {</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>h05 <span class="ot">&lt;-</span> <span class="fu">capture2</span>(x)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="fu">h05</span>()</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<h3 id="promises-skip">Promises (skip)</h3>
<p>Lazy evaluation is powered by a data structure called a <strong>promise</strong>, or (less commonly) a thunk. Weâ€™ll come back to this data structure in <a href="#meta">metaprogramming</a> because itâ€™s one of the features of R that makes it most interesting as a programming language.</p>
<p>A promise has three components:</p>
<ul>
<li><p>The expression, like <code>x + y</code> which gives rise to the delayed computation.</p></li>
<li><p>The environment where the expression should be evaluated.</p></li>
<li><p>The value, which is computed and cached when the promise is first accessed by evaluating the expression in the specified environment.</p></li>
</ul>
<p>The value cache ensures that accessing the promise multiple times always returns the same value. For example, you can see in the following code that <code>runif(1)</code> is only evaluated once:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>h06 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(x, x, x)  </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">h06</span>(<span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.04424216 0.04424216 0.04424216</span></span></code></pre></div>
<p>You can also create promises â€œby handâ€ using <code>delayedAssign()</code>:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">delayedAssign</span>(<span class="st">&quot;x&quot;</span>, {<span class="fu">print</span>(<span class="st">&quot;Executing code&quot;</span>); <span class="fu">runif</span>(<span class="dv">1</span>)})</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Executing code&quot;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.5043286</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.5043286</span></span></code></pre></div>
<p>Youâ€™ll see this idea again in [advanced bindings].</p>
<h3 id="default-arguments">Default arguments</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>h07 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> x <span class="sc">*</span> <span class="dv">2</span>) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(x, y)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">h07</span>()</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1 2</span></span></code></pre></div>
<h3 id="missing-arguments">Missing arguments</h3>
<p>åˆ¤æ–·åƒæ•¸å…§å®¹ä¾†è‡ªä½¿ç”¨è€…æˆ–è€…é è¨­çš„å‡½æ•¸: <code>missing()</code>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>h09 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="dv">10</span>) {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="fu">missing</span>(x), x)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">h09</span>()) <span class="co"># é è¨­</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 2</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : logi TRUE</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : num 10</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">h09</span>(<span class="dv">10</span>)) <span class="co"># ä½¿ç”¨è€…</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 2</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : logi FALSE</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : num 10</span></span></code></pre></div>
<h2 id="exiting-a-function">Exiting a function</h2>
<p>Most functions exit in one of two ways<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>: either returning a value, indicating successful completion, or throwing an error, indicating failure. This section describes return values (implicit vs.Â explicit; visible vs.Â invisible), briefly discusses errors, and introduces exit handlers, which allow you to run code when a function exits, regardless of how it exits.</p>
<h3 id="implicit-vs.-explict-returns">Implicit vs.Â explict returns</h3>
<p>There are two ways that a function can return a value:</p>
<ul>
<li><p>Implicitly, where the last evaluated expression becomes the return value:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>j01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">10</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">5</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 52</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">15</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 452</span></span></code></pre></div></li>
<li><p>Explicitly, by calling <code>return()</code>:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>j02 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">10</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
</ul>
<h3 id="invisible-values">Invisible values</h3>
<p>å¤§éƒ¨åˆ†å‡½æ•¸å†å‚³å›å€¼çš„æ™‚å€™éƒ½æœƒé¡¯ç¤ºåœ¨ä¸»æ§å°ä¸Š:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>j03 <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="dv">1</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">j03</span>()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>ä½†æ˜¯ä¹Ÿå¯ä»¥ä¸ç”¨é¡¯ç¤º:åˆ©ç”¨å‡½æ•¸ <code>invisible()</code>ã€‚</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>j04 <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="fu">invisible</span>(<span class="dv">1</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">j04</span>()</span></code></pre></div>
<p>é€™ç¨®ä¸æœƒé¡¯ç¤ºå‚³å›å€¼çš„å‡½æ•¸,å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•é©—è­‰:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">j04</span>())</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>(<span class="fu">j04</span>())</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>æˆ–è€…åˆ©ç”¨å‡½æ•¸ `withVisible():</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">withVisible</span>(<span class="fu">j04</span>()))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 2</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ value  : num 1</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ visible: logi FALSE</span></span></code></pre></div>
<p>æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯ <code>&lt;-</code>:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>(a <span class="ot">&lt;-</span> <span class="dv">2</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>ä¹Ÿå› æ­¤å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„ä¸²è¯æŒ‡æ´¾:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> b <span class="ot">&lt;-</span> c <span class="ot">&lt;-</span> d <span class="ot">&lt;-</span> <span class="dv">2</span></span></code></pre></div>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œåƒæ˜¯ (like <code>&lt;-</code>, <code>print()</code>, or <code>plot()</code>) éƒ½æ˜¯å‚³å›ä¸å¯è¦‹çµæœã€‚</p>
<h3 id="errors">Errors</h3>
<p>å‡½æ•¸å¯ä»¥åˆ©ç”¨å‡½æ•¸ <code>stop()</code>çµæŸä¸€å€‹å‡½æ•¸çš„åŸ·è¡Œã€‚</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>j05 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;I&#39;m an error&quot;</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">10</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">j05</span>()</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in j05(): I&#39;m an error</span></span></code></pre></div>
<h3 id="on-exit">Exit handlers</h3>
<p>Sometimes a function needs to make a temporary change to global state and you want to ensure those changes are restored when the function completes. Itâ€™s painful to make sure you cleanup before any explicit return, and what happens if thereâ€™s an error? Instead, you can set up an <strong>exiting handler</strong> that is called when the function terminates, regardless of whether it returns a value or throws an error.</p>
<p>To setup an exiting handler, call <code>on.exit()</code> with the code to be run. It will execute when the function exits, regardless of what causes it to exit:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>j06 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Hello</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">cat</span>(<span class="st">&quot;Goodbye!</span><span class="sc">\n</span><span class="st">&quot;</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x) {</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">10</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Error&quot;</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="cn">TRUE</span>)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="cn">FALSE</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<div class="notices">
    <div class= sidebar>
        Always set <code>add = TRUE</code> when using <code>on.exit()</code>. If you don't, each call to <code>on.exit()</code> will overwrite the previous exiting handler. Even when only registering a single handler, it's good practice to  set <code>add = TRUE</code> so that you don't get an unpleasant surprise if you later add more exit handlers
    </div>
</div>

<p><code>on.exit()</code> is important because it allows you to place clean-up actions next to actions with their cleanup operations.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>cleanup <span class="ot">&lt;-</span> <span class="cf">function</span>(dir, code) {</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  old_dir <span class="ot">&lt;-</span> <span class="fu">setwd</span>(dir)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">setwd</span>(old), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  old_opt <span class="ot">&lt;-</span> <span class="fu">options</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">options</span>(old_opt), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>When coupled with lazy evaluation, this leads to a very useful pattern for running a block of code in an altered environment:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>with_dir <span class="ot">&lt;-</span> <span class="cf">function</span>(dir, code) {</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  old <span class="ot">&lt;-</span> <span class="fu">setwd</span>(dir)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">setwd</span>(old), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">force</span>(code)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;D:/work/rmi_r/content/rlang&quot;</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="fu">with_dir</span>(<span class="st">&quot;~&quot;</span>, <span class="fu">getwd</span>())</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;C:/Users/linchao/Documents&quot;</span></span></code></pre></div>
<p>See the <a href="http://withr.r-lib.org">withr package</a> for a collection of functions of this nature.</p>
<p>In R 3.4 and prior, <code>on.exit()</code> expressions are always run in the order in which they are created:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">message</span>(<span class="st">&quot;a&quot;</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">message</span>(<span class="st">&quot;b&quot;</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; a</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; b</span></span></code></pre></div>
<p>This can make cleanup a little tricky if some actions need to happen in a specific order; typically you want the most recent added expression to be run first. In R 3.5 and later, you can control this by setting <code>after = FALSE</code>:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">message</span>(<span class="st">&quot;a&quot;</span>), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">after =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">message</span>(<span class="st">&quot;b&quot;</span>), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">after =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; b</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; a</span></span></code></pre></div>
<h3 id="exercises-2">Exercises</h3>
<ol type="1">
<li><p>What does <code>load()</code> return? Why donâ€™t you normally see these values?</p></li>
<li><p>What does <code>write.table()</code> return? What would be more useful?</p></li>
<li><p>How does the <code>chdir</code> parameter of <code>source()</code> compare to <code>in_dir()</code>? Why might you prefer one approach to the other?</p></li>
<li><p>Write a function that opens a graphics device, runs the supplied code, and closes the graphics device (always, regardless of whether or not the plotting code worked).</p></li>
<li><p>We can use <code>on.exit()</code> to implement a simple version of <code>capture.output()</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>capture.output2 <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">file.remove</span>(temp), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">after =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sink</span>(temp)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">sink</span>(), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">after =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">force</span>(code)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readLines</span>(temp)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="fu">capture.output2</span>(<span class="fu">cat</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in file.remove(temp): ç„¡æ³•ç§»é™¤æª”æ¡ˆ &#39;C:</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; \Users\linchao\AppData\Local\Temp\Rtmp4Siasm\file55a06181ad6&#39; ï¼ŒåŸå› æ˜¯</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &#39;Permission denied&#39;</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span></code></pre></div>
<p>Compare <code>capture.output()</code> to <code>capture.output2()</code>. How do the functions differ? What features have I removed to make the key ideas easier to see? How have I rewritten the key ideas to be easier to understand?</p></li>
</ol>
<h2 id="function-forms-skip">Function forms (skip)</h2>
<blockquote>
<p>â€œTo understand computations in R, two slogans are helpful:</p>
<ul>
<li>Everything that exists is an object.</li>
<li>Everything that happens is a function call.â€</li>
</ul>
<p>â€” John Chambers</p>
</blockquote>
<p>While everything that happens in R is a result of a function call, not all calls look the same. Function calls come in four varieties:</p>
<ul>
<li><p>In <strong>prefix</strong> form, the function name comes before its arguments, like <code>foofy(a, b, c)</code>. These constitute of the majority of function calls in R.</p></li>
<li><p>In <strong>infix</strong> form, the function name comes inbetween its arguments, like <code>x + y</code>. Infix forms are used for many mathematical operators, as well as user-defined functions that begin and end with <code>%</code>.</p></li>
<li><p>A <strong>replacement</strong> function assigns into what looks like a prefix function, like <code>names(df) &lt;- c("a", "b", "c")</code>.</p></li>
<li><p><strong>Special forms</strong> like <code>[[</code>, <code>if</code>, and <code>for</code>, donâ€™t have a consistent structure and provide some of the most important syntax in R.</p></li>
</ul>
<p>While four forms exist, you only need to use one, because any call can be written in prefix form. Iâ€™ll demonstrate this property, and then youâ€™ll learn about each of the forms in turn.</p>
<h3 id="rewriting-to-prefix-form">Rewriting to prefix form</h3>
<p>An interesting property of R is every infix, replacement, or special form can be rewritten in prefix form. Rewriting in prefix form is useful because it helps you better understand the structure of the language, and it gives you the real name of every function. Knowing the real name of non-prefix functions is useful because it allows you to modify them for fun and profit.</p>
<p>The following example shows three pairs of equivalent calls, rewriting an infix form, replacement form, and a special form into prefix form.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">+</span> y</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(x, y)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(df, <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>))</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="fu">print</span>(i)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">for</span><span class="st">`</span>(i, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="fu">print</span>(i))</span></code></pre></div>
<p>Knowing the function name of a non-prefix function allows you to override its behaviour. For example, if youâ€™re ever feeling particularly evil, run the following code while a friend is away from their computer. It will introduce a fun bug: 10% of the time, 1 will be added to any numeric calculation inside of parentheses.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">(</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(e1) {</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(e1) <span class="sc">&amp;&amp;</span> <span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> <span class="fl">0.1</span>) {</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    e1 <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    e1</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="fu">replicate</span>(<span class="dv">50</span>, (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] 3 4 3 3 3 3 3 3 3 3 3 3 4 3 3 4 3 3 3 3 3 3 3 4 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [39] 3 3 3 3 3 3 3 3 3 3 3 3</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="st">&quot;(&quot;</span>)</span></code></pre></div>
<p>Of course, overriding built-in functions like this is a bad idea, but, as youâ€™ll learn about in [metaprogramming], itâ€™s possible to apply it only to selected code blocks. This provides a clean and elegant approach to writing domain specific languages and translators to other languages.</p>
<p>A more useful technique is to use this knowledge when using functional programming tools. For example, you could use <code>sapply()</code> to add 3 to every element of a list by first defining a function <code>add()</code>, like this:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>add <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) x <span class="sc">+</span> y</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, add, <span class="dv">3</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1]  4  5  6  7  8  9 10 11 12 13</span></span></code></pre></div>
<p>But we can also get the same effect more simply by relying on the existing <code>+</code> function:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">`</span><span class="at">+</span><span class="st">`</span>, <span class="dv">3</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 4 5 6 7 8</span></span></code></pre></div>
<p>Weâ€™ll explore this idea in detail in [functionals].</p>
<h3 id="prefix-form">Prefix form</h3>
<p>The prefix form å‡½æ•¸çš„é¡å‹é€šå¸¸æŒ‡çš„æ˜¯å‡½æ•¸åœ¨å‰é¢,ç„¶å¾Œå¾Œé¢æ¥åƒæ•¸,ä½¿ç”¨æ–¹å¼æœ‰ä¸‰ç¨®:</p>
<ul>
<li>By position, like <code>help(mean)</code>.</li>
<li>Using partial matching, like <code>help(to = mean)</code>.</li>
<li>By name, like <code>help(topic = mean)</code>.</li>
</ul>
<p>As illustrated by the following chunk, arguments are matched by exact name, then with unique prefixes, and finally by position.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>k01 <span class="ot">&lt;-</span> <span class="cf">function</span>(abcdef, bcde1, bcde2) {</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">a =</span> abcdef, <span class="at">b1 =</span> bcde1, <span class="at">b2 =</span> bcde2)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">k01</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 3</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ a : num 1</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ b1: num 2</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ b2: num 3</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">k01</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="at">abcdef =</span> <span class="dv">1</span>))</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 3</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ a : num 1</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ b1: num 2</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ b2: num 3</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Can abbreviate long argument names:</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">k01</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="at">a =</span> <span class="dv">1</span>))</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 3</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ a : num 1</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ b1: num 2</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ b2: num 3</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a><span class="co"># But this doesn&#39;t work because abbreviation is ambiguous</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">k01</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="at">b =</span> <span class="dv">1</span>))</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in k01(1, 3, b = 1): å¼•æ•¸ 3 æœ‰å¤šå€‹èˆ‡ä¹‹ç›¸å°æ‡‰çš„å½¢å¼å¼•æ•¸</span></span></code></pre></div>
<p>Generally, only use positional matching for the first one or two arguments; they will be the most commonly used, and most readers will know what they are. Avoid using positional matching for less commonly used arguments, and never use partial matching. See the tidyverse style guide, <a href="http://style.tidyverse.org/syntax.html#argument-names" class="uri">http://style.tidyverse.org/syntax.html#argument-names</a>, for more advice.</p>
<h3 id="infix-functions">Infix functions</h3>
<p>Rçš„å…§å»º infix operators: <code>:</code>, <code>::</code>, <code>:::</code>, <code>$</code>, <code>@</code>, <code>^</code>, <code>*</code>, <code>/</code>, <code>+</code>, <code>-</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code>, <code>!</code>, <code>&amp;</code>, <code>&amp;&amp;</code>, <code>|</code>, <code>||</code>, <code>~</code>, <code>&lt;-</code>, and <code>&lt;&lt;-</code>.</p>
<p>å»ºç«‹infixå‡½æ•¸,1)å…©å€‹åƒæ•¸,2)å‡½æ•¸åç¨±å…©é‚Šæœ‰<code>%</code>, base R ä¹Ÿé¡å¤–å®šç¾©äº† <code>%%</code>, <code>%*%</code>, <code>%/%</code>, <code>%in%</code>, <code>%o%</code>, and <code>%x%</code>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%+%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) <span class="fu">paste0</span>(a, b)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;new &quot;</span> <span class="sc">%+%</span> <span class="st">&quot;string&quot;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;new string&quot;</span></span></code></pre></div>
<p>The names of infix functions are more flexible than regular R functions: they can contain any sequence of characters except â€œ%â€. You will need to escape any special characters in the string used to define the function, but not when you call it:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">% %</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) <span class="fu">paste</span>(a, b)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%/</span><span class="sc">\\</span><span class="at">%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) <span class="fu">paste</span>(a, b)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;a&quot;</span> <span class="sc">% %</span> <span class="st">&quot;b&quot;</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a b&quot;</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;a&quot;</span> <span class="sc">%/\%</span> <span class="st">&quot;b&quot;</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a b&quot;</span></span></code></pre></div>
<p>Râ€™s default precedence rules mean that infix operators are composed from left to right:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%-%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, a, <span class="st">&quot; %-% &quot;</span>, b, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;a&quot;</span> <span class="sc">%-%</span> <span class="st">&quot;b&quot;</span> <span class="sc">%-%</span> <span class="st">&quot;c&quot;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;((a %-% b) %-% c)&quot;</span></span></code></pre></div>
<p>å…©å€‹ä¾‹å¤–çš„INFIXå‡½æ•¸å¯ä»¥åªæœ‰ä¸€åƒæ•¸: <code>+</code> and <code>-</code>.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">1</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -1</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span><span class="dv">10</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<h3 id="replacement-functions">Replacement functions</h3>
<p>Replacement functions çš„å‡½æ•¸åç¨±å¿…é ˆæ˜¯é¡ä¼¼ <code>xxx&lt;-</code>. å¿…é ˆè¦æœ‰å…©å€‹åƒæ•¸ <code>x</code> å’Œ <code>value</code>, ä¸”å¿…é ˆå›å‚³æ›´æ”¹éçš„ç‰©ä»¶ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­,å…é¸æˆ‘å€‘æ›´æ”¹å‘é‡çš„ç¬¬äºŒå€‹å…ƒç´ : :</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">second&lt;-</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, value) {</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  x[<span class="dv">2</span>] <span class="ot">&lt;-</span> value</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>ä½¿ç”¨æ–¹æ³•:åˆ©ç”¨ <code>&lt;-</code> çš„LHS:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">second</span>(x) <span class="ot">&lt;-</span> 5L</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1]  1  5  3  4  5  6  7  8  9 10</span></span></code></pre></div>
<p>I say they â€œactâ€ like they modify their arguments in place, because, as discussed in [Modify-in-place], they actually create a modified copy. We can see that by using <code>tracemem()</code>:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tracemem</span>(x)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;0x7ffae71bd880&gt;</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">second</span>(x) <span class="ot">&lt;-</span> 6L</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tracemem[0x7ffae71bd880 -&gt; 0x7ffae61b5480]: </span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tracemem[0x7ffae61b5480 -&gt; 0x7ffae73f0408]: second&lt;- </span></span></code></pre></div>
<p>If you want to supply additional arguments, they go inbetween <code>x</code> and <code>value</code>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">modify&lt;-</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, position, value) {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  x[position] <span class="ot">&lt;-</span> value</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">modify</span>(x, <span class="dv">1</span>) <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] 10  5  3  4  5  6  7  8  9 10</span></span></code></pre></div>
<p>When you write <code>modify(x, 1) &lt;- 10</code>, behind the scenes R turns it into:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">`</span><span class="at">modify&lt;-</span><span class="st">`</span>(x, <span class="dv">1</span>, <span class="dv">10</span>)</span></code></pre></div>
<p>Combining replacement with other functions requires more complex translation. For example, this:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="dv">3</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;two&quot;</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a&quot;   &quot;two&quot; &quot;c&quot;</span></span></code></pre></div>
<p>Is translated into:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">*tmp*</span><span class="st">`</span> <span class="ot">&lt;-</span> x</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="st">`</span><span class="at">*tmp*</span><span class="st">`</span>, <span class="st">`</span><span class="at">[&lt;-</span><span class="st">`</span>(<span class="fu">names</span>(<span class="st">`</span><span class="at">*tmp*</span><span class="st">`</span>), <span class="dv">2</span>, <span class="st">&quot;two&quot;</span>))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="st">`</span><span class="at">*tmp*</span><span class="st">`</span>)</span></code></pre></div>
<p>(Yes, it really does create a local variable named <em>tmp</em>, which is removed afterwards.)</p>
<h3 id="special-forms">Special forms</h3>
<p>Finally, there are a bunch of language features that are usually written in special ways, but also have prefix forms. These include parentheses:</p>
<ul>
<li><code>(x)</code> (<code>`(`(x)</code>)</li>
<li><code>{x}</code> (<code>`{`(x)</code>).</li>
</ul>
<p>The subsetting operators:</p>
<ul>
<li><code>x[i]</code> (<code>`[`(x, i)</code>)</li>
<li><code>x[[i]]</code> (<code>`[[`(x, i)</code>)</li>
</ul>
<p>And the tools of control flow:</p>
<ul>
<li><code>if (cond) true</code> (<code>`if`(cond, true)</code>)</li>
<li><code>if (cond) true else false</code> (<code>`if`(cond, true, false)</code>)</li>
<li><code>for(var in seq) action</code> (<code>`for`(var, seq, action)</code>)</li>
<li><code>while(cond) action</code> (<code>`while`(cond, action)</code>)</li>
<li><code>repeat expr</code> (<code>`repeat`(expr)</code>)</li>
<li><code>next</code> (<code>`next`()</code>)</li>
<li><code>break</code> (<code>`break`()</code>)</li>
</ul>
<p>Finally, the most complex is the â€œfunctionâ€ function:</p>
<ul>
<li><code>function(arg1, arg2) {body}</code> (<code>`function`(alist(arg1, arg2), body, env)</code>)</li>
</ul>
<p>Knowing the name of the function that underlies the special form is useful for getting documentation. <code>?(</code> is a syntax error; <code>?`(`</code> will give you the documentation for parentheses.</p>
<p>Note that all special forms are implemented as primitive functions (i.e.Â in C); that means printing these functions is not informative:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">for</span><span class="st">`</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; .Primitive(&quot;for&quot;)</span></span></code></pre></div>
<h2 id="invoking-a-function">Invoking a function</h2>
<p><a href="https://www.cnblogs.com/Demo1589/p/6984537.html">å¦ä¸€å€‹do.call()çš„åƒè€ƒ</a></p>
<p>Suppose you had a list of function arguments:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>How could you then send that list to <code>mean()</code>? In base R, you need <code>do.call()</code>:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(mean, args)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5.5</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Equivalent to</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5.5</span></span></code></pre></div>
<h3 id="exercises-3">Exercises</h3>
<ol type="1">
<li><p>Rewrite the following code snippets into prefix form:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> (<span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">&lt;=</span> <span class="dv">5</span>) x[[<span class="dv">5</span>]] <span class="cf">else</span> x[[n]]</span></code></pre></div></li>
<li><p>Clarify the following list of odd function calls:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="dv">20</span>, <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>))</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>, <span class="dv">20</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(<span class="at">m =</span> <span class="st">&quot;k&quot;</span>, <span class="at">y =</span> y, <span class="at">u =</span> <span class="st">&quot;p&quot;</span>, <span class="at">x =</span> x)</span></code></pre></div></li>
</ol>
<div class="notices">
    <div class= tips>
        ç›¸é—œä¿‚æ•¸
cor(x, y = NULL, use = &quot;everything&quot;,
method = c(&quot;pearson&quot;, &quot;kendall&quot;, &quot;spearman&quot;))
if method is &quot;kendall&quot; or &quot;spearman&quot;, Kendall's tau or Spearman's rho statistic is used to estimate a rank-based measure of association
    </div>
</div>

<ol type="1">
<li><p>Explain why the following code fails:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modify</span>(<span class="fu">get</span>(<span class="st">&quot;x&quot;</span>), <span class="dv">1</span>) <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error: target of assignment expands to non-language object</span></span></code></pre></div></li>
<li><p>Create a replacement function that modifies a random location in a vector.</p></li>
<li><p>Write your own version of <code>+</code> that will paste its inputs together if they are character vectors but behaves as usual otherwise. In other words, make this code work:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;a&quot;</span> <span class="sc">+</span> <span class="st">&quot;b&quot;</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;ab&quot;</span></span></code></pre></div></li>
<li><p>Create a list of all the replacement functions found in the base package. Which ones are primitive functions? (Hint use <code>apropros()</code>)</p></li>
<li><p>What are valid names for user-created infix functions?</p></li>
<li><p>Create an infix <code>xor()</code> operator.</p></li>
<li><p>Create infix versions of the set functions <code>intersect()</code>, <code>union()</code>, and <code>setdiff()</code>. You might call them <code>%n%</code>, <code>%u%</code>, and <code>%/%</code> to match conventions from mathematics.</p></li>
</ol>
<h2 id="function-answers">Quiz answers</h2>
<ol type="1">
<li><p>The three components of a function are its body, arguments, and environment.</p></li>
<li><p><code>f1(1)()</code> returns 11.</p></li>
<li><p>Youâ€™d normally write it in infix style: <code>1 + (2 * 3)</code>.</p></li>
<li><p>Rewriting the call to <code>mean(c(1:10, NA), na.rm = TRUE)</code> is easier to understand.</p></li>
<li><p>No, it does not throw an error because the second argument is never used so itâ€™s never evaluated.</p></li>
<li><p>See <a href="#infix-functions">infix</a> and <a href="#replacement-functions">replacement functions</a>.</p></li>
<li><p>You use <code>on.exit()</code>; see <a href="#on-exit">on exit</a> for details.</p></li>
</ol>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Functions that automatically quote one or more arguments (sometimes called NSE functions) can override the default scoping rules to implement other varieties of scoping. Youâ€™ll learn more about that in <a href="#meta">metaprogramming</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn2" role="doc-endnote"><p><code>g04()</code> returns <code>c(1, 2, 3)</code>.<a href="#fnref2" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn3" role="doc-endnote"><p><code>g06()</code> returns <code>c(10, 2)</code>.<a href="#fnref3" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn4" role="doc-endnote"><p><code>g11()</code> æ¯æ¬¡è¢«èª¿ç”¨éƒ½æ˜¯å‚³å› <code>1</code>ã€‚.<a href="#fnref4" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn5" role="doc-endnote"><p>å‡½æ•¸çš„è„«é›¢ç‹€æ…‹å¯ä»¥æ˜¯ç”¢ç”Ÿä¸€å€‹æ——è™Ÿ,ç”¨ä¾†è§¸ç™¼æ—¢æœ‰çš„è™•ç†å‡½æ•¸,å¯ä»¥æ˜¯é‡æ–°å•Ÿå‹•,æˆ–æ˜¯äº’å‹•è¨Šæ¯å‘æ˜¯æŒ‰Qè„«é›¢ã€‚<a href="#fnref5" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
</ol>
</section>

  </article><div class="collapse fs-6 pt-2" id="qnote-list">
    <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-white ">
        <span >
            
            <span class="fw-semibold">
                <button  class="btn btn-primary btn-inline" 
                   data-bs-toggle="collapse" data-bs-target="#qnote-edit"><span data-bs-toggle="tooltip" title="åŠ å…¥é€Ÿè¨˜">åŠ </span></button>
                <button id="qnote-gsave" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="å­˜åˆ°ç¡¬ç¢Ÿ"
                   onclick="qnSaveGoogle()">å­˜</button>
                <label for="qnote-load" class="btn btn-primary btn-inline"  data-bs-toggle="tooltip" data-bs-placement="left" title="å¾æª”æ¡ˆè¼‰å…¥">è¼‰</label>   
                <input style="display:none" type="file" id="qnote-load" onchange="qnLoadGoogle(this)" />
                <button id="qnote-clear" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="æ¸…é™¤å…¨éƒ¨é€Ÿè¨˜"
                   onclick="cleanNotes()">æ¸…</button>
            </span>
        </span>
        <span class="fw-semibold collapse" id="qnote-edit"> 
            <input type="text" class="txtitle d-block w-100 h-25 " placeholder="æŠ¬é ­" />
            <textarea class="txtBox  d-block w-100 h-75 " placeholder="æœ¬æ–‡"></textarea>
            
            <button id="qnote-add-item" onclick="addNote()" class="btn btn-primary">å­˜</button> 
        </span>

    </div>
</div>

<link href="../css/quicknote.css?1632928432" rel="stylesheet">
<script src="../js/quicknote.js?1632928432"></script>
<div id="page-guide" class="bg-dark">  
  
    
          
          <a href="../rlang/7_1_apply_family.html" 
                   class="btn btn-primary" 
                   data-bs-toggle="tooltip" 
                   data-bs-placement="left" title=7.1&#32;function&#32;-&#32;apply&#32;family>å‰</a>
                   
          
            <a href="../rlang/1_4_rpackages.html" 
               class="btn btn-primary" data-bs-toggle="tooltip" data-bs-placement="left" 
               title=1.4&#32;R&#32;Package>å¾Œ</a>            
          
          

  
<script src="../js/packhtml.js?1632928432"></script>    
<button class="btn btn-primary " onclick="packthis(this)"
data-bs-toggle="tooltip" data-bs-placement="left" title="æ‰“åŒ…æˆå–®ä¸€æª”æ¡ˆ">åŒ…</button>
<button class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="div#qnote-list">
  <span data-bs-toggle="tooltip" data-bs-placement="left" title="å¿«é€Ÿè¨»è¨˜">é€Ÿ</span></button>
 
</div>
  </div>


  <script src="../js/featherlight.min.js?1632928432"></script>
  <script src="../js/featherlight.gallery.min.js?1632928432"></script>
  <link href="../css/featherlight.min.css?1632928432" rel="stylesheet">
  <link href="../css/featherlight.gallery.min.css?1632928432" rel="stylesheet">

  <script src="../js/highlight.pack.js?1632928432"></script>
  
  <script src="../js/hugohelper.js?1632928432"></script>

  <link href="../css/rmd.css?1632928432" rel="stylesheet">
  <link href="../css/mystyle.css?1632928432" rel="stylesheet">    
  <script src='../js/variant.js?1632928432'></script>

<script>
  
    let idxfile = "\/blogR\/index.json"  
  
</script>
<script src='../js/localsearch.js?1632928432'></script>
    


  
      
          <script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script>
      
      <script>
          mermaid.initialize({ startOnLoad: true });
      </script>
  

  <script>
    
      MathJax = {
        tex: {
          inlineMath: [['\($', '$\)'], ['\\(', '\\)']],
          displayMath: [['$$','$$']]  
        },
        svg: {
          fontCache: 'global'
        }
      };
    
      </script>
      <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
      </script>



<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    jumpto = document.querySelector("#sidebar .active");
     if (jumpto!=null) jumpto.scrollIntoViewIfNeeded(true);
  
  });    
  
  </script>
</body>
</html>