<!DOCTYPE html>
<html><head>
  <title>10. tidyr, dplyr basic</title>  
      
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href='/blogR/images/favicon.ico'/>
      
    <link rel="stylesheet" href="/blogR/css/atom-one-dark-reasonable.css">
    
    <link href="/blogR/css/syntax.css?1641445339" rel="stylesheet">
    <script src="/blogR/js/jquery-3.3.1.min.js?1641445339"></script>
    <link href='/blogR/css/bootstrap.min.css' rel="stylesheet" crossorigin="anonymous">
    <script src='/blogR/js/bootstrap.bundle.min.js' crossorigin="anonymous"></script>
    
    <script src='/blogR/js/datatables.min.js'></script>    
    <link href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css" rel="stylesheet">    
    
    <link href="/blogR/css/fontawesome-all.min.css?1641445339" rel="stylesheet">
    
    <link href="/blogR/css/theme-mine.css?1641445339" rel="stylesheet">
    
    <link href="/blogR/css/theme.css?1641445339" rel="stylesheet">
    
    
    <link rel="stylesheet" href="https://airbone4.github.io/blogR/scss/notice.7158afc7a24ea3d0073077b3699dbfad7f3df2be8d4e19956e934587413013ee.css" integrity="sha256-cVivx6JOo9AHMHezaZ2/rX898r6NThmVbpNFh0EwE&#43;4=">
    <script src='/blogR/js/class.js'></script>    
    
  </head><body><div id="top-pane" class="navbar  fixed-top ">
  <div class="container-fluid">
  <span >
    <a  href='/blogR/' class="fs-5 accessory"><i class="fas fa-home"></i>R in Class</a>
    <span id="sidebar-toggle-span" class="fs-5"><i class="fas fa-align-justify"></i></span>
  </span><span >
      <span id="toc-menu">
    <label><i class="fas fa-list-alt" ></i> </label>    
<div id="variant-toc-content" >
    <div class="wrapper">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#long-and-wide-data">long and wide data</a>
      <ul>
        <li><a href="#寬變長">寬變長</a></li>
        <li><a href="#長到寬資料">長到寬資料</a></li>
      </ul>
    </li>
    <li><a href="#dplyr-的向量函數">dplyr 的向量函數</a>
      <ul>
        <li><a href="#subset">subset</a></li>
        <li><a href="#分組">分組</a></li>
        <li><a href="#報告">報告</a></li>
      </ul>
    </li>
    <li><a href="#實驗-pipeline-vs-no-pipeline">實驗 pipeline vs no pipeline</a></li>
    <li><a href="#練習">練習</a></li>
  </ul>
</nav>
    </div>
    <hr class="p-0 m-0" />
    <div class="toa"></div>
</div>
</span>
<span class="fs-5 accessory" data-bs-toggle="tooltip" data-bs-placement="bottom" 
      title='最後修改December 23, 2021'>10. tidyr, dplyr basic</span>
        
    

    </span>
  
  <span></span><span >
    <span >
    <label for="search-query" id="search-button"><i class="fas fa-search"></i></label>
    <input id="search-query" type="search" placeholder="搜尋" autocomplete="off">
</span>    
 
<div id="search-pane">
 <ol id="search-results"></ul>
</div>

    </span>
</div> 
</div>


<div id="content-wrapper"><nav id="sidebar">
  
    <ul class="nav flex-column topics" id="home-topics">
      
        
          
          


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="基礎R">
     

  <a class="nav-link" 
    href="/blogR/rlang.html"><i class="far fa-folder"></i>基礎R  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_92db98bffe2d6697b3536cbbf7b00074" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_92db98bffe2d6697b3536cbbf7b00074"  
  class="submenu collapse show" 
  data-bs-parent="#home-topics">

    
  
  
   
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_0_requirement.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1 Requirement</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_1_%E7%B3%BB%E7%B5%B1.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1 運作環境</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_2_filesystem.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2 檔案系統</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_3_%E5%9F%B7%E8%A1%8C.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3 執行</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_4_rpackages.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4 R Package</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_5_%E7%B7%A8%E7%A2%BC.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5 編碼</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_0_%E8%BC%B8%E5%87%BA%E8%BC%B8%E5%85%A5.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0 基本輸出輸入</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_1_%E8%AE%80%E6%AA%94%E5%AF%AB%E6%AA%94.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1 讀檔寫檔</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_2_data_explorer.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2 資料探索</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_3_data_explorer.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3 資料探索</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/3_quickview1.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3. Quick view 1</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_1_1_type_%E5%9F%BA%E6%9C%AC.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1 基本</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_1_2_type%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1.2 練習</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_2_type_vector.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.2 向量</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_3_type_matrix.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.3 矩陣</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_4_type_list.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.4 串列 list</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_5_type_string_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.5 字串處理函數</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_6_type_dataframe.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.6 資料集 data frame</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_7_type_factor.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.7 因子</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_11_%E6%AD%A3%E8%A6%8F%E8%A1%A8%E9%81%94%E8%AA%9E%E6%B3%95.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.11 正規表達語法</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_15_json.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.15 json</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/6_1_programming.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">6.1 Programming basic</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/6_3_apply_family.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">6.3 function - apply family</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_1_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.1 R 函數的基本撰寫</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_2_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.2 R函數進階</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_3_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.3 R 函數定義的幾種分類</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_8_objectbasic.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.8 R的物件相關概念</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_9_%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91s3.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.9 物件導向S3</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/9_1_plot.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">9.1 基本繪圖</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/9_2_%E5%A4%9A%E5%9C%96%E7%96%8A%E5%9C%96.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">9.2 多圖疊圖</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/9_3_plot.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">9.3 畫圖練習</a></li>
     
    
        <li class="nav-item active"><a class="nav-link" href="/blogR/rlang/10_00_dplyrbasic01.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">10. tidyr, dplyr basic</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/11_00_sampling.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">11. sampling</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/11_environments.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">11 Environments</a></li>
     
   
     
   
     
   
        <li>


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="暫時">
     

  <a class="nav-link" 
    href="/blogR/rlang/demo.html"><i class="far fa-folder"></i>暫時  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f03d3d24b564dd9c39af6eb86300021f" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_f03d3d24b564dd9c39af6eb86300021f"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_92db98bffe2d6697b3536cbbf7b00074">

    
  
  
   
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/demo/citation.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">引用</a></li>
    </ul>
</li>
     
  
</li>
     
   
        <li>


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="練習用">
     

  <a class="nav-link" 
    href="/blogR/rlang/hw.html"><i class="far fa-folder"></i>練習用  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_b4809f6375b9dda8660e4938c2644e82" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_b4809f6375b9dda8660e4938c2644e82"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_92db98bffe2d6697b3536cbbf7b00074">

    
  
  
   
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/hw/hw_basic.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">assignment-1</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/hw/hw_regexp.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">regexpr</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/hw/hw_filesystem.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">檔案系統</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/hw/dataset_class.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">資料集</a></li>
    </ul>
</li>
     
  
</li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/resources.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">練習相關檔案</a></li>
    </ul>
</li>
     
  

        
          
          


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="基礎計量">
     

  <a class="nav-link" 
    href="/blogR/econometrics.html"><i class="far fa-folder"></i>基礎計量  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_c59a6b16a979dae063e00e4a916e3284" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_c59a6b16a979dae063e00e4a916e3284"  
  class="submenu collapse" 
  data-bs-parent="#home-topics">

    
  
  
   
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/0_prerequest.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0 前置準備</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/1_t%E6%AA%A2%E5%AE%9A.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0 t檢定</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/2_anova.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2. ANOVA</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/a_a_%E8%B3%87%E6%96%99%E8%99%95%E7%90%86.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">A.a 資料處理</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/a_b_mpg%E7%82%BA%E4%BE%8B%E7%9A%84ggplot.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">A.b mpg為例的ggplot</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/lmm.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">lmm</a></li>
     
   
    </ul>
</li>
     
  

        
          
          


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="專題">
     

  <a class="nav-link" 
    href="/blogR/topic.html"><i class="far fa-folder"></i>專題  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f7b6d4231ab239a316b7f2d9edf32817" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_f7b6d4231ab239a316b7f2d9edf32817"  
  class="submenu collapse" 
  data-bs-parent="#home-topics">

    
  
  
   
   
     
   
        <li>


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="實驗">
     

  <a class="nav-link" 
    href="/blogR/topic/simulation.html"><i class="far fa-folder"></i>實驗  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_e617bdc52da54290f99855ac9d5037aa" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_e617bdc52da54290f99855ac9d5037aa"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_f7b6d4231ab239a316b7f2d9edf32817">

    
  
  
   
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/shinyapps/tutorial/01_hello/readme.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title=""></a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/01_shiny_basic.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">01_shiny_basic</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/navarpage.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2. navarPage</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/2_1_%E9%9A%A8%E6%A9%9F%E8%AE%8A%E6%95%B8.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1 隨機變數</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/2_1_%E4%BA%82%E6%95%B8%E5%87%BD%E6%95%B8%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.1 亂數函數練習</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/3_shinydist.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3. shinyDist</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/4_01_sim.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1 模擬基本 1</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/4_02_sim.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.2 模擬基本 2</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/50_2_%E8%A7%A3%E7%AD%94.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">50_1_解答</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/50_1_%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">50.1 練習</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/mc_%E5%9F%BA%E6%9C%AC.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">MC_基本</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/poisson%E5%88%86%E9%85%8D.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">Poisson分配</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/shinyapps/tutorial/tagsdemo/readme.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">Readme</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/sinytest.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">sinytest</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/central.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">中央</a></li>
    </ul>
</li>
     
  
</li>
     
   
    </ul>
</li>
     
  

          
        
  </ul> 
    
    <hr/>
    <section id="footer">
      最近3篇<br/><ul><li><a href="https://airbone4.github.io/blogR/topic/simulation/50_3_%E5%8D%8A%E6%88%90%E5%93%81.html"> <i class="far fa-clock" ></i>50_2_半成品[2022-01-06 PM 01:01]</a></li><li><a href="https://airbone4.github.io/blogR/topic/simulation/50_2_%E8%A7%A3%E7%AD%94.html"> <i class="far fa-clock" ></i>50_1_解答[2022-01-06 PM 12:23]</a></li><li><a href="https://airbone4.github.io/blogR/topic/simulation/50_1_%E7%B7%B4%E7%BF%92.html"> <i class="far fa-clock" ></i>50.1 練習[2022-01-05 PM 10:45]</a></li></ul>
    </section>
  
</nav><article class="article mx-2 mt-3" id="body-inner">
    <ul>
<li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheat sheet</a></li>
</ul>
<div class="notices ms-5">
<div class="info">需要安裝babynames,ggplot2</div>
</div>
<p><img src="10_00_dplyrBasic01.files/reshape.png" alt=""></p>
<h2 id="long-and-wide-data">long and wide data</h2>
<h3 id="寬變長">寬變長</h3>
<p>函數<code>gather()</code>: 寬變長
From <a href="http://stackoverflow.com/questions/1181060">http://stackoverflow.com/questions/1181060</a></p>
<pre><code class="language-r?lang=r?class=.source">require(tidyr)
require(dplyr) # tibble
# 每個時間點(共10個),產生3個股票,X,Y,Z
 stocks &lt;- tibble( #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏也可以用data.frame">🏷</span><!--/html_preserve-->
  time = as.Date('2011-01-01') + 0:9,
  X = rnorm(10, 0, 1),
  Y = rnorm(10, 0, 2),
  Z = rnorm(10, 0, 4)
) 

kable(head(stocks))  
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left">time</th>
<th style="text-align:right">X</th>
<th style="text-align:right">Y</th>
<th style="text-align:right">Z</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">2011-01-01</td>
<td style="text-align:right">0.5809880</td>
<td style="text-align:right">1.5677627</td>
<td style="text-align:right">-2.0968534</td>
</tr>
<tr>
<td style="text-align:left">2011-01-02</td>
<td style="text-align:right">-0.0098641</td>
<td style="text-align:right">-0.1116476</td>
<td style="text-align:right">-1.6598882</td>
</tr>
<tr>
<td style="text-align:left">2011-01-03</td>
<td style="text-align:right">0.6860624</td>
<td style="text-align:right">-2.6588452</td>
<td style="text-align:right">5.5132379</td>
</tr>
<tr>
<td style="text-align:left">2011-01-04</td>
<td style="text-align:right">-0.7594502</td>
<td style="text-align:right">1.8254579</td>
<td style="text-align:right">-0.0976793</td>
</tr>
<tr>
<td style="text-align:left">2011-01-05</td>
<td style="text-align:right">-0.0614846</td>
<td style="text-align:right">-1.0578723</td>
<td style="text-align:right">1.3037204</td>
</tr>
<tr>
<td style="text-align:left">2011-01-06</td>
<td style="text-align:right">-0.0949446</td>
<td style="text-align:right">-0.0736560</td>
<td style="text-align:right">2.0693562</td>
</tr>
</tbody>
</table>
<pre><code class="language-r?lang=r?class=.source">rst&lt;-gather(stocks, stock, price, -time) #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="除了時間欄位以外,其餘欄位依序填到兩個新欄位,分別是1)&lt;code&gt;KEY&lt;/code&gt;(stock)和2)&lt;code&gt;VALUE&lt;/code&gt;(price) &lt;br/&gt; 這裡只有3個欄位,扣掉以後剩下XYZ三個欄位,然後欄位名稱填到&lt;code&gt;KEY&lt;/code&gt;對應的數值填到&lt;code&gt;VALUE&lt;/code&gt;&lt;br/&gt;也可以用管道寫法 &lt;code&gt;stocks %&amp;gt;% gather(stock, price, -time)&lt;/code&gt;">🏷️</span><!--/html_preserve--> 
kable(rst) 
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left">time</th>
<th style="text-align:left">stock</th>
<th style="text-align:right">price</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">2011-01-01</td>
<td style="text-align:left">X</td>
<td style="text-align:right">0.5809880</td>
</tr>
<tr>
<td style="text-align:left">2011-01-02</td>
<td style="text-align:left">X</td>
<td style="text-align:right">-0.0098641</td>
</tr>
<tr>
<td style="text-align:left">2011-01-03</td>
<td style="text-align:left">X</td>
<td style="text-align:right">0.6860624</td>
</tr>
<tr>
<td style="text-align:left">2011-01-04</td>
<td style="text-align:left">X</td>
<td style="text-align:right">-0.7594502</td>
</tr>
<tr>
<td style="text-align:left">2011-01-05</td>
<td style="text-align:left">X</td>
<td style="text-align:right">-0.0614846</td>
</tr>
<tr>
<td style="text-align:left">2011-01-06</td>
<td style="text-align:left">X</td>
<td style="text-align:right">-0.0949446</td>
</tr>
<tr>
<td style="text-align:left">2011-01-07</td>
<td style="text-align:left">X</td>
<td style="text-align:right">-0.6436006</td>
</tr>
<tr>
<td style="text-align:left">2011-01-08</td>
<td style="text-align:left">X</td>
<td style="text-align:right">0.0139740</td>
</tr>
<tr>
<td style="text-align:left">2011-01-09</td>
<td style="text-align:left">X</td>
<td style="text-align:right">-0.3794848</td>
</tr>
<tr>
<td style="text-align:left">2011-01-10</td>
<td style="text-align:left">X</td>
<td style="text-align:right">1.3905566</td>
</tr>
<tr>
<td style="text-align:left">2011-01-01</td>
<td style="text-align:left">Y</td>
<td style="text-align:right">1.5677627</td>
</tr>
<tr>
<td style="text-align:left">2011-01-02</td>
<td style="text-align:left">Y</td>
<td style="text-align:right">-0.1116476</td>
</tr>
<tr>
<td style="text-align:left">2011-01-03</td>
<td style="text-align:left">Y</td>
<td style="text-align:right">-2.6588452</td>
</tr>
<tr>
<td style="text-align:left">2011-01-04</td>
<td style="text-align:left">Y</td>
<td style="text-align:right">1.8254579</td>
</tr>
<tr>
<td style="text-align:left">2011-01-05</td>
<td style="text-align:left">Y</td>
<td style="text-align:right">-1.0578723</td>
</tr>
<tr>
<td style="text-align:left">2011-01-06</td>
<td style="text-align:left">Y</td>
<td style="text-align:right">-0.0736560</td>
</tr>
<tr>
<td style="text-align:left">2011-01-07</td>
<td style="text-align:left">Y</td>
<td style="text-align:right">4.8767117</td>
</tr>
<tr>
<td style="text-align:left">2011-01-08</td>
<td style="text-align:left">Y</td>
<td style="text-align:right">0.6615530</td>
</tr>
<tr>
<td style="text-align:left">2011-01-09</td>
<td style="text-align:left">Y</td>
<td style="text-align:right">-0.8495659</td>
</tr>
<tr>
<td style="text-align:left">2011-01-10</td>
<td style="text-align:left">Y</td>
<td style="text-align:right">-1.8523956</td>
</tr>
<tr>
<td style="text-align:left">2011-01-01</td>
<td style="text-align:left">Z</td>
<td style="text-align:right">-2.0968534</td>
</tr>
<tr>
<td style="text-align:left">2011-01-02</td>
<td style="text-align:left">Z</td>
<td style="text-align:right">-1.6598882</td>
</tr>
<tr>
<td style="text-align:left">2011-01-03</td>
<td style="text-align:left">Z</td>
<td style="text-align:right">5.5132379</td>
</tr>
<tr>
<td style="text-align:left">2011-01-04</td>
<td style="text-align:left">Z</td>
<td style="text-align:right">-0.0976793</td>
</tr>
<tr>
<td style="text-align:left">2011-01-05</td>
<td style="text-align:left">Z</td>
<td style="text-align:right">1.3037204</td>
</tr>
<tr>
<td style="text-align:left">2011-01-06</td>
<td style="text-align:left">Z</td>
<td style="text-align:right">2.0693562</td>
</tr>
<tr>
<td style="text-align:left">2011-01-07</td>
<td style="text-align:left">Z</td>
<td style="text-align:right">1.7608734</td>
</tr>
<tr>
<td style="text-align:left">2011-01-08</td>
<td style="text-align:left">Z</td>
<td style="text-align:right">0.2977582</td>
</tr>
<tr>
<td style="text-align:left">2011-01-09</td>
<td style="text-align:left">Z</td>
<td style="text-align:right">9.8361292</td>
</tr>
<tr>
<td style="text-align:left">2011-01-10</td>
<td style="text-align:left">Z</td>
<td style="text-align:right">-4.0950475</td>
</tr>
</tbody>
</table>
<div class="notices  d-none ">
<div class="info"><p>🐱‍👤直接寫出html : 利用<code>writeLines()</code>,例如設定css
設定css</p>
<pre><code class="language-r">writeLines("td, th { padding : 6px } th { background-color : brown ; color : white; border : 1px solid white; } td { color : brown ; border : 1px solid brown }", con = "tableStyle.css")
kable(head(mtcars))
</code></pre>
</div>
</div>
<p><!--html_preserve--><div class="position-relative warning p-3"><!--/html_preserve--><p>每個時間點(共5個),產生3個股票,X,Y,Z共兩組,測試長寬轉換</p>
<pre><code class="language-r?lang=r?class=.source"> stocks1 &lt;- tibble( #&lt;!--html_preserve--&gt;&lt;span  data-bs-toggle=&quot;tooltip&quot; data-bs-html=&quot;true&quot; data-bs-placement=&quot;bottom&quot; title=&quot;👏也可以用data.frame&quot;&gt;🏷&lt;/span&gt;&lt;!--/html_preserve--&gt;
  group=rep(1,5),
  time = as.Date('2011-01-01') + 0:4,
  X = rnorm(5, 0, 1),
  Y = rnorm(5, 0, 2),
  Z = rnorm(5, 0, 4)
) 
 stocks2 &lt;- tibble( #&lt;!--html_preserve--&gt;&lt;span  data-bs-toggle=&quot;tooltip&quot; data-bs-html=&quot;true&quot; data-bs-placement=&quot;bottom&quot; title=&quot;👏也可以用data.frame&quot;&gt;🏷&lt;/span&gt;&lt;!--/html_preserve--&gt;
  group=rep(2,5),
  time = as.Date('2011-01-01') + 0:4,
  X = rnorm(5, 0, 1),
  Y = rnorm(5, 0, 2),
  Z = rnorm(5, 0, 4)
)
stocks&lt;- bind_rows(stocks1,stocks2)
kable(stocks)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:right">group</th>
<th style="text-align:left">time</th>
<th style="text-align:right">X</th>
<th style="text-align:right">Y</th>
<th style="text-align:right">Z</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:left">2011-01-01</td>
<td style="text-align:right">0.2379382</td>
<td style="text-align:right">-1.4769400</td>
<td style="text-align:right">5.1098570</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:left">2011-01-02</td>
<td style="text-align:right">-0.1579551</td>
<td style="text-align:right">-0.2810863</td>
<td style="text-align:right">7.9387294</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:left">2011-01-03</td>
<td style="text-align:right">0.2868259</td>
<td style="text-align:right">-1.5837312</td>
<td style="text-align:right">9.8294281</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:left">2011-01-04</td>
<td style="text-align:right">0.0760063</td>
<td style="text-align:right">-0.5269315</td>
<td style="text-align:right">0.8675916</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:left">2011-01-05</td>
<td style="text-align:right">-0.2323477</td>
<td style="text-align:right">-0.7172991</td>
<td style="text-align:right">1.4852934</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:left">2011-01-01</td>
<td style="text-align:right">1.1645191</td>
<td style="text-align:right">-1.2592966</td>
<td style="text-align:right">-3.4174565</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:left">2011-01-02</td>
<td style="text-align:right">-0.1894457</td>
<td style="text-align:right">-1.5759197</td>
<td style="text-align:right">1.8410168</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:left">2011-01-03</td>
<td style="text-align:right">0.2316267</td>
<td style="text-align:right">-1.6620923</td>
<td style="text-align:right">-3.8215735</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:left">2011-01-04</td>
<td style="text-align:right">-0.4225455</td>
<td style="text-align:right">-2.8074974</td>
<td style="text-align:right">6.1690483</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:left">2011-01-05</td>
<td style="text-align:right">-0.6428280</td>
<td style="text-align:right">0.0479795</td>
<td style="text-align:right">2.6454802</td>
</tr>
</tbody>
</table>
<!--html_preserve--><button type="button" class="btn btn-primary position-absolute top-0 end-0 p-0" 
    data-bs-toggle="collapse" data-bs-target="#quiz-2270">提示</button>
</div><!--/html_preserve-->
<!--html_preserve--><div class="collapse info p-3" id="quiz-2270"><!--/html_preserve--><p>寬轉長:以下寫法都一樣</p>
<pre><code class="language-r">stocks %&gt;% gather(stock,price,-group,-time)
stocks %&gt;% gather(stock,price,X:Z)
stocks %&gt;% gather(stock,price,3:5)
stocks %&gt;% gather(stock,price,X,Y,Z)
stocks %&gt;% gather(stock,price,X,Y,Z,-group,-time)
</code></pre>
<p>長轉寬:參考後面段落</p>
<!--html_preserve--></div><!--/html_preserve--></p>
<h3 id="長到寬資料">長到寬資料</h3>
<p>利用函數<code>spread()</code></p>
<pre><code class="language-r?lang=r?class=.source">long&lt;-gather(stocks, stock, price, -time) #轉成長資料
str(long)
#&gt; tibble [40 x 3] (S3: tbl_df/tbl/data.frame)
#&gt;  $ time : Date[1:40], format: &quot;2011-01-01&quot; &quot;2011-01-02&quot; ...
#&gt;  $ stock: chr [1:40] &quot;group&quot; &quot;group&quot; &quot;group&quot; &quot;group&quot; ...
#&gt;  $ price: num [1:40] 1 1 1 1 1 2 2 2 2 2 ...
wide &lt;-spread(long,stock,price) #轉成寬資料 或 <!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="wide&amp;lt;-long %&amp;gt;% spread(stock,price)">🏷️</span><!--/html_preserve-->
#&gt; Error: Each row of output must be identified by a unique combination of keys.
#&gt; Keys are shared for 40 rows:
#&gt; * 1, 6
#&gt; * 2, 7
#&gt; * 3, 8
#&gt; * 4, 9
#&gt; * 5, 10
#&gt; * 11, 16
#&gt; * 12, 17
#&gt; * 13, 18
#&gt; * 14, 19
#&gt; * 15, 20
#&gt; * 21, 26
#&gt; * 22, 27
#&gt; * 23, 28
#&gt; * 24, 29
#&gt; * 25, 30
#&gt; * 31, 36
#&gt; * 32, 37
#&gt; * 33, 38
#&gt; * 34, 39
#&gt; * 35, 40
str(wide)
#&gt; Error in str(wide): 找不到物件 'wide'
head(wide)
#&gt; Error in head(wide): 找不到物件 'wide'
</code></pre>
<p>更多參考:
<a href="http://www.cookbook-r.com/Manipulating_data/Converting_data_between_wide_and_long_format/">cookbook for R</a></p>
<h2 id="dplyr-的向量函數">dplyr 的向量函數</h2>
<p>函數名 功能</p>
<ul>
<li><code>row_number()</code> 排序(😒不是紀錄號碼),如果數值一樣,則靠前出現的元素排名在前,例如(3,3) 則 1,2</li>
<li><code>min_rank()</code> 排序,如果數值一樣,則都是同一等級，但是，佔用下一名次。例如
<pre><code class="language-r">data&lt;-c(3,3,4)  
min_rank(data)
#&gt; [1] 1 1 3 #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏沒有2">🏷</span><!--/html_preserve-->
</code></pre>
</li>
<li><code>dense_rank()</code> 排序,如果數值一樣,則都是同一等級，但是，<code>不</code>佔用下一名次
<pre><code class="language-r">data&lt;-c(3,3,4)  
dense_rank(data)
#&gt; [1] 1 1 2
</code></pre>
</li>
<li><code>percent_rank()</code> 按百分比的排名
<pre><code class="language-r">percent_rank = (min_rank(x) - 1)/(sum(!is.na(x)) - 1)   
</code></pre>
</li>
<li><code>cume_dist()</code> 累計分佈</li>
<li><code>ntile()</code> : <code>floor(n * (row_number(x) - 1)/len + 1) </code>
<pre><code class="language-r">x &lt;- c(5, 1, 3, 2, 2)
ntile(x, 2) #分成2部分
#&gt; [1]  2  1  2  1  1 
ntile(1:8, 3) # 分成3部分
#&gt; [1] 1 1 1 2 2 2 3 3
</code></pre>
</li>
</ul>
<p>範例</p>
<pre><code class="language-r?lang=r?class=.source">data&lt;-round(runif(10)*10)
pr&lt;-percent_rank(data)
cd&lt;-cume_dist(data)
mr&lt;-min_rank(data)
#彙整上面資料成表格
df&lt;-data.frame(data,pr,mr,cd)
arrange(df,data)
#&gt; [1] &quot;處理表格&quot;
</code></pre>

  
















<!--html_preserve--><div   class="table-responsive kable">
<table  class="w-50 ms-5">
<thead  class="">
<tr >
<th  style="text-align:right">data</th>
<th  style="text-align:right">pr</th>
<th  style="text-align:right">mr</th>
<th  style="text-align:right">cd</th>
</tr>
</thead>
<tbody >
<tr >
<td  style="text-align:right">1</td>
<td  style="text-align:right">0.0000000</td>
<td  style="text-align:right">1</td>
<td  style="text-align:right">0.1</td>
</tr>
<tr >
<td  style="text-align:right">2</td>
<td  style="text-align:right">0.1111111</td>
<td  style="text-align:right">2</td>
<td  style="text-align:right">0.2</td>
</tr>
<tr >
<td  style="text-align:right">3</td>
<td  style="text-align:right">0.2222222</td>
<td  style="text-align:right">3</td>
<td  style="text-align:right">0.6</td>
</tr>
<tr >
<td  style="text-align:right">3</td>
<td  style="text-align:right">0.2222222</td>
<td  style="text-align:right">3</td>
<td  style="text-align:right">0.6</td>
</tr>
<tr >
<td  style="text-align:right">3</td>
<td  style="text-align:right">0.2222222</td>
<td  style="text-align:right">3</td>
<td  style="text-align:right">0.6</td>
</tr>
<tr >
<td  style="text-align:right">3</td>
<td  style="text-align:right">0.2222222</td>
<td  style="text-align:right">3</td>
<td  style="text-align:right">0.6</td>
</tr>
<tr >
<td  style="text-align:right">5</td>
<td  style="text-align:right">0.6666667</td>
<td  style="text-align:right">7</td>
<td  style="text-align:right">0.7</td>
</tr>
<tr >
<td  style="text-align:right">6</td>
<td  style="text-align:right">0.7777778</td>
<td  style="text-align:right">8</td>
<td  style="text-align:right">0.9</td>
</tr>
<tr >
<td  style="text-align:right">6</td>
<td  style="text-align:right">0.7777778</td>
<td  style="text-align:right">8</td>
<td  style="text-align:right">0.9</td>
</tr>
<tr >
<td  style="text-align:right">8</td>
<td  style="text-align:right">1.0000000</td>
<td  style="text-align:right">10</td>
<td  style="text-align:right">1.0</td>
</tr>
</tbody>
</table>

</div><!--/html_preserve-->
<p>更多範例</p>
<pre><code class="language-r?lang=r?class=.source">x &lt;- c(5, 1, 3, 2, 2, NA)
row_number(x)
#&gt; [1]  5  1  4  2  3 NA
min_rank(x)
#&gt; [1]  5  1  4  2  2 NA
dense_rank(x)
#&gt; [1]  4  1  3  2  2 NA
percent_rank(x)
#&gt; [1] 1.00 0.00 0.75 0.25 0.25   NA
cume_dist(x)
#&gt; [1] 1.0 0.2 0.8 0.6 0.6  NA

ntile(x, 2)
#&gt; [1]  2  1  2  1  1 NA
ntile(1:8, 3)
#&gt; [1] 1 1 1 2 2 2 3 3
</code></pre>
<p>note:</p>
<p>(2,3,3,3,3,4,5,6,6,9)</p>
<table>
<thead>
<tr>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>4</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<div class="notices ms-5">
<div class="info"><pre><code class="language-r">arrange(dataframe, col1, col2, col3)  
vs.  
dataframe[order(dataframe$col1, dataframe$col2, dataframe$col3), ]
vs.  
with(dataframe, dataframe[order(col1, col2, col3), ])  
</code></pre>
</div>
</div>
<p><!--html_preserve--><div class="position-relative warning p-3"><!--/html_preserve--><p>rank等級想要由大到小可以像下面這樣</p>
<pre><code class="language-r?lang=r?class=.source">data
#&gt;  [1] 3 5 2 3 6 8 3 6 3 1
row_number(desc(data)) #&lt;!--html_preserve--&gt;&lt;span  data-bs-toggle=&quot;tooltip&quot; data-bs-html=&quot;true&quot; data-bs-placement=&quot;bottom&quot; title=&quot;&amp;lt;code&amp;gt;row_number()&amp;lt;/code&amp;gt; 不是橫行號碼💀,而是&amp;lt;code&amp;gt;rank()&amp;lt;/code&amp;gt;&quot;&gt;🏷️&lt;/span&gt;&lt;!--/html_preserve--&gt;
#&gt;  [1]  5  4  9  6  2  1  7  3  8 10
</code></pre>
<p>❓探討為甚麼?</p>
<!--html_preserve--><button type="button" class="btn btn-primary position-absolute top-0 end-0 p-0" 
    data-bs-toggle="collapse" data-bs-target="#quiz-02135">提示</button>
</div><!--/html_preserve-->
<!--html_preserve--><div class="collapse info p-3" id="quiz-02135"><!--/html_preserve--><pre><code class="language-r?lang=r?class=.source">desc(data) #&lt;!--html_preserve--&gt;&lt;span  data-bs-toggle=&quot;tooltip&quot; data-bs-html=&quot;true&quot; data-bs-placement=&quot;bottom&quot; title=&quot;👏原來的資料變成負數&quot;&gt;🏷&lt;/span&gt;&lt;!--/html_preserve--&gt;
#&gt;  [1] -3 -5 -2 -3 -6 -8 -3 -6 -3 -1
row_number(data)
#&gt;  [1]  3  7  2  4  8 10  5  9  6  1
</code></pre>
<!--html_preserve--></div><!--/html_preserve--></p>
<div class="notices ms-5">
<div class="info"><p>複習一下Percentile</p>
<p>❓Find the 32nd, 57th and 98th percentiles of runiform(200).</p>
<pre><code class="language-r?lang=r?class=.source">data<-runif(200) 
quantile(data, c(.32, .57, .98)) 
#>       32%       57%       98% 
#> 0.3270967 0.5239496 0.9705282
</code></pre>
</div>
</div>
<p>將欄位改名稱,如原來的股票X改成nx</p>
<pre><code>rename(stocks, nx=X)
</code></pre>
<p>如果不用rename</p>
<pre><code class="language-r">stocks$nx&lt;-stocks$X
stocks$X&lt;-NULL
</code></pre>
<h3 id="subset">subset</h3>
<p><img src="10_00_dplyrBasic01.files/subset.png" alt=""></p>
<ul>
<li>select()選欄位</li>
<li>filter()選紀錄</li>
</ul>
<pre><code class="language-r?lang=r?class=.source">library(babynames)
babynames 
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 1,924,665 x 5
#&gt;     year sex   name          n   prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;
#&gt;  1  1880 F     Mary       7065 0.0724
#&gt;  2  1880 F     Anna       2604 0.0267
#&gt;  3  1880 F     Emma       2003 0.0205
#&gt;  4  1880 F     Elizabeth  1939 0.0199
#&gt;  5  1880 F     Minnie     1746 0.0179
#&gt;  6  1880 F     Margaret   1578 0.0162
#&gt;  7  1880 F     Ida        1472 0.0151
#&gt;  8  1880 F     Alice      1414 0.0145
#&gt;  9  1880 F     Bertha     1320 0.0135
#&gt; 10  1880 F     Sarah      1288 0.0132
#&gt; # ... with 1,924,655 more rows

babynames %&gt;% select(-prop) #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏一個有五個欄位,扣掉欄位prop">🏷</span><!--/html_preserve-->
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 1,924,665 x 4
#&gt;     year sex   name          n
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;
#&gt;  1  1880 F     Mary       7065
#&gt;  2  1880 F     Anna       2604
#&gt;  3  1880 F     Emma       2003
#&gt;  4  1880 F     Elizabeth  1939
#&gt;  5  1880 F     Minnie     1746
#&gt;  6  1880 F     Margaret   1578
#&gt;  7  1880 F     Ida        1472
#&gt;  8  1880 F     Alice      1414
#&gt;  9  1880 F     Bertha     1320
#&gt; 10  1880 F     Sarah      1288
#&gt; # ... with 1,924,655 more rows
babynames %&gt;% select(year:n)
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 1,924,665 x 4
#&gt;     year sex   name          n
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;
#&gt;  1  1880 F     Mary       7065
#&gt;  2  1880 F     Anna       2604
#&gt;  3  1880 F     Emma       2003
#&gt;  4  1880 F     Elizabeth  1939
#&gt;  5  1880 F     Minnie     1746
#&gt;  6  1880 F     Margaret   1578
#&gt;  7  1880 F     Ida        1472
#&gt;  8  1880 F     Alice      1414
#&gt;  9  1880 F     Bertha     1320
#&gt; 10  1880 F     Sarah      1288
#&gt; # ... with 1,924,655 more rows
# starts_with(), ends_with(), contains()

babynames %&gt;% filter(name == &quot;Hadley&quot;)
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 163 x 5
#&gt;     year sex   name       n      prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;     &lt;dbl&gt;
#&gt;  1  1906 M     Hadley     6 0.0000416
#&gt;  2  1908 M     Hadley    16 0.0000962
#&gt;  3  1909 M     Hadley    14 0.0000792
#&gt;  4  1910 M     Hadley     5 0.0000240
#&gt;  5  1911 M     Hadley     9 0.0000373
#&gt;  6  1912 M     Hadley    11 0.0000244
#&gt;  7  1913 M     Hadley    10 0.0000186
#&gt;  8  1914 M     Hadley    15 0.0000220
#&gt;  9  1915 M     Hadley    14 0.0000159
#&gt; 10  1916 M     Hadley    14 0.0000152
#&gt; # ... with 153 more rows
babynames %&gt;% filter(year == 1900, sex == &quot;F&quot;)
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 2,224 x 5
#&gt;     year sex   name          n   prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;
#&gt;  1  1900 F     Mary      16706 0.0526
#&gt;  2  1900 F     Helen      6343 0.0200
#&gt;  3  1900 F     Anna       6114 0.0192
#&gt;  4  1900 F     Margaret   5304 0.0167
#&gt;  5  1900 F     Ruth       4765 0.0150
#&gt;  6  1900 F     Elizabeth  4096 0.0129
#&gt;  7  1900 F     Florence   3920 0.0123
#&gt;  8  1900 F     Ethel      3896 0.0123
#&gt;  9  1900 F     Marie      3856 0.0121
#&gt; 10  1900 F     Lillian    3414 0.0107
#&gt; # ... with 2,214 more rows
babynames %&gt;% filter(year == 2013, sex == &quot;F&quot;)
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 19,231 x 5
#&gt;     year sex   name          n    prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;
#&gt;  1  2013 F     Sophia    21213 0.0110 
#&gt;  2  2013 F     Emma      20936 0.0109 
#&gt;  3  2013 F     Olivia    18414 0.00957
#&gt;  4  2013 F     Isabella  17631 0.00916
#&gt;  5  2013 F     Ava       15249 0.00793
#&gt;  6  2013 F     Mia       13147 0.00683
#&gt;  7  2013 F     Emily     13124 0.00682
#&gt;  8  2013 F     Abigail   12405 0.00645
#&gt;  9  2013 F     Madison   10591 0.00551
#&gt; 10  2013 F     Elizabeth  9448 0.00491
#&gt; # ... with 19,221 more rows
</code></pre>
<p>函數<code>mutate()</code></p>
<pre><code class="language-r?lang=r?class=.source">babynames %&gt;%
  mutate(
    first = tolower(substr(name, 1, 1)),
    last = substr(name, nchar(name), nchar(name))
  )
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 1,924,665 x 7
#&gt;     year sex   name          n   prop first last 
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
#&gt;  1  1880 F     Mary       7065 0.0724 m     y    
#&gt;  2  1880 F     Anna       2604 0.0267 a     a    
#&gt;  3  1880 F     Emma       2003 0.0205 e     a    
#&gt;  4  1880 F     Elizabeth  1939 0.0199 e     h    
#&gt;  5  1880 F     Minnie     1746 0.0179 m     e    
#&gt;  6  1880 F     Margaret   1578 0.0162 m     t    
#&gt;  7  1880 F     Ida        1472 0.0151 i     a    
#&gt;  8  1880 F     Alice      1414 0.0145 a     e    
#&gt;  9  1880 F     Bertha     1320 0.0135 b     a    
#&gt; 10  1880 F     Sarah      1288 0.0132 s     h    
#&gt; # ... with 1,924,655 more rows

babynames %&gt;%
  arrange(desc(prop))
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 1,924,665 x 5
#&gt;     year sex   name        n   prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt;
#&gt;  1  1880 M     John     9655 0.0815
#&gt;  2  1881 M     John     8769 0.0810
#&gt;  3  1880 M     William  9532 0.0805
#&gt;  4  1883 M     John     8894 0.0791
#&gt;  5  1881 M     William  8524 0.0787
#&gt;  6  1882 M     John     9557 0.0783
#&gt;  7  1884 M     John     9388 0.0765
#&gt;  8  1882 M     William  9298 0.0762
#&gt;  9  1886 M     John     9026 0.0758
#&gt; 10  1885 M     John     8756 0.0755
#&gt; # ... with 1,924,655 more rows

babynames %&gt;%
  summarise(n = sum(n)) #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏對n欄位加總">🏷</span><!--/html_preserve-->
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 1 x 1
#&gt;           n
#&gt;       &lt;int&gt;
#&gt; 1 348120517
</code></pre>
<h3 id="分組">分組</h3>
<ul>
<li>函數<code>group_by()</code> 用來分組，不會影響到原來的資料,只是添加資訊</li>
<li>取消分組的函數為<code>ungroup()</code></li>
</ul>
<pre><code class="language-r?lang=r?class=.source">head(mtcars)
#&gt; [1] &quot;處理表格&quot;
</code></pre>

  
















<!--html_preserve--><div   class="table-responsive kable">
<table  class="w-50 ms-5">
<thead  class="">
<tr >
<th  style="text-align:left"></th>
<th  style="text-align:right">mpg</th>
<th  style="text-align:right">cyl</th>
<th  style="text-align:right">disp</th>
<th  style="text-align:right">hp</th>
<th  style="text-align:right">drat</th>
<th  style="text-align:right">wt</th>
<th  style="text-align:right">qsec</th>
<th  style="text-align:right">vs</th>
<th  style="text-align:right">am</th>
<th  style="text-align:right">gear</th>
<th  style="text-align:right">carb</th>
</tr>
</thead>
<tbody >
<tr >
<td  style="text-align:left">Mazda RX4</td>
<td  style="text-align:right">21.0</td>
<td  style="text-align:right">6</td>
<td  style="text-align:right">160</td>
<td  style="text-align:right">110</td>
<td  style="text-align:right">3.90</td>
<td  style="text-align:right">2.620</td>
<td  style="text-align:right">16.46</td>
<td  style="text-align:right">0</td>
<td  style="text-align:right">1</td>
<td  style="text-align:right">4</td>
<td  style="text-align:right">4</td>
</tr>
<tr >
<td  style="text-align:left">Mazda RX4 Wag</td>
<td  style="text-align:right">21.0</td>
<td  style="text-align:right">6</td>
<td  style="text-align:right">160</td>
<td  style="text-align:right">110</td>
<td  style="text-align:right">3.90</td>
<td  style="text-align:right">2.875</td>
<td  style="text-align:right">17.02</td>
<td  style="text-align:right">0</td>
<td  style="text-align:right">1</td>
<td  style="text-align:right">4</td>
<td  style="text-align:right">4</td>
</tr>
<tr >
<td  style="text-align:left">Datsun 710</td>
<td  style="text-align:right">22.8</td>
<td  style="text-align:right">4</td>
<td  style="text-align:right">108</td>
<td  style="text-align:right">93</td>
<td  style="text-align:right">3.85</td>
<td  style="text-align:right">2.320</td>
<td  style="text-align:right">18.61</td>
<td  style="text-align:right">1</td>
<td  style="text-align:right">1</td>
<td  style="text-align:right">4</td>
<td  style="text-align:right">1</td>
</tr>
<tr >
<td  style="text-align:left">Hornet 4 Drive</td>
<td  style="text-align:right">21.4</td>
<td  style="text-align:right">6</td>
<td  style="text-align:right">258</td>
<td  style="text-align:right">110</td>
<td  style="text-align:right">3.08</td>
<td  style="text-align:right">3.215</td>
<td  style="text-align:right">19.44</td>
<td  style="text-align:right">1</td>
<td  style="text-align:right">0</td>
<td  style="text-align:right">3</td>
<td  style="text-align:right">1</td>
</tr>
<tr >
<td  style="text-align:left">Hornet Sportabout</td>
<td  style="text-align:right">18.7</td>
<td  style="text-align:right">8</td>
<td  style="text-align:right">360</td>
<td  style="text-align:right">175</td>
<td  style="text-align:right">3.15</td>
<td  style="text-align:right">3.440</td>
<td  style="text-align:right">17.02</td>
<td  style="text-align:right">0</td>
<td  style="text-align:right">0</td>
<td  style="text-align:right">3</td>
<td  style="text-align:right">2</td>
</tr>
<tr >
<td  style="text-align:left">Valiant</td>
<td  style="text-align:right">18.1</td>
<td  style="text-align:right">6</td>
<td  style="text-align:right">225</td>
<td  style="text-align:right">105</td>
<td  style="text-align:right">2.76</td>
<td  style="text-align:right">3.460</td>
<td  style="text-align:right">20.22</td>
<td  style="text-align:right">1</td>
<td  style="text-align:right">0</td>
<td  style="text-align:right">3</td>
<td  style="text-align:right">1</td>
</tr>
</tbody>
</table>

</div><!--/html_preserve-->
<pre><code class="language-r?lang=r?class=.source">str(mtcars)
#&gt; 'data.frame':	32 obs. of  11 variables:
#&gt;  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
#&gt;  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
#&gt;  $ disp: num  160 160 108 258 360 ...
#&gt;  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
#&gt;  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
#&gt;  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
#&gt;  $ qsec: num  16.5 17 18.6 19.4 17 ...
#&gt;  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
#&gt;  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
#&gt;  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
#&gt;  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...
by_cyl &lt;- mtcars %&gt;% group_by(cyl)
head(by_cyl) #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏可以看到只是添加資訊,原來的資料欄位沒變">🏷</span><!--/html_preserve-->
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 6 x 11
#&gt; # Groups:   cyl [3]
#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1  21       6   160   110  3.9   2.62  16.5     0     1     4     4
#&gt; 2  21       6   160   110  3.9   2.88  17.0     0     1     4     4
#&gt; 3  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1
#&gt; 4  21.4     6   258   110  3.08  3.22  19.4     1     0     3     1
#&gt; 5  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2
#&gt; 6  18.1     6   225   105  2.76  3.46  20.2     1     0     3     1
str(by_cyl)
#&gt; grouped_df [32 x 11] (S3: grouped_df/tbl_df/tbl/data.frame)
#&gt;  $ mpg : num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
#&gt;  $ cyl : num [1:32] 6 6 4 6 8 6 8 4 4 6 ...
#&gt;  $ disp: num [1:32] 160 160 108 258 360 ...
#&gt;  $ hp  : num [1:32] 110 110 93 110 175 105 245 62 95 123 ...
#&gt;  $ drat: num [1:32] 3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
#&gt;  $ wt  : num [1:32] 2.62 2.88 2.32 3.21 3.44 ...
#&gt;  $ qsec: num [1:32] 16.5 17 18.6 19.4 17 ...
#&gt;  $ vs  : num [1:32] 0 0 1 1 0 1 0 1 1 1 ...
#&gt;  $ am  : num [1:32] 1 1 1 0 0 0 0 0 0 0 ...
#&gt;  $ gear: num [1:32] 4 4 4 3 3 3 3 4 4 4 ...
#&gt;  $ carb: num [1:32] 4 4 1 1 2 1 4 2 2 4 ...
#&gt;  - attr(*, &quot;groups&quot;)= tibble [3 x 2] (S3: tbl_df/tbl/data.frame)
#&gt;   ..$ cyl  : num [1:3] 4 6 8
#&gt;   ..$ .rows: list&lt;int&gt; [1:3] 
#&gt;   .. ..$ : int [1:11] 3 8 9 18 19 20 21 26 27 28 ...
#&gt;   .. ..$ : int [1:7] 1 2 4 6 10 11 30
#&gt;   .. ..$ : int [1:14] 5 7 12 13 14 15 16 17 22 23 ...
#&gt;   .. ..@ ptype: int(0) 
#&gt;   ..- attr(*, &quot;.drop&quot;)= logi TRUE
</code></pre>
<p>但是分組結果會影響其他dplyr指令的計算結果:</p>
<pre><code class="language-r?lang=r?class=.source">by_cyl %&gt;% summarise( disp = mean(disp),  hp = mean(hp) )
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 3 x 3
#&gt;     cyl  disp    hp
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     4  105.  82.6
#&gt; 2     6  183. 122. 
#&gt; 3     8  353. 209.
by_cyl %&gt;% filter(disp == max(disp))
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 3 x 11
#&gt; # Groups:   cyl [3]
#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
#&gt; 2  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
#&gt; 3  10.4     8  472    205  2.93  5.25  18.0     0     0     3     4
</code></pre>
<pre><code class="language-r?lang=r?class=.source">dplyr::group_by(iris, Species)
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 150 x 5
#&gt; # Groups:   Species [3]
#&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
#&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
#&gt;  1          5.1         3.5          1.4         0.2 setosa 
#&gt;  2          4.9         3            1.4         0.2 setosa 
#&gt;  3          4.7         3.2          1.3         0.2 setosa 
#&gt;  4          4.6         3.1          1.5         0.2 setosa 
#&gt;  5          5           3.6          1.4         0.2 setosa 
#&gt;  6          5.4         3.9          1.7         0.4 setosa 
#&gt;  7          4.6         3.4          1.4         0.3 setosa 
#&gt;  8          5           3.4          1.5         0.2 setosa 
#&gt;  9          4.4         2.9          1.4         0.2 setosa 
#&gt; 10          4.9         3.1          1.5         0.1 setosa 
#&gt; # ... with 140 more rows
#Group data into rows with the same value of Species.
#dplyr::ungroup(iris) #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏僅僅移除分組資訊">🏷</span><!--/html_preserve-->

iris %&gt;% group_by(Species) %&gt;% summarise(mean=mean(Sepal.Length))
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 3 x 2
#&gt;   Species     mean
#&gt;   &lt;fct&gt;      &lt;dbl&gt;
#&gt; 1 setosa      5.01
#&gt; 2 versicolor  5.94
#&gt; 3 virginica   6.59
</code></pre>
<h3 id="報告">報告</h3>
<p>函數<code>summarise()</code></p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="10_00_dplyrBasic01.files/summarise1.png" alt=""></td>
<td style="text-align:center"><img src="10_00_dplyrBasic01.files/summarise2.png" alt=""></td>
</tr>
</tbody>
</table>
<p>summarize() 可以用的函數型態是輸入向量,輸出一個值得函數。例如</p>
<ul>
<li>mean(): the mean AKA the average</li>
<li>sd(): the standard deviation, which is a measure of spread</li>
<li>min() and max(): the minimum and maximum values respectively</li>
<li>IQR(): Interquartile range</li>
<li>sum(): the sum</li>
<li>n(): 每組觀察數目。可以用來配套<code>group_by()</code>。</li>
</ul>
<h2 id="實驗-pipeline-vs-no-pipeline">實驗 pipeline vs no pipeline</h2>
<ul>
<li>x %&gt;% f(y) &lt;===&gt;  f(x, y) <!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏S3 object">🏷</span><!--/html_preserve--></li>
<li>y %&gt;% f(x, ., z) &lt;===&gt; f(x, y, z ) #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏取代逗點">🏷</span><!--/html_preserve--></li>
</ul>
<ol>
<li>
<p>產生資料</p>
<pre><code class="language-r?lang=r?class=.source?preclass=">year=c(1990,	1991,	1990,	1991,	1990,	1991,	1990,	1991,	1990,	1991) 
sex=c(&quot;f&quot;,	&quot;f&quot;,	&quot;f&quot;,	&quot;f&quot;,	&quot;f&quot;,	&quot;m&quot;,	&quot;m&quot;,	&quot;m&quot;,	&quot;m&quot;,	&quot;m&quot;)
#value=c(1,	2,	3,	4,	5,	1,	2,	3,	4,	5)
value=c(1,	2,	3,	4,	5,	6,	7,	8,	9,	10)
odf&lt;-data.frame(sex,year,value)
head(odf)
#&gt; [1] &quot;處理表格&quot;
</code></pre>

  
















<!--html_preserve--><div   class="table-responsive kable">
<table  class="">
<thead  class="">
<tr >
<th  style="text-align:right">sex</th>
<th  style="text-align:right">year</th>
<th  style="text-align:right">value</th>
</tr>
</thead>
<tbody >
<tr >
<td  style="text-align:right">f</td>
<td  style="text-align:right">1990</td>
<td  style="text-align:right">1</td>
</tr>
<tr >
<td  style="text-align:right">f</td>
<td  style="text-align:right">1991</td>
<td  style="text-align:right">2</td>
</tr>
<tr >
<td  style="text-align:right">f</td>
<td  style="text-align:right">1990</td>
<td  style="text-align:right">3</td>
</tr>
<tr >
<td  style="text-align:right">f</td>
<td  style="text-align:right">1991</td>
<td  style="text-align:right">4</td>
</tr>
<tr >
<td  style="text-align:right">f</td>
<td  style="text-align:right">1990</td>
<td  style="text-align:right">5</td>
</tr>
<tr >
<td  style="text-align:right">m</td>
<td  style="text-align:right">1991</td>
<td  style="text-align:right">6</td>
</tr>
</tbody>
</table>

</div><!--/html_preserve-->
</li>
<li>
<p>不用 pipeline</p>
<pre><code class="language-r?lang=r?class=.source?preclass=">df&lt;-group_by(odf,sex)
ndf&lt;-mutate(df,rank=min_rank(value)) # <!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏增加新欄位">🏷</span><!--/html_preserve-->
arrange(ndf,sex) #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏根據sex由低到高排序">🏷</span><!--/html_preserve-->
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 10 x 4
#&gt; # Groups:   sex [2]
#&gt;    sex    year value  rank
#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
#&gt;  1 f      1990     1     1
#&gt;  2 f      1991     2     2
#&gt;  3 f      1990     3     3
#&gt;  4 f      1991     4     4
#&gt;  5 f      1990     5     5
#&gt;  6 m      1991     6     1
#&gt;  7 m      1990     7     2
#&gt;  8 m      1991     8     3
#&gt;  9 m      1990     9     4
#&gt; 10 m      1991    10     5
</code></pre>
</li>
<li>
<p>使用 pipeline</p>
<pre><code class="language-r?lang=r?class=.source?preclass=">ndf&lt;-odf %&gt;%
  group_by(sex) %&gt;%
  mutate(rank = min_rank(value)) 

arrange(ndf,sex)
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 10 x 4
#&gt; # Groups:   sex [2]
#&gt;    sex    year value  rank
#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
#&gt;  1 f      1990     1     1
#&gt;  2 f      1991     2     2
#&gt;  3 f      1990     3     3
#&gt;  4 f      1991     4     4
#&gt;  5 f      1990     5     5
#&gt;  6 m      1991     6     1
#&gt;  7 m      1990     7     2
#&gt;  8 m      1991     8     3
#&gt;  9 m      1990     9     4
#&gt; 10 m      1991    10     5
</code></pre>
</li>
</ol>
<p>看看其他範例</p>
<pre><code class="language-r?lang=r?class=.source">df %&gt;% group_by(sex) %&gt;%str() #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏分組以後放到非dyplr套件的函數&lt;code&gt;str()&lt;/code&gt;要看結構,結果並沒有產生兩個分組結構，也就是說&lt;code&gt;str()&lt;/code&gt;不認識分組結構">🏷</span><!--/html_preserve-->
#&gt; grouped_df [10 x 3] (S3: grouped_df/tbl_df/tbl/data.frame)
#&gt;  $ sex  : chr [1:10] &quot;f&quot; &quot;f&quot; &quot;f&quot; &quot;f&quot; ...
#&gt;  $ year : num [1:10] 1990 1991 1990 1991 1990 ...
#&gt;  $ value: num [1:10] 1 2 3 4 5 6 7 8 9 10
#&gt;  - attr(*, &quot;groups&quot;)= tibble [2 x 2] (S3: tbl_df/tbl/data.frame)
#&gt;   ..$ sex  : chr [1:2] &quot;f&quot; &quot;m&quot;
#&gt;   ..$ .rows: list&lt;int&gt; [1:2] 
#&gt;   .. ..$ : int [1:5] 1 2 3 4 5
#&gt;   .. ..$ : int [1:5] 6 7 8 9 10
#&gt;   .. ..@ ptype: int(0) 
#&gt;   ..- attr(*, &quot;.drop&quot;)= logi TRUE

babynames %&gt;%
  group_by(name) %&gt;%
  summarise(n = sum(n)) #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏n 是欄位名稱">🏷</span><!--/html_preserve-->
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 97,310 x 2
#&gt;    name          n
#&gt;    &lt;chr&gt;     &lt;int&gt;
#&gt;  1 Aaban       107
#&gt;  2 Aabha        35
#&gt;  3 Aabid        10
#&gt;  4 Aabir         5
#&gt;  5 Aabriella    32
#&gt;  6 Aada          5
#&gt;  7 Aadam       254
#&gt;  8 Aadan       130
#&gt;  9 Aadarsh     199
#&gt; 10 Aaden      4658
#&gt; # ... with 97,300 more rows
  
babynames %&gt;%
  filter(name %in% c(&quot;John&quot;, &quot;Mary&quot;, &quot;William&quot;)) %&gt;%
  group_by(name, sex) %&gt;%
  summarise(n = sum(n))
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 6 x 3
#&gt; # Groups:   name [3]
#&gt;   name    sex         n
#&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;
#&gt; 1 John    F       21676
#&gt; 2 John    M     5115466
#&gt; 3 Mary    F     4123200
#&gt; 4 Mary    M       15160
#&gt; 5 William F       15949
#&gt; 6 William M     4102604

babynames %&gt;%
  group_by(year, sex) %&gt;%
  mutate(rank = min_rank(desc(n))) %&gt;%
  tail() #<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏只看後幾筆">🏷</span><!--/html_preserve-->
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 6 x 6
#&gt; # Groups:   year, sex [1]
#&gt;    year sex   name       n       prop  rank
#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;      &lt;dbl&gt; &lt;int&gt;
#&gt; 1  2017 M     Zyhier     5 0.00000255 12171
#&gt; 2  2017 M     Zykai      5 0.00000255 12171
#&gt; 3  2017 M     Zykeem     5 0.00000255 12171
#&gt; 4  2017 M     Zylin      5 0.00000255 12171
#&gt; 5  2017 M     Zylis      5 0.00000255 12171
#&gt; 6  2017 M     Zyrie      5 0.00000255 12171
</code></pre>
<h2 id="練習">練習</h2>
<hr>
<ol>
<li>
<p>名叫Hadley 的男女各多少人?</p>
<pre><code class="language-r?lang=r?class=.source?preclass=">babynames %&gt;%
  filter(name == &quot;Hadley&quot;) %&gt;%
  group_by(sex) %&gt;%
  summarise(n = sum(n))
#&gt; [1] &quot;處理表格&quot;
#&gt; # A tibble: 2 x 2
#&gt;   sex       n
#&gt;   &lt;chr&gt; &lt;int&gt;
#&gt; 1 F     26708
#&gt; 2 M      1883
</code></pre>
</li>
<li>
<p>The travesty延續上題，各年的的男女Hadley數目?</p>
<pre><code class="language-r?lang=r?class=.source?preclass=">library(ggplot2)
#<!--html_preserve--><span  data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" title="👏過濾出來,然後按照年度(x),出生數(y)作圖">🏷</span><!--/html_preserve-->
babynames %&gt;%
  filter(name == &quot;Hadley&quot;) %&gt;%
  ggplot(aes(year, n,color=sex)) + 
  geom_line() 
</code></pre>
<!--html_preserve--><figure  class="figure nopre    "><img src="10_00_dplyrBasic01_files/figure-html/unnamed-chunk-20-1.png" class="figure-img w-100 "/><figcaption class="figure-caption">
figure</figcaption></figure><!--/html_preserve-->
</li>
</ol>
<p>也可以</p>
<pre><code>
    babynames %&gt;%
      filter(name == &quot;Hadley&quot;) %&gt;%
      ggplot(aes(year, n)) + 
        geom_line(aes(colour = sex)) 


</code></pre>
  </article><div class="collapse fs-6 pt-2" id="qnote-list">
    <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-white ">
        <span >
            
            <span class="fw-semibold">
                <button  class="btn btn-primary btn-inline" 
                   data-bs-toggle="collapse" data-bs-target="#qnote-edit"><span data-bs-toggle="tooltip" title="加入速記">加</span></button>
                <button id="qnote-gsave" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="存到硬碟"
                   onclick="qnSaveGoogle()">存</button>
                <label for="qnote-load" class="btn btn-primary btn-inline"  data-bs-toggle="tooltip" data-bs-placement="left" title="從檔案載入">載</label>   
                <input style="display:none" type="file" id="qnote-load" onchange="qnLoadGoogle(this)" />
                <button id="qnote-clear" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="清除全部速記"
                   onclick="cleanNotes()">清</button>
            </span>
        </span>
        <span class="fw-semibold collapse" id="qnote-edit"> 
            <input type="text" class="txtitle d-block w-100 h-25 " placeholder="抬頭" />
            <textarea class="txtBox  d-block w-100 h-75 " placeholder="本文"></textarea>
            
            <button id="qnote-add-item" onclick="addNote()" class="btn btn-primary">存</button> 
        </span>

    </div>
</div>

<link href="/blogR/css/quicknote.css?1641445339" rel="stylesheet">
<script src="/blogR/js/quicknote.js?1641445339"></script>
<div id="page-guide" class="bg-dark">  
  <a id="avator" href="/api/list" 
  class="btn btn-primary d-none"  data-bs-toggle="tooltip"  data-bs-placement="left" title=""><img style="padding:0px"class="img-fluid "></a>

  
    
          
          <a href="/blogR/rlang/1_5_%E7%B7%A8%E7%A2%BC.html" 
                   class="btn btn-primary" 
                   data-bs-toggle="tooltip" 
                   data-bs-placement="left" title=1.5&#32;編碼>前</a>
                   
          
            <a href="/blogR/rlang/11_environments.html" 
               class="btn btn-primary" data-bs-toggle="tooltip" data-bs-placement="left" 
               title=11&#32;Environments>後</a>            
          
          

  
<script src="/blogR/js/packhtml.js?1641445339"></script>    
<button class="btn btn-primary " onclick="packthis(this)"
data-bs-toggle="tooltip" data-bs-placement="left" title="打包成單一檔案">包</button>
<button class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="div#qnote-list">
  <span data-bs-toggle="tooltip" data-bs-placement="left" title="快速註記">速</span></button>
 
</div>
</div>


  <script src="/blogR/js/featherlight.min.js?1641445339"></script>
  <script src="/blogR/js/featherlight.gallery.min.js?1641445339"></script>
  <link href="/blogR/css/featherlight.min.css?1641445339" rel="stylesheet">
  <link href="/blogR/css/featherlight.gallery.min.css?1641445339" rel="stylesheet">
  
  <script src="/blogR/js/highlight.min.js"></script>
  
  <script src="/blogR/js/hugohelper.js?1641445339"></script>
  <link href="/blogR/css/rmd.css?1641445339" rel="stylesheet">
  <link href="/blogR/css/mystyle.css?1641445339" rel="stylesheet">    
  <script src='/blogR/js/variant.js?1641445339'></script>

<script>
  
   let idxfile = "https:\/\/airbone4.github.io\/blogR\/index.json"  
  
</script>
<script src='/blogR/js/localsearch.js?1641445339'></script>
  
      
          <script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script>
      
      <script>
          mermaid.initialize({ startOnLoad: true });
      </script>
  

  <script>
      MathJax = {
        tex: {
          inlineMath: [['\($', '$\)'], ['\\(', '\\)']],
          displayMath: [['$$','$$']  , ['\\[','\\]']] 
        },
        svg: {
          fontCache: 'global'
        }
      };
      
      
    
      </script>

      <script type="text/javascript" id="MathJax-script" async
      src='/blogR/js/tex-svg.js'>
      </script>



<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    jumpto = document.querySelector("#sidebar .active");
     if (jumpto!=null) jumpto.scrollIntoViewIfNeeded(true);
  
  });    
  
  </script>
</body>
</html>