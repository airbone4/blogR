<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.76.5" />
    <meta name="description" content="更多R函數">


    <link rel="shortcut icon" href="../images/favicon.png" type="image/x-icon" />
<link rel="icon" href="../images/favicon.png" type="image/x-icon" />

    <title>Function more - R in Class</title>

    
    <link href="../css/nucleus.css?1606368037" rel="stylesheet">
    <link href="../css/fontawesome-all.min.css?1606368037" rel="stylesheet">
    <link href="../css/hybrid.css?1606368037" rel="stylesheet">
    <link href="../css/featherlight.min.css?1606368037" rel="stylesheet">
    <link href="../css/perfect-scrollbar.min.css?1606368037" rel="stylesheet">
    <link href="../css/auto-complete.css?1606368037" rel="stylesheet">
    <link href="../css/atom-one-dark-reasonable.css?1606368037" rel="stylesheet">
    <link href="../css/theme.css?1606368037" rel="stylesheet">
    <link href="../css/hugo-theme.css?1606368037" rel="stylesheet">
    
    <link href="../extra_theme/css/mystyle.css?1606368037" rel="stylesheet"><link href="../extra_theme/css/demoContainer.css?1606368037" rel="stylesheet"><link href="../extra_theme/css/rmd.css?1606368037" rel="stylesheet">

    <script src="../js/jquery-3.3.1.min.js?1606368037"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="../rlang/function_2.html">

    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://airbon5.github.io/xx/">
  <img src=../extra_theme/images/rmi.png>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../js/lunr.min.js?1606368037"></script>
<script type="text/javascript" src="../js/auto-complete.js?1606368037"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="../js/search.js?1606368037"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='../'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/rlang.html" title="R language" class="dd-item
        parent
        
        
        ">
      <a href="../rlang.html">
          R language
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/rlang/requirement.html" title="Requirement" class="dd-item ">
        <a href="../rlang/requirement.html">
        Requirement
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/data_explorer_1.html" title="data explorer 1" class="dd-item ">
        <a href="../rlang/data_explorer_1.html">
        data explorer 1
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/data_explorer_2.html" title="data explorer 2" class="dd-item ">
        <a href="../rlang/data_explorer_2.html">
        data explorer 2
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/quickview1.html" title="Quick view 1" class="dd-item ">
        <a href="../rlang/quickview1.html">
        Quick view 1
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/regular_expression.html" title="Regular expression syntax" class="dd-item ">
        <a href="../rlang/regular_expression.html">
        Regular expression syntax
        
        </a>
    </li>
     
  
 

            
          
            
            
          
            
            




 
  
    
      <li data-nav-id="/rlang/type_basic.html" title="type basic" class="dd-item ">
        <a href="../rlang/type_basic.html">
        type basic
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/type_list.html" title="type list" class="dd-item ">
        <a href="../rlang/type_list.html">
        type list
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/type_matrix.html" title="type matrix" class="dd-item ">
        <a href="../rlang/type_matrix.html">
        type matrix
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/type_more.html" title="type more" class="dd-item ">
        <a href="../rlang/type_more.html">
        type more
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/type_post.html" title="type post" class="dd-item ">
        <a href="../rlang/type_post.html">
        type post
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/type_string_function.html" title="type string" class="dd-item ">
        <a href="../rlang/type_string_function.html">
        type string
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/type_vector.html" title="type vector" class="dd-item ">
        <a href="../rlang/type_vector.html">
        type vector
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/filesystem.html" title="File System" class="dd-item ">
        <a href="../rlang/filesystem.html">
        File System
        
        </a>
    </li>
     
  
 

            
          
            
            
          
            
            




 
  
    
      <li data-nav-id="/rlang/programming_1.html" title="Programming 1" class="dd-item ">
        <a href="../rlang/programming_1.html">
        Programming 1
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/apply_family.html" title="function - apply family" class="dd-item ">
        <a href="../rlang/apply_family.html">
        function - apply family
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/function_1.html" title="Function basic" class="dd-item ">
        <a href="../rlang/function_1.html">
        Function basic
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/function_2.html" title="Function more" class="dd-item active">
        <a href="../rlang/function_2.html">
        Function more
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/rpackages.html" title="R Package" class="dd-item ">
        <a href="../rlang/rpackages.html">
        R Package
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/plot01.html" title="Plot 01" class="dd-item ">
        <a href="../rlang/plot01.html">
        Plot 01
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/plot02.html" title="Plot more" class="dd-item ">
        <a href="../rlang/plot02.html">
        Plot more
        
        </a>
    </li>
     
  
 

            
          
            
            
          
            
            




 
  
    
      <li data-nav-id="/rlang/environments.html" title="Environment" class="dd-item ">
        <a href="../rlang/environments.html">
        Environment
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/sampling.html" title="sampling" class="dd-item ">
        <a href="../rlang/sampling.html">
        sampling
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/eco_01_intro.html" title="Econometrics" class="dd-item ">
        <a href="../rlang/eco_01_intro.html">
        Econometrics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/sim_1.html" title="simulation 1" class="dd-item ">
        <a href="../rlang/sim_1.html">
        simulation 1
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/hw/hw_basic.html" title="assignment-1" class="dd-item ">
        <a href="../rlang/hw/hw_basic.html">
        assignment-1
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rlang/hw/hw_regexp.html" title="regexpr" class="dd-item ">
        <a href="../rlang/hw/hw_regexp.html">
        regexpr
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/topic.html" title="Topics" class="dd-item
        
        
        
        ">
      <a href="../topic.html">
          Topics
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/topic/rmd/rmd_basic.html" title="Rmd basic" class="dd-item ">
        <a href="../topic/rmd/rmd_basic.html">
        Rmd basic
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/topic/rmd/rmd_hook.html" title="Rmd hook" class="dd-item ">
        <a href="../topic/rmd/rmd_hook.html">
        Rmd hook
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/topic/rmd/rmd_pdf.html" title="Rmd pdf" class="dd-item ">
        <a href="../topic/rmd/rmd_pdf.html">
        Rmd pdf
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/topic/rmd/rmd_topic_1.html" title="rmd topic 1" class="dd-item ">
        <a href="../topic/rmd/rmd_topic_1.html">
        rmd topic 1
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/topic/rmd/git-book-note.html" title="git book note" class="dd-item ">
        <a href="../topic/rmd/git-book-note.html">
        git book note
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/topic/interesting.html" title="interesting" class="dd-item ">
        <a href="../topic/interesting.html">
        interesting
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/topic/experiment.html" title="實驗" class="dd-item
        
        
        
        ">
      <a href="../topic/experiment.html">
          實驗
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/topic/experiment/central.html" title="中央" class="dd-item ">
        <a href="../topic/experiment/central.html">
        中央
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/topic/test.html" title="網頁測試" class="dd-item
        
        
        
        ">
      <a href="../topic/test.html">
          網頁測試
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/topic/test/emo_test.html" title="emoji_test" class="dd-item ">
        <a href="../topic/test/emo_test.html">
        emoji_test
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/topic/test/testpage.html" title="testpage" class="dd-item ">
        <a href="../topic/test/testpage.html">
        testpage
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../'>class log</a> > <a href='../rlang.html'>R language</a> > Function more
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li><a href="#functions">Functions</a>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#quiz">Quiz</a></li>
<li><a href="#outline">Outline</a></li>
</ul></li>
<li><a href="#function-fundamentals">Function fundamentals</a>
<ul>
<li><a href="#first-class-functions">First-class functions</a></li>
<li><a href="#function-components">Function components</a></li>
<li><a href="#primitive-functions">Primitive functions</a></li>
<li><a href="#exercises">Exercises</a></li>
</ul></li>
<li><a href="#lexical-scoping">Lexical scoping</a>
<ul>
<li><a href="#name-masking">Name masking</a></li>
<li><a href="#functions-vs-variables">Functions vs. variables</a></li>
<li><a href="#fresh-start">A fresh start</a></li>
<li><a href="#dynamic-lookup">Dynamic lookup</a></li>
<li><a href="#exercises-1">Exercises</a></li>
</ul></li>
<li><a href="#lazy-evaluation">Lazy evaluation</a>
<ul>
<li><a href="#forcing-evaluation">Forcing evaluation</a></li>
<li><a href="#promises-skip">Promises (skip)</a></li>
<li><a href="#default-arguments">Default arguments</a></li>
<li><a href="#missing-arguments">Missing arguments</a></li>
</ul></li>
<li><a href="#exiting-a-function">Exiting a function</a>
<ul>
<li><a href="#implicit-vs-explict-returns">Implicit vs. explict returns</a></li>
<li><a href="#invisible-values">Invisible values</a></li>
<li><a href="#errors">Errors</a></li>
<li><a href="#on-exit">Exit handlers</a></li>
<li><a href="#exercises-2">Exercises</a></li>
</ul></li>
<li><a href="#function-forms-skip">Function forms (skip)</a>
<ul>
<li><a href="#rewriting-to-prefix-form">Rewriting to prefix form</a></li>
<li><a href="#prefix-form">Prefix form</a></li>
<li><a href="#infix-functions">Infix functions</a></li>
<li><a href="#replacement-functions">Replacement functions</a></li>
<li><a href="#special-forms">Special forms</a></li>
</ul></li>
<li><a href="#invoking-a-function">Invoking a function</a>
<ul>
<li><a href="#exercises-3">Exercises</a></li>
</ul></li>
<li><a href="#function-answers">Quiz answers</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Function more

            </h1>
			
          

        




<h1 id="functions">Functions</h1>

<h2 id="introduction">Introduction</h2>

<p>簡單測試</p>

<h3 id="quiz">Quiz</h3>

<p>Answer the following questions to see if you can safely skip this chapter. You can find the answers in <a href="#function-answer">function-answer</a>.</p>

<ol>
<li>What are the three components of a function?<br /></li>

<li><p>What does the following code return?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
f1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  <span style="color:#a6e22e">function</span>() {
    x <span style="color:#f92672">+</span> <span style="color:#ae81ff">10</span>
  }
}
<span style="color:#a6e22e">f1</span>(<span style="color:#ae81ff">1</span>)()</code></pre></div></li>

<li><p>How would you usually write this code?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">`+`</span>(<span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">`*`</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>))</code></pre></div></li>

<li><p>How could you make this call easier to read?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">mean</span>(, <span style="color:#66d9ef">TRUE</span>, x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#66d9ef">NA</span>))</code></pre></div></li>

<li><p>Does the following code throw an error when executed? Why/why not?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">f2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(a, b) {
  a <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>
}
<span style="color:#a6e22e">f2</span>(<span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">stop</span>(<span style="color:#e6db74">&#34;This is an error!&#34;</span>))</code></pre></div></li>

<li><p>What is an infix function? How do you write it? What&rsquo;s a replacement function? How do you write it?</p></li>

<li><p>How do you ensure that cleanup action occurs regardless of how a function exits?</p></li>
</ol>

<h3 id="outline">Outline</h3>

<ul>
<li>Section <a href="#function-fundamentals">Function fundamentals</a> describes the basics of creating a<br />
function, the three main components of a function, and the exception to many function rules: primitive functions (which are implemented in C, not R).<br /></li>
<li>Section <a href="#lexical-scoping">lexical scoping</a> shows you how R finds the value associated with a given name, i.e. the rules of lexical scoping.<br /></li>
<li>Section <a href="#lazy-evaluation">lazy evaluation</a> is devoted to an important property of function arguments: they are only evaluated when used for the first time.<br /></li>
<li>Section <a href="#exiting-a-function">existing a function</a> discusses the two primary ways that a function can exit, and how to define an exit handler, code that is run on exit, regardless of what triggers it.<br /></li>
<li>Section <a href="#function-forms">function-forms</a> shows you the various ways in which R disguises ordinary function calls, and how you can use the standard prefix form to better understand what&rsquo;s going on.<br />
<br /></li>
</ul>

<h2 id="function-fundamentals">Function fundamentals</h2>

<p>幾個重要觀念</p>

<ul>
<li>函數也是物件,就像是vectors 也是物件。<br /></li>
<li>由三個部份組成: arguments, body, and environment.<br />
<br /></li>
</ul>

<p>但是規則都會被打破,例外大概都利用C寫成的 &ldquo;primitive&rdquo; base functions。</p>

<h3 id="first-class-functions">First-class functions</h3>

<p>在R中,函數也是物件,這種特性也叫做 &ldquo;first-class functions&rdquo;. 如下:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">f01 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  <span style="color:#a6e22e">sin</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> x ^ <span style="color:#ae81ff">2</span>)
}</code></pre></div>
<p><img src="../diagrams/functions/first-class.png" alt="plot of chunk unnamed-chunk-6" /></p>

<p>匿名函數:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">lapply</span>(mtcars, <span style="color:#a6e22e">function</span>(x) <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(x)))
<span style="color:#a6e22e">Filter</span>(<span style="color:#a6e22e">function</span>(x) <span style="color:#f92672">!</span><span style="color:#a6e22e">is.numeric</span>(x), mtcars)
<span style="color:#a6e22e">integrate</span>(<span style="color:#a6e22e">function</span>(x) <span style="color:#a6e22e">sin</span>(x) ^ <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">pi</span>)</code></pre></div>
<p>在list中,也可以放入函數:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">funs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(
  half <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(x) x <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>,
  double <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(x) x <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
)

funs<span style="color:#f92672">$</span><span style="color:#a6e22e">double</span>(<span style="color:#ae81ff">10</span>)
<span style="color:#75715e">#&gt; [1] 20</span></code></pre></div>
<p>在R語言中,函數有時叫做closure因為,R函數包含(enclose)它們的環境 environments.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">typeof</span>(f01)
<span style="color:#75715e">#&gt; [1] &#34;closure&#34;</span></code></pre></div>
<h3 id="function-components">Function components</h3>

<p>1個函數有3個部分:</p>

<ul>
<li><code>formals()</code>, 參數<br /></li>
<li><code>body()</code>, {}內部.<br /></li>
<li><code>environment()</code>, 決定函數怎樣找出變數(names)的內容。.<br />
<br /></li>
</ul>

<p><img src="../diagrams/functions/components.png" alt="plot of chunk unnamed-chunk-10" /></p>

<p>測試3部分</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">f02 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  <span style="color:#75715e"># A comment</span>
  x ^ <span style="color:#ae81ff">2</span>
}

<span style="color:#a6e22e">formals</span>(f02)
<span style="color:#75715e">#&gt; $x</span>

<span style="color:#a6e22e">body</span>(f02)
<span style="color:#75715e">#&gt; {</span>
<span style="color:#75715e">#&gt;     x^2</span>
<span style="color:#75715e">#&gt; }</span>

<span style="color:#a6e22e">environment</span>(f02)
<span style="color:#75715e">#&gt; &lt;environment: R_GlobalEnv&gt;</span></code></pre></div>
<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
        
        :?:
        
        </span>
    </div>
    <div class="expand-content" style="display: none;">
       
 函數的environment 都會存在,但是在整體環境中定義的函數,不會被顯示。
上面的environment(f02)有顯示environment. why()?

    </div>
</div>

<p>👍就像所以其他R的物件,函數也有很多 <code>attributes()</code>. 其中一個 &ldquo;srcref&rdquo;, 是 source reference的縮寫。 　</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">attr</span>(f02, <span style="color:#e6db74">&#34;srcref&#34;</span>)
<span style="color:#75715e">#&gt; function(x) {</span>
<span style="color:#75715e">#&gt;   # A comment</span>
<span style="color:#75715e">#&gt;   x ^ 2</span>
<span style="color:#75715e">#&gt; }</span></code></pre></div>
<h3 id="primitive-functions">Primitive functions</h3>

<p>３個組件的規則有例外，像是 Primitive functions, like <code>sum()</code> and <code>[</code>, 直接調用Ｃ語言。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">sum
<span style="color:#75715e">#&gt; function (..., na.rm = FALSE)  .Primitive(&#34;sum&#34;)</span>
`[`
<span style="color:#75715e">#&gt; .Primitive(&#34;[&#34;)</span></code></pre></div>
<p>看一下type<br />
分別屬於 &ldquo;builtin&rdquo; or &ldquo;special&rdquo;:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">typeof</span>(sum)
<span style="color:#75715e">#&gt; [1] &#34;builtin&#34;</span>
<span style="color:#a6e22e">typeof</span>(`[`)
<span style="color:#75715e">#&gt; [1] &#34;special&#34;</span></code></pre></div>
<p>因此， <code>formals()</code>, <code>body()</code>, and <code>environment()</code> 都回傳 <code>NULL</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">formals</span>(sum)
<span style="color:#75715e">#&gt; NULL</span>
<span style="color:#a6e22e">body</span>(sum)
<span style="color:#75715e">#&gt; NULL</span>
<span style="color:#a6e22e">environment</span>(sum)
<span style="color:#75715e">#&gt; NULL</span></code></pre></div>
<p>這些所謂的原始函數，只存在於基本套件(base packages) 。.</p>

<h3 id="exercises">Exercises</h3>

<ol>
<li><p>It&rsquo;s possible (although typically not useful) to call an anonymous function.<br />
Which of the two approaches below is correct? Why?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">function</span>(x) <span style="color:#ae81ff">3</span>()
<span style="color:#75715e">#&gt; function(x) 3()</span>
(<span style="color:#a6e22e">function</span>(x) <span style="color:#ae81ff">3</span>)()
<span style="color:#75715e">#&gt; [1] 3</span></code></pre></div></li>

<li><p>A good rule of thumb is that an anonymous function should fit on one line and shouldn&rsquo;t need to use <code>{}</code>.</p></li>

<li><p>This code makes a list of all functions in the base package.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">objs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mget</span>(<span style="color:#a6e22e">ls</span>(<span style="color:#e6db74">&#34;package:base&#34;</span>), inherits <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
funs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Filter</span>(is.function, objs)</code></pre></div>
<p>Use it to answer the following questions:</p>

<p>a. Which base function has the most arguments?<br />
a. How many base functions have no arguments? What&rsquo;s special about those functions?<br />
a. How could you adapt the code to find all primitive functions?</p></li>

<li><p>What are the three important components of a function?</p></li>

<li><p>When does printing a function not show the environment it was created in?</p></li>
</ol>

<h2 id="lexical-scoping">Lexical scoping</h2>

<p>In [Names and values], we discussed assignment, the act of binding a name to a value. Here we&rsquo;ll discuss <strong>scoping</strong>, the act of finding the value associated with a name.</p>

<p>下面的執行結果傳回10還是20?</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
        
        answer
        
        </span>
    </div>
    <div class="expand-content" style="display: none;">
       

 `20`.


    </div>
</div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
g01 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">20</span>
  x
}

<span style="color:#a6e22e">g01</span>()</code></pre></div>
<p>了解範圍規則,有助於函數的模組開發,甚至有助於將R翻譯到其他語言。</p>

<p>*lexical scoping*　<sup class="footnote-ref" id="fnref:dyn-scope"><a href="#fn:dyn-scope">1</a></sup>: it looks up the values of names based on how a function is defined, not how it is called. &ldquo;Lexical&rdquo; here is not the English adjective &ldquo;relating to words or a vocabulary&rdquo;. It&rsquo;s a technical CS term that tells us that the scoping rules use a parse-time, rather than a run-time structure.</p>

<p>R的&rsquo;s lexical scoping 遵循4個主要規則::</p>

<ul>
<li>Name masking<br /></li>
<li>Functions vs. variables<br /></li>
<li>A fresh start<br /></li>
<li>Dynamic lookup<br />
<br />
<br /></li>
</ul>

<h3 id="name-masking">Name masking</h3>

<p>內部範圍的宣告(第一次使用)覆蓋外部範圍的宣告。.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
y <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">20</span>
g02 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
  y <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>
  <span style="color:#a6e22e">c</span>(x, y)
}
<span style="color:#a6e22e">g02</span>()
<span style="color:#75715e">#&gt; [1] 1 2</span></code></pre></div>
<p>如果在內部宣告找不到,就找外一層，一直到global environment。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>
g03 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  y <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
  <span style="color:#a6e22e">c</span>(x, y)
}
<span style="color:#a6e22e">g03</span>()
<span style="color:#75715e">#&gt; [1] 2 1</span></code></pre></div>
<p>上面的規則仍然適用於函數中的函數.</p>

<p>測試:下面的R程式會有甚麼結果 ? <sup class="footnote-ref" id="fnref:answer2"><a href="#fn:answer2">2</a></sup></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
g04 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  y <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>
  i <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
    z <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">3</span>
    <span style="color:#a6e22e">c</span>(x, y, z)
  }
  <span style="color:#a6e22e">i</span>()
}
<span style="color:#a6e22e">g04</span>()</code></pre></div>
<p>同樣也適用於建立函數的函數( <strong>closures</strong>).參考 [closures]; 這裡只是用來說明上述規則的使用。 <code>g05()</code>, 傳回函數,猜猜執行結果?<sup class="footnote-ref" id="fnref:answer3"><a href="#fn:answer3">3</a></sup></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
y <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">20</span>

g05 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  y <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>
  <span style="color:#a6e22e">function</span>() {
    <span style="color:#a6e22e">c</span>(x, y)
  }
}
g06 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">g05</span>()
<span style="color:#a6e22e">g06</span>()</code></pre></div>
<p>This seems a little magical: how does R know what the value of <code>y</code> is after <code>j()</code> has returned? It works because <code>k</code> preserves the environment in which it was defined and because the environment includes the value of <code>y</code>. You&rsquo;ll learn more about how environments work in <a href="#environments">Environments</a>.</p>

<h3 id="functions-vs-variables">Functions vs. variables</h3>

<p>既然函數也只是普通的物件,那麼同樣的名稱尋找規則也適用於函數:這個例子中,g07在外部和內部皆有定義。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">g07 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
g08 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  g07 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) x <span style="color:#f92672">+</span> <span style="color:#ae81ff">100</span>
  <span style="color:#a6e22e">g07</span>(<span style="color:#ae81ff">10</span>)
}
<span style="color:#a6e22e">g08</span>()
<span style="color:#75715e">#&gt; [1] 110</span></code></pre></div>
<p>但是如果同一個名稱,在不同範圍有不一樣的型態呢?例如g9一個是變數,一個是函數:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">g09 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) x <span style="color:#f92672">+</span> <span style="color:#ae81ff">100</span>
g10 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  g09 <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
  <span style="color:#a6e22e">g09</span>(g09)
}
<span style="color:#a6e22e">g10</span>()
<span style="color:#75715e">#&gt; [1] 110</span></code></pre></div>
<p>一般來講,上面的用法在語法上是沒問題,但是最好避免。</p>

<h3 id="fresh-start">A fresh start</h3>

<p>第一次執行和第二次執行有甚麼不同?<sup class="footnote-ref" id="fnref:answer4"><a href="#fn:answer4">4</a></sup></p>

<p>函數 <code>exists(x)</code> :會尋找變數名稱x是否存在,存在則無回 <code>TRUE</code>,否則傳回 <code>FALSE</code>.)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">g11 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  <span style="color:#a6e22e">if </span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">exists</span>(<span style="color:#e6db74">&#34;a&#34;</span>)) {
    a <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
  } else {
    a <span style="color:#f92672">&lt;-</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
  }
  a
}

<span style="color:#a6e22e">g11</span>()
<span style="color:#a6e22e">g11</span>()</code></pre></div>
<p>每次執行g11()的時候,一個新的environment會被建立,也就是這個函數的<strong>局部空間</strong>。 這個局部空間會在函數結束的時候消失。</p>

<h3 id="dynamic-lookup">Dynamic lookup</h3>

<p>但是如果函數執行的時候用倒在局部環境找不到的變數的時候,會目前的總體環境(也就是函數所在的環境)找變數值。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">g12 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">15</span>
<span style="color:#a6e22e">g12</span>()
<span style="color:#75715e">#&gt; [1] 16</span>

x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">20</span>
<span style="color:#a6e22e">g12</span>()
<span style="color:#75715e">#&gt; [1] 21</span></code></pre></div>
<p>上面的總體環境包含了兩個變數,一個是函數<code>g12()</code>,一個是變數<code>x</code>:<br />
- g12()<br />
- x</p>

<p>如果要檢查函數的變數參考是不是有問題,可以使用工具 <code>codetools::findGlobals()</code>. This function lists all the external dependencies (unbound symbols) within a function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">codetools<span style="color:#f92672">::</span><span style="color:#a6e22e">findGlobals</span>(g12)
<span style="color:#75715e">#&gt; [1] &#34;+&#34; &#34;x&#34;</span></code></pre></div>
<p>Another way to solve the problem would be to manually change the environment of the function to the <code>emptyenv()</code>, an environment which contains nothing:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">environment</span>(g12) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">emptyenv</span>()
<span style="color:#a6e22e">g12</span>()
<span style="color:#75715e">#&gt; Error in x + 1: 沒有這個函數 &#34;+&#34;</span></code></pre></div>
<h3 id="exercises-1">Exercises</h3>

<ol>
<li><p>What does the following code return? Why? Describe how each of the three<br />
<code>c</code>&rsquo;s is interpreted.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">c <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
<span style="color:#a6e22e">c</span>(c <span style="color:#f92672">=</span> c)</code></pre></div></li>

<li><p>What are the four principles that govern how R looks for values?</p></li>

<li><p>What does the following function return? Make a prediction before<br />
running the code yourself.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">f <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  f <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
    f <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
      x ^ <span style="color:#ae81ff">2</span>
    }
    <span style="color:#a6e22e">f</span>() <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
  }
  <span style="color:#a6e22e">f</span>(x) <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
}
<span style="color:#a6e22e">f</span>(<span style="color:#ae81ff">10</span>)</code></pre></div></li>
</ol>

<h2 id="lazy-evaluation">Lazy evaluation</h2>

<p>In R, function arguments are <strong>lazily evaluated</strong>: they&rsquo;re only evaluated if accessed. For example, this code doesn&rsquo;t generate an error because <code>x</code> is never used:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">h01 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  <span style="color:#ae81ff">10</span>
}
<span style="color:#a6e22e">h01</span>(<span style="color:#a6e22e">stop</span>(<span style="color:#e6db74">&#34;This is an error!&#34;</span>))
<span style="color:#75715e">#&gt; [1] 10</span></code></pre></div>
<p>This is an important feature because it allows you to do things like include potentially expensive computations in function arguments that will only be evaluated if needed.</p>

<h3 id="forcing-evaluation">Forcing evaluation</h3>

<p>To <strong>compel</strong> the evaluation of an argument, use <code>force()</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">h02 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  <span style="color:#a6e22e">force</span>(x)
  <span style="color:#ae81ff">10</span>
}
<span style="color:#a6e22e">h02</span>(<span style="color:#a6e22e">stop</span>(<span style="color:#e6db74">&#34;This is an error!&#34;</span>))
<span style="color:#75715e">#&gt; Error in force(x): This is an error!</span></code></pre></div>
<p>It is usually not necessary to force evaluation. It&rsquo;s needed primarily for certain functional programming techniques which we&rsquo;ll cover in detail in [function operators]. Here, I want to show you the basic issue.</p>

<p>Take this small but surprisingly tricky function. It takes a single argument <code>x</code>, and returns a function that returns <code>x</code> when called.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">capture1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  <span style="color:#a6e22e">function</span>() {
    x
  }
}</code></pre></div>
<p>There&rsquo;s a subtle issue with this function: the value of <code>x</code> will be captured not when you call <code>capture()</code>, but when you call the function that <code>capture()</code> returns:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
h03 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">capture1</span>(x)
h04 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">capture1</span>(x)

<span style="color:#a6e22e">h03</span>()
<span style="color:#75715e">#&gt; [1] 10</span>

x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">20</span>
<span style="color:#a6e22e">h04</span>()
<span style="color:#75715e">#&gt; [1] 20</span></code></pre></div>
<p>Even more confusingly this only happens once: the value is locked in after you have called <code>h03()</code>/<code>h04()</code> for the first time.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">30</span>
<span style="color:#a6e22e">h03</span>()
<span style="color:#75715e">#&gt; [1] 10</span>
<span style="color:#a6e22e">h04</span>()
<span style="color:#75715e">#&gt; [1] 20</span></code></pre></div>
<p>This behaviour is a consequence of lazy evaluation. The <code>x</code> argument is evaluated once <code>h03()</code>/<code>h04()</code> is called, and then its value is cached.  We can avoid the confusion by forcing <code>x</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">capture2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  <span style="color:#a6e22e">force</span>(x)
  
  <span style="color:#a6e22e">function</span>() {
    x
  }
}

x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
h05 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">capture2</span>(x)

x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">20</span>
<span style="color:#a6e22e">h05</span>()
<span style="color:#75715e">#&gt; [1] 10</span></code></pre></div>
<h3 id="promises-skip">Promises (skip)</h3>

<p>Lazy evaluation is powered by a data structure called a <strong>promise</strong>, or (less commonly) a thunk. We&rsquo;ll come back to this data structure in <a href="#meta">metaprogramming</a> because it&rsquo;s one of the features of R that makes it most interesting as a programming language.</p>

<p>A promise has three components:</p>

<ul>
<li><p>The expression, like <code>x + y</code> which gives rise to the delayed computation.</p></li>

<li><p>The environment where the expression should be evaluated.</p></li>

<li><p>The value, which is computed and cached when the promise is first accessed<br />
by evaluating the expression in the specified environment.</p></li>
</ul>

<p>The value cache ensures that accessing the promise multiple times always returns the same value. For example, you can see in the following code that <code>runif(1)</code> is only evaluated once:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">h06 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) { 
  <span style="color:#a6e22e">c</span>(x, x, x)  
}

<span style="color:#a6e22e">h06</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">1</span>))
<span style="color:#75715e">#&gt; [1] 0.6588047 0.6588047 0.6588047</span></code></pre></div>
<p>You can also create promises &ldquo;by hand&rdquo; using <code>delayedAssign()</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">delayedAssign</span>(<span style="color:#e6db74">&#34;x&#34;</span>, {<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;Executing code&#34;</span>); <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">1</span>)})
x
<span style="color:#75715e">#&gt; [1] &#34;Executing code&#34;</span>
<span style="color:#75715e">#&gt; [1] 0.436975</span>
x
<span style="color:#75715e">#&gt; [1] 0.436975</span></code></pre></div>
<p>You&rsquo;ll see this idea again in [advanced bindings].</p>

<h3 id="default-arguments">Default arguments</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">h07 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, y <span style="color:#f92672">=</span> x <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>) {

  <span style="color:#a6e22e">c</span>(x, y)
}

<span style="color:#a6e22e">h07</span>()
<span style="color:#75715e">#&gt; [1] 1 2</span></code></pre></div>
<h3 id="missing-arguments">Missing arguments</h3>

<p>判斷參數內容來自使用者或者預設的函數: <code>missing()</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">h09 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>) {
  <span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">missing</span>(x), x)
}
<span style="color:#a6e22e">str</span>(<span style="color:#a6e22e">h09</span>()) <span style="color:#75715e"># 預設</span>
<span style="color:#75715e">#&gt; List of 2</span>
<span style="color:#75715e">#&gt;  $ : logi TRUE</span>
<span style="color:#75715e">#&gt;  $ : num 10</span>
<span style="color:#a6e22e">str</span>(<span style="color:#a6e22e">h09</span>(<span style="color:#ae81ff">10</span>)) <span style="color:#75715e"># 使用者</span>
<span style="color:#75715e">#&gt; List of 2</span>
<span style="color:#75715e">#&gt;  $ : logi FALSE</span>
<span style="color:#75715e">#&gt;  $ : num 10</span></code></pre></div>
<h2 id="exiting-a-function">Exiting a function</h2>

<p>Most functions exit in one of two ways<sup class="footnote-ref" id="fnref:function-exit"><a href="#fn:function-exit">5</a></sup>: either returning a value, indicating successful completion, or throwing an error, indicating failure. This section describes return values (implicit vs. explicit; visible vs. invisible), briefly discusses errors, and introduces exit handlers, which allow you to run code when a function exits, regardless of how it exits.</p>

<h3 id="implicit-vs-explict-returns">Implicit vs. explict returns</h3>

<p>There are two ways that a function can return a value:</p>

<ul>
<li><p>Implicitly, where the last evaluated expression becomes the return<br />
value:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">j01 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  <span style="color:#a6e22e">if </span>(x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>) {
    <span style="color:#ae81ff">0</span>
  } else {
    <span style="color:#ae81ff">10</span>
  }
}
<span style="color:#a6e22e">f</span>(<span style="color:#ae81ff">5</span>)
<span style="color:#75715e">#&gt; [1] 52</span>
<span style="color:#a6e22e">f</span>(<span style="color:#ae81ff">15</span>)
<span style="color:#75715e">#&gt; [1] 452</span></code></pre></div></li>

<li><p>Explicitly, by calling <code>return()</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">j02 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  <span style="color:#a6e22e">if </span>(x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>) {
    <span style="color:#a6e22e">return</span>(<span style="color:#ae81ff">0</span>)
  } else {
    <span style="color:#a6e22e">return</span>(<span style="color:#ae81ff">10</span>)
  }
}</code></pre></div></li>
</ul>

<h3 id="invisible-values">Invisible values</h3>

<p>大部分函數再傳回值的時候都會顯示在主控台上:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">j03 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() <span style="color:#ae81ff">1</span>
<span style="color:#a6e22e">j03</span>()
<span style="color:#75715e">#&gt; [1] 1</span></code></pre></div>
<p>但是也可以不用顯示:利用函數 <code>invisible()</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">j04 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() <span style="color:#a6e22e">invisible</span>(<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">j04</span>()</code></pre></div>
<p>這種不會顯示傳回值的函數,可以用下面的方法驗證:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">j04</span>())
<span style="color:#75715e">#&gt; [1] 1</span>

(<span style="color:#a6e22e">j04</span>())
<span style="color:#75715e">#&gt; [1] 1</span></code></pre></div>
<p>或者利用函數 `withVisible():</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">str</span>(<span style="color:#a6e22e">withVisible</span>(<span style="color:#a6e22e">j04</span>()))
<span style="color:#75715e">#&gt; List of 2</span>
<span style="color:#75715e">#&gt;  $ value  : num 1</span>
<span style="color:#75715e">#&gt;  $ visible: logi FALSE</span></code></pre></div>
<p>最常用的方法是 <code>&lt;-</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">a <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>
(a <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>)
<span style="color:#75715e">#&gt; [1] 2</span></code></pre></div>
<p>也因此可以利用下面的串聯指派:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">a <span style="color:#f92672">&lt;-</span> b <span style="color:#f92672">&lt;-</span> c <span style="color:#f92672">&lt;-</span> d <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span></code></pre></div>
<p>一般而言，像是 (like <code>&lt;-</code>, <code>print()</code>, or <code>plot()</code>) 都是傳回不可見結果。</p>

<h3 id="errors">Errors</h3>

<p>函數可以利用函數 <code>stop()</code>結束一個函數的執行。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">j05 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  <span style="color:#a6e22e">stop</span>(<span style="color:#e6db74">&#34;I&#39;m an error&#34;</span>)
  <span style="color:#a6e22e">return</span>(<span style="color:#ae81ff">10</span>)
}
<span style="color:#a6e22e">j05</span>()
<span style="color:#75715e">#&gt; Error in j05(): I&#39;m an error</span></code></pre></div>
<h3 id="on-exit">Exit handlers</h3>

<p>Sometimes a function needs to make a temporary change to global state and you want to ensure those changes are restored when the function completes. It&rsquo;s painful to make sure you cleanup before any explicit return, and what happens if there&rsquo;s an error? Instead, you can set up an <strong>exiting handler</strong> that is called when the function terminates, regardless of whether it returns a value or throws an error.</p>

<p>To setup an exiting handler, call <code>on.exit()</code> with the code to be run. It will execute when the function exits, regardless of what causes it to exit:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">j06 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  <span style="color:#a6e22e">cat</span>(<span style="color:#e6db74">&#34;Hello\n&#34;</span>)
  <span style="color:#a6e22e">on.exit</span>(<span style="color:#a6e22e">cat</span>(<span style="color:#e6db74">&#34;Goodbye!\n&#34;</span>), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
  
  <span style="color:#a6e22e">if </span>(x) {
    <span style="color:#a6e22e">return</span>(<span style="color:#ae81ff">10</span>)
  } else {
    <span style="color:#a6e22e">stop</span>(<span style="color:#e6db74">&#34;Error&#34;</span>)
  }
}

<span style="color:#a6e22e">f</span>(<span style="color:#66d9ef">TRUE</span>)
<span style="color:#75715e">#&gt; [1] 4</span>

<span style="color:#a6e22e">f</span>(<span style="color:#66d9ef">FALSE</span>)
<span style="color:#75715e">#&gt; [1] 2</span></code></pre></div>

<div class="notices sidebar" ><p>Always set <code>add = TRUE</code> when using <code>on.exit()</code>. If you don&rsquo;t, each call to <code>on.exit()</code> will overwrite the previous exiting handler. Even when only registering a single handler, it&rsquo;s good practice to  set <code>add = TRUE</code> so that you don&rsquo;t get an unpleasant surprise if you later add more exit handlers</p>
</div>


<p><code>on.exit()</code> is important because it allows you to place clean-up actions next to actions with their cleanup operations.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">cleanup <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(dir, code) {
  old_dir <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">setwd</span>(dir)
  <span style="color:#a6e22e">on.exit</span>(<span style="color:#a6e22e">setwd</span>(old), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
  
  old_opt <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">options</span>(stringsAsFactors <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
  <span style="color:#a6e22e">on.exit</span>(<span style="color:#a6e22e">options</span>(old_opt), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
}</code></pre></div>
<p>When coupled with lazy evaluation, this leads to a very useful pattern for running a block of code in an altered environment:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">with_dir <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(dir, code) {
  old <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">setwd</span>(dir)
  <span style="color:#a6e22e">on.exit</span>(<span style="color:#a6e22e">setwd</span>(old), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

  <span style="color:#a6e22e">force</span>(code)
}

<span style="color:#a6e22e">getwd</span>()
<span style="color:#75715e">#&gt; [1] &#34;D:/RStudio/book/blogClassR/content/rlang&#34;</span>
<span style="color:#a6e22e">with_dir</span>(<span style="color:#e6db74">&#34;~&#34;</span>, <span style="color:#a6e22e">getwd</span>())
<span style="color:#75715e">#&gt; [1] &#34;C:/Users/linchao/Documents&#34;</span></code></pre></div>
<p>See the <a href="http://withr.r-lib.org">withr package</a> for a collection of functions of this nature.</p>

<p>In R 3.4 and prior, <code>on.exit()</code> expressions are always run in the order in which they are created:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">f <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  <span style="color:#a6e22e">on.exit</span>(<span style="color:#a6e22e">message</span>(<span style="color:#e6db74">&#34;a&#34;</span>), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
  <span style="color:#a6e22e">on.exit</span>(<span style="color:#a6e22e">message</span>(<span style="color:#e6db74">&#34;b&#34;</span>), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
}
<span style="color:#a6e22e">f</span>()
<span style="color:#75715e">#&gt; a</span>
<span style="color:#75715e">#&gt; b</span></code></pre></div>
<p>This can make cleanup a little tricky if some actions need to happen in a specific order; typically you want the most recent added expression to be run first. In R 3.5 and later, you can control this by setting <code>after = FALSE</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">f <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  <span style="color:#a6e22e">on.exit</span>(<span style="color:#a6e22e">message</span>(<span style="color:#e6db74">&#34;a&#34;</span>), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, after <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
  <span style="color:#a6e22e">on.exit</span>(<span style="color:#a6e22e">message</span>(<span style="color:#e6db74">&#34;b&#34;</span>), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, after <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
}
<span style="color:#a6e22e">f</span>()
<span style="color:#75715e">#&gt; b</span>
<span style="color:#75715e">#&gt; a</span></code></pre></div>
<h3 id="exercises-2">Exercises</h3>

<ol>
<li><p>What does <code>load()</code> return? Why don&rsquo;t you normally see these values?</p></li>

<li><p>What does <code>write.table()</code> return? What would be more useful?</p></li>

<li><p>How does the <code>chdir</code> parameter of <code>source()</code> compare to <code>in_dir()</code>? Why<br />
might you prefer one approach to the other?</p></li>

<li><p>Write a function that opens a graphics device, runs the supplied code, and<br />
closes the graphics device (always, regardless of whether or not the plotting<br />
code worked).</p></li>

<li><p>We can use <code>on.exit()</code> to implement a simple version of <code>capture.output()</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">capture.output2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(code) {
  temp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tempfile</span>()
  <span style="color:#a6e22e">on.exit</span>(<span style="color:#a6e22e">file.remove</span>(temp), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, after <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
    
  <span style="color:#a6e22e">sink</span>(temp)
  <span style="color:#a6e22e">on.exit</span>(<span style="color:#a6e22e">sink</span>(), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, after <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
    
  <span style="color:#a6e22e">force</span>(code)
  <span style="color:#a6e22e">readLines</span>(temp)
}
<span style="color:#a6e22e">capture.output2</span>(<span style="color:#a6e22e">cat</span>(<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>, sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;\n&#34;</span>))
<span style="color:#75715e">#&gt; Warning in file.remove(temp): 無法移除檔案 &#39;C:</span>
<span style="color:#75715e">#&gt; \Users\linchao\AppData\Local\Temp\RtmpaAjRKR\file24b8359a2117&#39; ，原因是</span>
<span style="color:#75715e">#&gt; &#39;Permission denied&#39;</span>
<span style="color:#75715e">#&gt; [1] &#34;a&#34; &#34;b&#34; &#34;c&#34;</span></code></pre></div>
<p>Compare <code>capture.output()</code> to <code>capture.output2()</code>. How do the functions<br />
differ? What features have I removed to make the key ideas easier to see?<br />
How have I rewritten the key ideas to be easier to understand?</p></li>
</ol>

<h2 id="function-forms-skip">Function forms (skip)</h2>

<blockquote>
<p>&ldquo;To understand computations in R, two slogans are helpful:</p>

<ul>
<li>Everything that exists is an object.<br /></li>
<li>Everything that happens is a function call.&rdquo;<br />
<br /></li>
</ul>

<p>&mdash; John Chambers</p>
</blockquote>

<p>While everything that happens in R is a result of a function call, not all calls look the same. Function calls come in four varieties:</p>

<ul>
<li><p>In <strong>prefix</strong> form, the function name comes before its arguments, like <code>foofy(a, b, c)</code>. These constitute of the majority of function calls in R.</p></li>

<li><p>In <strong>infix</strong> form, the function name comes inbetween its arguments, like <code>x + y</code>. Infix forms are used for many mathematical operators, as well as user-defined functions that begin and end with <code>%</code>.</p></li>

<li><p>A <strong>replacement</strong> function assigns into what looks like a prefix function, like <code>names(df) &lt;- c(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)</code>.</p></li>

<li><p><strong>Special forms</strong> like <code>[[</code>, <code>if</code>, and <code>for</code>, don&rsquo;t have a consistent structure and provide some of the most important syntax in R.</p></li>
</ul>

<p>While four forms exist, you only need to use one, because any call can be written in prefix form. I&rsquo;ll demonstrate this property, and then you&rsquo;ll learn about each of the forms in turn.</p>

<h3 id="rewriting-to-prefix-form">Rewriting to prefix form</h3>

<p>An interesting property of R is every infix, replacement, or special form can be rewritten in prefix form. Rewriting in prefix form is useful because it helps you better understand the structure of the language, and it gives you the real name of every function. Knowing the real name of non-prefix functions is useful because it allows you to modify them for fun and profit.</p>

<p>The following example shows three pairs of equivalent calls, rewriting an infix form, replacement form, and a special form into prefix form.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">+</span> y
<span style="color:#a6e22e">`+`</span>(x, y)

<span style="color:#a6e22e">names</span>(df) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;x&#34;</span>, <span style="color:#e6db74">&#34;y&#34;</span>, <span style="color:#e6db74">&#34;z&#34;</span>)
<span style="color:#a6e22e">`names&lt;-`</span>(df, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;x&#34;</span>, <span style="color:#e6db74">&#34;y&#34;</span>, <span style="color:#e6db74">&#34;z&#34;</span>))

<span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>) <span style="color:#a6e22e">print</span>(i)
<span style="color:#a6e22e">`for`</span>(i, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">print</span>(i))</code></pre></div>
<p>Knowing the function name of a non-prefix function allows you to override its behaviour. For example, if you&rsquo;re ever feeling particularly evil, run the following code while a friend is away from their computer. It will introduce a fun bug: 10% of the time, 1 will be added to any numeric calculation inside of parentheses.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">`</span>(` <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(e1) {
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">is.numeric</span>(e1) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.1</span>) {
    e1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
  } else {
    e1
  }
}
<span style="color:#a6e22e">replicate</span>(<span style="color:#ae81ff">50</span>, (<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>))
<span style="color:#75715e">#&gt;  [1] 3 3 3 3 4 3 3 3 3 4 3 3 3 4 3 3 3 3 3 4 3 3 3 3 3 3 3 3 3 3 3 3 4 3 3 3 4 3</span>
<span style="color:#75715e">#&gt; [39] 3 3 3 3 3 3 3 3 3 3 3 3</span>
<span style="color:#a6e22e">rm</span>(<span style="color:#e6db74">&#34;(&#34;</span>)</code></pre></div>
<p>Of course, overriding built-in functions like this is a bad idea, but, as you&rsquo;ll learn about in [metaprogramming], it&rsquo;s possible to apply it only to selected code blocks. This provides a clean and elegant approach to writing domain specific languages and translators to other languages.</p>

<p>A more useful technique is to use this knowledge when using functional programming tools. For example, you could use <code>sapply()</code> to add 3 to every element of a list by first defining a function <code>add()</code>, like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">add <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x, y) x <span style="color:#f92672">+</span> y
<span style="color:#a6e22e">sapply</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, add, <span style="color:#ae81ff">3</span>)
<span style="color:#75715e">#&gt;  [1]  4  5  6  7  8  9 10 11 12 13</span></code></pre></div>
<p>But we can also get the same effect more simply by relying on the existing <code>+</code> function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">sapply</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>, `+`, <span style="color:#ae81ff">3</span>)
<span style="color:#75715e">#&gt; [1] 4 5 6 7 8</span></code></pre></div>
<p>We&rsquo;ll explore this idea in detail in [functionals].</p>

<h3 id="prefix-form">Prefix form</h3>

<p>The prefix form 函數的類型通常指的是函數在前面,然後後面接參數,使用方式有三種:</p>

<ul>
<li>By position, like <code>help(mean)</code>.<br /></li>
<li>Using partial matching, like <code>help(to = mean)</code>.<br /></li>
<li>By name, like <code>help(topic = mean)</code>.<br />
<br /></li>
</ul>

<p>As illustrated by the following chunk, arguments are matched by exact name, then with unique prefixes, and finally by position.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">k01 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(abcdef, bcde1, bcde2) {
  <span style="color:#a6e22e">list</span>(a <span style="color:#f92672">=</span> abcdef, b1 <span style="color:#f92672">=</span> bcde1, b2 <span style="color:#f92672">=</span> bcde2)
}
<span style="color:#a6e22e">str</span>(<span style="color:#a6e22e">k01</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>))
<span style="color:#75715e">#&gt; List of 3</span>
<span style="color:#75715e">#&gt;  $ a : num 1</span>
<span style="color:#75715e">#&gt;  $ b1: num 2</span>
<span style="color:#75715e">#&gt;  $ b2: num 3</span>
<span style="color:#a6e22e">str</span>(<span style="color:#a6e22e">k01</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, abcdef <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>))
<span style="color:#75715e">#&gt; List of 3</span>
<span style="color:#75715e">#&gt;  $ a : num 1</span>
<span style="color:#75715e">#&gt;  $ b1: num 2</span>
<span style="color:#75715e">#&gt;  $ b2: num 3</span>

<span style="color:#75715e"># Can abbreviate long argument names:</span>
<span style="color:#a6e22e">str</span>(<span style="color:#a6e22e">k01</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>))
<span style="color:#75715e">#&gt; List of 3</span>
<span style="color:#75715e">#&gt;  $ a : num 1</span>
<span style="color:#75715e">#&gt;  $ b1: num 2</span>
<span style="color:#75715e">#&gt;  $ b2: num 3</span>

<span style="color:#75715e"># But this doesn&#39;t work because abbreviation is ambiguous</span>
<span style="color:#a6e22e">str</span>(<span style="color:#a6e22e">k01</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>))
<span style="color:#75715e">#&gt; Error in k01(1, 3, b = 1): 引數 3 有多個與之相對應的正式引數</span></code></pre></div>
<p>Generally, only use positional matching for the first one or two arguments; they will be the most commonly used, and most readers will know what they are. Avoid using positional matching for less commonly used arguments, and never use partial matching. See the tidyverse style guide, <a href="http://style.tidyverse.org/syntax.html#argument-names">http://style.tidyverse.org/syntax.html#argument-names</a>, for more advice.</p>

<h3 id="infix-functions">Infix functions</h3>

<p>R的內建 infix operators: <code>:</code>, <code>::</code>, <code>:::</code>, <code>$</code>, <code>@</code>, <code>^</code>, <code>*</code>, <code>/</code>, <code>+</code>, <code>-</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code>, <code>!</code>, <code>&amp;</code>, <code>&amp;&amp;</code>, <code>|</code>, <code>||</code>, <code>~</code>, <code>&lt;-</code>, and <code>&lt;&lt;-</code>.</p>

<p>建立infix函數,1)兩個參數,2)函數名稱兩邊有<code>%</code>, base R 也額外定義了 <code>%%</code>, <code>%*%</code>, <code>%/%</code>, <code>%in%</code>, <code>%o%</code>, and <code>%x%</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">`%+%` <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(a, b) <span style="color:#a6e22e">paste0</span>(a, b)
<span style="color:#e6db74">&#34;new &#34;</span> <span style="color:#f92672">%+%</span> <span style="color:#e6db74">&#34;string&#34;</span>
<span style="color:#75715e">#&gt; [1] &#34;new string&#34;</span></code></pre></div>
<p>The names of infix functions are more flexible than regular R functions: they can contain any sequence of characters except &ldquo;%&rdquo;. You will need to escape any special characters in the string used to define the function, but not when you call it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">`% %` <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(a, b) <span style="color:#a6e22e">paste</span>(a, b)
`%/\\%` <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(a, b) <span style="color:#a6e22e">paste</span>(a, b)

<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">% %</span> <span style="color:#e6db74">&#34;b&#34;</span>
<span style="color:#75715e">#&gt; [1] &#34;a b&#34;</span>
<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">%/\%</span> <span style="color:#e6db74">&#34;b&#34;</span>
<span style="color:#75715e">#&gt; [1] &#34;a b&#34;</span></code></pre></div>
<p>R&rsquo;s default precedence rules mean that infix operators are composed from left to right:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">`%-%` <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(a, b) <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;(&#34;</span>, a, <span style="color:#e6db74">&#34; %-% &#34;</span>, b, <span style="color:#e6db74">&#34;)&#34;</span>)
<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">%-%</span> <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">%-%</span> <span style="color:#e6db74">&#34;c&#34;</span>
<span style="color:#75715e">#&gt; [1] &#34;((a %-% b) %-% c)&#34;</span></code></pre></div>
<p>兩個例外的INFIX函數可以只有一參數: <code>+</code> and <code>-</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#ae81ff">-1</span>
<span style="color:#75715e">#&gt; [1] -1</span>
<span style="color:#ae81ff">+10</span>
<span style="color:#75715e">#&gt; [1] 10</span></code></pre></div>
<h3 id="replacement-functions">Replacement functions</h3>

<p>Replacement functions 的函數名稱必須是類似 <code>xxx&lt;-</code>. 必須要有兩個參數 <code>x</code> 和 <code>value</code>, 且必須回傳更改過的物件。例如下面的例子,允選我們更改向量的第二個元素:  :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">`second&lt;-` <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x, value) {
  x[2] <span style="color:#f92672">&lt;-</span> value
  x
}</code></pre></div>
<p>使用方法:利用 <code>&lt;-</code> 的LHS:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>
<span style="color:#a6e22e">second</span>(x) <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">5L</span>
x
<span style="color:#75715e">#&gt;  [1]  1  5  3  4  5  6  7  8  9 10</span></code></pre></div>
<p>I say they &ldquo;act&rdquo; like they modify their arguments in place, because, as discussed in [Modify-in-place], they actually create a modified copy. We can see that by using <code>tracemem()</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>
<span style="color:#a6e22e">tracemem</span>(x)
<span style="color:#75715e">#&gt; &lt;0x7ffae71bd880&gt;</span>

<span style="color:#a6e22e">second</span>(x) <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">6L</span>
<span style="color:#75715e">#&gt; tracemem[0x7ffae71bd880 -&gt; 0x7ffae61b5480]: </span>
<span style="color:#75715e">#&gt; tracemem[0x7ffae61b5480 -&gt; 0x7ffae73f0408]: second&lt;- </span></code></pre></div>
<p>If you want to supply additional arguments, they go inbetween <code>x</code> and <code>value</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">`modify&lt;-` <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x, position, value) {
  x[position] <span style="color:#f92672">&lt;-</span> value
  x
}
<span style="color:#a6e22e">modify</span>(x, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
x
<span style="color:#75715e">#&gt;  [1] 10  5  3  4  5  6  7  8  9 10</span></code></pre></div>
<p>When you write <code>modify(x, 1) &lt;- 10</code>, behind the scenes R turns it into:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">`modify&lt;-`</span>(x, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>)</code></pre></div>
<p>Combining replacement with other functions requires more complex translation. For example, this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, c <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
<span style="color:#a6e22e">names</span>(x)
<span style="color:#75715e">#&gt; [1] &#34;a&#34; &#34;b&#34; &#34;c&#34;</span>

<span style="color:#a6e22e">names</span>(x)[2] <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;two&#34;</span>
<span style="color:#a6e22e">names</span>(x)
<span style="color:#75715e">#&gt; [1] &#34;a&#34;   &#34;two&#34; &#34;c&#34;</span></code></pre></div>
<p>Is translated into:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">`*tmp*` <span style="color:#f92672">&lt;-</span> x
x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">`names&lt;-`</span>(`*tmp*`, <span style="color:#a6e22e">`[&lt;-`</span>(<span style="color:#a6e22e">names</span>(`*tmp*`), <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;two&#34;</span>))
<span style="color:#a6e22e">rm</span>(`*tmp*`)</code></pre></div>
<p>(Yes, it really does create a local variable named <em>tmp</em>, which is removed afterwards.)</p>

<h3 id="special-forms">Special forms</h3>

<p>Finally, there are a bunch of language features that are usually written in special ways, but also have prefix forms. These include parentheses:</p>

<ul>
<li><code>(x)</code> (<code>`(`(x)</code>)<br /></li>
<li><code>{x}</code> (<code>`{`(x)</code>).<br />
<br /></li>
</ul>

<p>The subsetting operators:</p>

<ul>
<li><code>x[i]</code> (<code>`[`(x, i)</code>)<br /></li>
<li><code>x[[i]]</code> (<code>`[[`(x, i)</code>)<br />
<br /></li>
</ul>

<p>And the tools of control flow:</p>

<ul>
<li><code>if (cond) true</code> (<code>`if`(cond, true)</code>)<br /></li>
<li><code>if (cond) true else false</code> (<code>`if`(cond, true, false)</code>)<br /></li>
<li><code>for(var in seq) action</code> (<code>`for`(var, seq, action)</code>)<br /></li>
<li><code>while(cond) action</code> (<code>`while`(cond, action)</code>)<br /></li>
<li><code>repeat expr</code> (<code>`repeat`(expr)</code>)<br /></li>
<li><code>next</code> (<code>`next`()</code>)<br /></li>
<li><code>break</code> (<code>`break`()</code>)<br />
<br /></li>
</ul>

<p>Finally, the most complex is the &ldquo;function&rdquo; function:</p>

<ul>
<li><code>function(arg1, arg2) {body}</code> (<code>`function`(alist(arg1, arg2), body, env)</code>)<br />
<br /></li>
</ul>

<p>Knowing the name of the function that underlies the special form is useful for getting documentation. <code>?(</code> is a syntax error; <code>?`(`</code> will give you the documentation for parentheses.</p>

<p>Note that all special forms are implemented as primitive functions (i.e. in C); that means printing these functions is not informative:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">`for`
<span style="color:#75715e">#&gt; .Primitive(&#34;for&#34;)</span></code></pre></div>
<h2 id="invoking-a-function">Invoking a function</h2>

<p><a href="https://www.cnblogs.com/Demo1589/p/6984537.html">另一個do.call()的參考</a></p>

<p>Suppose you had a list of function arguments:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">args <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)</code></pre></div>
<p>How could you then send that list to <code>mean()</code>?  In base R, you need <code>do.call()</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">do.call</span>(mean, args)
<span style="color:#75715e">#&gt; [1] 5.5</span>
<span style="color:#75715e"># Equivalent to</span>
<span style="color:#a6e22e">mean</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#75715e">#&gt; [1] 5.5</span></code></pre></div>
<h3 id="exercises-3">Exercises</h3>

<ol>
<li><p>Rewrite the following code snippets into prefix form:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>
    
<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>)
    
<span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">length</span>(x) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">5</span>) x[[5]] else x[[n]]</code></pre></div></li>

<li><p>Clarify the following list of odd function calls:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sample</span>(replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, <span style="color:#ae81ff">20</span>, x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#66d9ef">NA</span>))
y <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">runif</span>(min <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, max <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">20</span>)
<span style="color:#a6e22e">cor</span>(m <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;k&#34;</span>, y <span style="color:#f92672">=</span> y, u <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;p&#34;</span>, x <span style="color:#f92672">=</span> x)</code></pre></div></li>
</ol>


<div class="notices tips" ><p>相關係數<br />
cor(x, y = NULL, use = &ldquo;everything&rdquo;,<br />
    method = c(&ldquo;pearson&rdquo;, &ldquo;kendall&rdquo;, &ldquo;spearman&rdquo;))<br />
if method is &ldquo;kendall&rdquo; or &ldquo;spearman&rdquo;, Kendall&rsquo;s tau or Spearman&rsquo;s rho statistic is used to estimate a rank-based measure of association</p>
</div>


<ol>
<li><p>Explain why the following code fails:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">modify</span>(<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;x&#34;</span>), <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
<span style="color:#75715e">#&gt; Error: target of assignment expands to non-language object</span></code></pre></div></li>

<li><p>Create a replacement function that modifies a random location in a vector.</p></li>

<li><p>Write your own version of <code>+</code> that will paste its inputs together if<br />
they are character vectors but behaves as usual otherwise. In other words,<br />
make this code work:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>
<span style="color:#75715e">#&gt; [1] 3</span>
    
<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;b&#34;</span>
<span style="color:#75715e">#&gt; [1] &#34;ab&#34;</span></code></pre></div></li>

<li><p>Create a list of all the replacement functions found in the base package.<br />
Which ones are primitive functions? (Hint use <code>apropros()</code>)</p></li>

<li><p>What are valid names for user-created infix functions?</p></li>

<li><p>Create an infix <code>xor()</code> operator.</p></li>

<li><p>Create infix versions of the set functions <code>intersect()</code>, <code>union()</code>, and<br />
<code>setdiff()</code>. You might call them <code>%n%</code>, <code>%u%</code>, and <code>%/%</code> to match<br />
conventions from mathematics.</p></li>
</ol>

<h2 id="function-answers">Quiz answers</h2>

<ol>
<li><p>The three components of a function are its body, arguments, and environment.</p></li>

<li><p><code>f1(1)()</code> returns 11.</p></li>

<li><p>You&rsquo;d normally write it in infix style: <code>1 + (2 * 3)</code>.</p></li>

<li><p>Rewriting the call to <code>mean(c(1:10, NA), na.rm = TRUE)</code> is easier to<br />
understand.</p></li>

<li><p>No, it does not throw an error because the second argument is never used<br />
so it&rsquo;s never evaluated.</p></li>

<li><p>See <a href="#infix-functions">infix</a> and<br />
<a href="#replacement-functions">replacement functions</a>.</p></li>

<li><p>You use <code>on.exit()</code>; see <a href="#on-exit">on exit</a> for details.</p></li>
</ol>
<div class="footnotes">

<hr />

<ol>
<li id="fn:dyn-scope">Functions that automatically quote one or more arguments (sometimes called NSE functions) can override the default scoping rules to implement other varieties of scoping. You&rsquo;ll learn more about that in <a href="#meta">metaprogramming</a>.<br />
 <a class="footnote-return" href="#fnref:dyn-scope"><sup>[return]</sup></a></li>
<li id="fn:answer2"><code>g04()</code> returns <code>c(1, 2, 3)</code>.<br />
 <a class="footnote-return" href="#fnref:answer2"><sup>[return]</sup></a></li>
<li id="fn:answer3"><code>g06()</code> returns <code>c(10, 2)</code>.<br />
 <a class="footnote-return" href="#fnref:answer3"><sup>[return]</sup></a></li>
<li id="fn:answer4"><code>g11()</code> 每次被調用都是傳回 <code>1</code>。.<br />
 <a class="footnote-return" href="#fnref:answer4"><sup>[return]</sup></a></li>
<li id="fn:function-exit">函數的脫離狀態可以是產生一個旗號,用來觸發既有的處理函數,可以是重新啟動,或是互動訊息向是按Q脫離。<br />
 <a class="footnote-return" href="#fnref:function-exit"><sup>[return]</sup></a></li>
</ol>
</div>


<footer class="footline">
	
</footer>

        
        </div>
        
rlang\function_2.md
      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../rlang/function_1.html" title="Function basic"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../rlang/rpackages.html" title="R Package" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../js/clipboard.min.js?1606368037"></script>
    <script src="../js/perfect-scrollbar.min.js?1606368037"></script>
    <script src="../js/perfect-scrollbar.jquery.min.js?1606368037"></script>
    <script src="../js/jquery.sticky.js?1606368037"></script>
    <script src="../js/featherlight.min.js?1606368037"></script>
    <script src="../js/highlight.pack.js?1606368037"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../js/modernizr.custom-3.6.0.js?1606368037"></script>
    <script src="../js/learn.js?1606368037"></script>
    <script src="../js/hugo-learn.js?1606368037"></script>
    
        
            <script src="../mermaid/mermaid.js?1606368037"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    



  </body>
</html>

