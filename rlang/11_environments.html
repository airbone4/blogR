<!DOCTYPE html>
<html><head>
  <title>11 Environments</title>  
      
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href='/blogR/images/favicon.ico'/>
      
    <link rel="stylesheet" href="/blogR/css/atom-one-dark-reasonable.css">
    
    <link href="/blogR/css/syntax.css?1641445339" rel="stylesheet">
    <script src="/blogR/js/jquery-3.3.1.min.js?1641445339"></script>
    <link href='/blogR/css/bootstrap.min.css' rel="stylesheet" crossorigin="anonymous">
    <script src='/blogR/js/bootstrap.bundle.min.js' crossorigin="anonymous"></script>
    
    <script src='/blogR/js/datatables.min.js'></script>    
    <link href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css" rel="stylesheet">    
    
    <link href="/blogR/css/fontawesome-all.min.css?1641445339" rel="stylesheet">
    
    <link href="/blogR/css/theme-mine.css?1641445339" rel="stylesheet">
    
    <link href="/blogR/css/theme.css?1641445339" rel="stylesheet">
    
    
    <link rel="stylesheet" href="https://airbone4.github.io/blogR/scss/notice.7158afc7a24ea3d0073077b3699dbfad7f3df2be8d4e19956e934587413013ee.css" integrity="sha256-cVivx6JOo9AHMHezaZ2/rX898r6NThmVbpNFh0EwE&#43;4=">
    <script src='/blogR/js/class.js'></script>    
    
  </head><body><div id="top-pane" class="navbar  fixed-top ">
  <div class="container-fluid">
  <span >
    <a  href='/blogR/' class="fs-5 accessory"><i class="fas fa-home"></i>R in Class</a>
    <span id="sidebar-toggle-span" class="fs-5"><i class="fas fa-align-justify"></i></span>
  </span><span >
      <span id="toc-menu">
    <label><i class="fas fa-list-alt" ></i> </label>    
<div id="variant-toc-content" >
    <div class="wrapper">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#quiz">Quiz</a></li>
        <li><a href="#outline">Outline</a></li>
        <li><a href="#prerequisites">Prerequisites</a></li>
      </ul>
    </li>
    <li><a href="#基本">基本</a>
      <ul>
        <li><a href="#提要">提要</a></li>
        <li><a href="#important-environments">Important environments</a></li>
        <li><a href="#parents">Parents</a></li>
        <li><a href="#getting-and-setting">Getting and setting</a></li>
        <li><a href="#advanced-bindings">Advanced bindings</a></li>
        <li><a href="#exercises">Exercises</a></li>
      </ul>
    </li>
    <li><a href="#recursing-over-environments">Recursing over environments</a>
      <ul>
        <li><a href="#exercises-1">Exercises</a></li>
      </ul>
    </li>
    <li><a href="#function-envs">Special environments</a>
      <ul>
        <li><a href="#套件環境和搜尋路徑">套件環境和搜尋路徑</a></li>
        <li><a href="#the-function-environment">The function environment</a></li>
        <li><a href="#namespaces">Namespaces</a></li>
        <li><a href="#execution-environments">Execution environments</a></li>
        <li><a href="#exercises-2">Exercises</a></li>
      </ul>
    </li>
    <li><a href="#the-call-stack">The call stack</a>
      <ul>
        <li><a href="#simple-call-stacks">Simple call stacks</a></li>
        <li><a href="#lazy-evaluation">Lazy evaluation</a></li>
        <li><a href="#frames">Frames</a></li>
        <li><a href="#dynamic-scope">Dynamic scope</a></li>
        <li><a href="#exercises-3">Exercises</a></li>
      </ul>
    </li>
    <li><a href="#explicit-envs">As data structures</a></li>
    <li><a href="#-"><code>&lt;&lt;-</code></a>
      <ul>
        <li><a href="#exercises-4">Exercises</a></li>
      </ul>
    </li>
    <li><a href="#env-answers">Quiz answers</a>
      <ul>
        <li><a href="#term">term</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    <hr class="p-0 m-0" />
    <div class="toa"></div>
</div>
</span>
<span class="fs-5 accessory" data-bs-toggle="tooltip" data-bs-placement="bottom" 
      title='最後修改September 16, 2021'>11 Environments</span>
        
    

    </span>
  
  <span></span><span >
    <span >
    <label for="search-query" id="search-button"><i class="fas fa-search"></i></label>
    <input id="search-query" type="search" placeholder="搜尋" autocomplete="off">
</span>    
 
<div id="search-pane">
 <ol id="search-results"></ul>
</div>

    </span>
</div> 
</div>


<div id="content-wrapper"><nav id="sidebar">
  
    <ul class="nav flex-column topics" id="home-topics">
      
        
          
          


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="基礎R">
     

  <a class="nav-link" 
    href="/blogR/rlang.html"><i class="far fa-folder"></i>基礎R  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_92db98bffe2d6697b3536cbbf7b00074" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_92db98bffe2d6697b3536cbbf7b00074"  
  class="submenu collapse show" 
  data-bs-parent="#home-topics">

    
  
  
   
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_0_requirement.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1 Requirement</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_1_%E7%B3%BB%E7%B5%B1.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1 運作環境</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_2_filesystem.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2 檔案系統</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_3_%E5%9F%B7%E8%A1%8C.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3 執行</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_4_rpackages.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4 R Package</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/1_5_%E7%B7%A8%E7%A2%BC.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5 編碼</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_0_%E8%BC%B8%E5%87%BA%E8%BC%B8%E5%85%A5.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0 基本輸出輸入</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_1_%E8%AE%80%E6%AA%94%E5%AF%AB%E6%AA%94.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1 讀檔寫檔</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_2_data_explorer.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2 資料探索</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/2_3_data_explorer.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3 資料探索</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/3_quickview1.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3. Quick view 1</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_1_1_type_%E5%9F%BA%E6%9C%AC.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1 基本</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_1_2_type%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1.2 練習</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_2_type_vector.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.2 向量</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_3_type_matrix.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.3 矩陣</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_4_type_list.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.4 串列 list</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_5_type_string_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.5 字串處理函數</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_6_type_dataframe.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.6 資料集 data frame</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_7_type_factor.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.7 因子</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_11_%E6%AD%A3%E8%A6%8F%E8%A1%A8%E9%81%94%E8%AA%9E%E6%B3%95.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.11 正規表達語法</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/4_15_json.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.15 json</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/6_1_programming.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">6.1 Programming basic</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/6_3_apply_family.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">6.3 function - apply family</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_1_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.1 R 函數的基本撰寫</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_2_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.2 R函數進階</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_3_function.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.3 R 函數定義的幾種分類</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_8_objectbasic.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.8 R的物件相關概念</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/7_9_%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91s3.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">7.9 物件導向S3</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/9_1_plot.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">9.1 基本繪圖</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/9_2_%E5%A4%9A%E5%9C%96%E7%96%8A%E5%9C%96.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">9.2 多圖疊圖</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/9_3_plot.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">9.3 畫圖練習</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/10_00_dplyrbasic01.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">10. tidyr, dplyr basic</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/11_00_sampling.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">11. sampling</a></li>
     
    
        <li class="nav-item active"><a class="nav-link" href="/blogR/rlang/11_environments.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">11 Environments</a></li>
     
   
     
   
     
   
        <li>


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="暫時">
     

  <a class="nav-link" 
    href="/blogR/rlang/demo.html"><i class="far fa-folder"></i>暫時  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f03d3d24b564dd9c39af6eb86300021f" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_f03d3d24b564dd9c39af6eb86300021f"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_92db98bffe2d6697b3536cbbf7b00074">

    
  
  
   
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/demo/citation.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">引用</a></li>
    </ul>
</li>
     
  
</li>
     
   
        <li>


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="練習用">
     

  <a class="nav-link" 
    href="/blogR/rlang/hw.html"><i class="far fa-folder"></i>練習用  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_b4809f6375b9dda8660e4938c2644e82" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_b4809f6375b9dda8660e4938c2644e82"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_92db98bffe2d6697b3536cbbf7b00074">

    
  
  
   
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/hw/hw_basic.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">assignment-1</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/hw/hw_regexp.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">regexpr</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/hw/hw_filesystem.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">檔案系統</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/hw/dataset_class.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">資料集</a></li>
    </ul>
</li>
     
  
</li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/rlang/resources.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">練習相關檔案</a></li>
    </ul>
</li>
     
  

        
          
          


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="基礎計量">
     

  <a class="nav-link" 
    href="/blogR/econometrics.html"><i class="far fa-folder"></i>基礎計量  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_c59a6b16a979dae063e00e4a916e3284" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_c59a6b16a979dae063e00e4a916e3284"  
  class="submenu collapse" 
  data-bs-parent="#home-topics">

    
  
  
   
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/0_prerequest.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0 前置準備</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/1_t%E6%AA%A2%E5%AE%9A.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0 t檢定</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/2_anova.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2. ANOVA</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/a_a_%E8%B3%87%E6%96%99%E8%99%95%E7%90%86.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">A.a 資料處理</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/a_b_mpg%E7%82%BA%E4%BE%8B%E7%9A%84ggplot.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">A.b mpg為例的ggplot</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/econometrics/lmm.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">lmm</a></li>
     
   
    </ul>
</li>
     
  

        
          
          


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="專題">
     

  <a class="nav-link" 
    href="/blogR/topic.html"><i class="far fa-folder"></i>專題  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f7b6d4231ab239a316b7f2d9edf32817" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_f7b6d4231ab239a316b7f2d9edf32817"  
  class="submenu collapse" 
  data-bs-parent="#home-topics">

    
  
  
   
   
     
   
        <li>


 

<li class="nav-item" data-bs-toggle="tooltip" data-bs-placement="right" title="實驗">
     

  <a class="nav-link" 
    href="/blogR/topic/simulation.html"><i class="far fa-folder"></i>實驗  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_e617bdc52da54290f99855ac9d5037aa" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
  <ul id="menu_item_e617bdc52da54290f99855ac9d5037aa"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_f7b6d4231ab239a316b7f2d9edf32817">

    
  
  
   
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/shinyapps/tutorial/01_hello/readme.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title=""></a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/01_shiny_basic.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">01_shiny_basic</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/navarpage.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2. navarPage</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/2_1_%E9%9A%A8%E6%A9%9F%E8%AE%8A%E6%95%B8.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1 隨機變數</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/2_1_%E4%BA%82%E6%95%B8%E5%87%BD%E6%95%B8%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.1 亂數函數練習</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/3_shinydist.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3. shinyDist</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/4_01_sim.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1 模擬基本 1</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/4_02_sim.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.2 模擬基本 2</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/50_2_%E8%A7%A3%E7%AD%94.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">50_1_解答</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/50_1_%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">50.1 練習</a></li>
     
   
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/mc_%E5%9F%BA%E6%9C%AC.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">MC_基本</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/poisson%E5%88%86%E9%85%8D.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">Poisson分配</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/shinyapps/tutorial/tagsdemo/readme.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">Readme</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/sinytest.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">sinytest</a></li>
     
   
        <li class="nav-item"><a class="nav-link" href="/blogR/topic/simulation/central.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">中央</a></li>
    </ul>
</li>
     
  
</li>
     
   
    </ul>
</li>
     
  

          
        
  </ul> 
    
    <hr/>
    <section id="footer">
      最近3篇<br/><ul><li><a href="https://airbone4.github.io/blogR/topic/simulation/50_3_%E5%8D%8A%E6%88%90%E5%93%81.html"> <i class="far fa-clock" ></i>50_2_半成品[2022-01-06 PM 01:01]</a></li><li><a href="https://airbone4.github.io/blogR/topic/simulation/50_2_%E8%A7%A3%E7%AD%94.html"> <i class="far fa-clock" ></i>50_1_解答[2022-01-06 PM 12:23]</a></li><li><a href="https://airbone4.github.io/blogR/topic/simulation/50_1_%E7%B7%B4%E7%BF%92.html"> <i class="far fa-clock" ></i>50.1 練習[2022-01-05 PM 10:45]</a></li></ul>
    </section>
  
</nav><article class="article mx-2 mt-3" id="body-inner">
    <p>參考
<a href="https://holtzy.github.io/Pimp-my-rmd/">https://holtzy.github.io/Pimp-my-rmd/</a></p>
<h2 id="introduction">Introduction</h2>
<p>The environment is the data structure that powers scoping.  相關概念:lexical scoping, namespaces, and R6 classes。</p>
<p>這個文件需要
<code>devtools::install_github(&quot;tidyverse/rlang&quot;)</code></p>
<h3 id="quiz">Quiz</h3>
<p>If you can answer the following questions correctly, you already know the most important topics in this chapter. You can find the answers at the end of the chapter in <a href="#env-answers">answers</a>.</p>
<ol>
<li>List at least three ways that an environment is different to a list.</li>
<li>What is the parent of the global environment? What is the only environment that doesn't have a parent?</li>
<li>What is the enclosing environment of a function? Why is it important?</li>
<li>How do you determine the environment from which a function was called?</li>
<li>How are <code>&lt;-</code> and <code>&lt;&lt;-</code> different?</li>
</ol>
<h3 id="outline">Outline</h3>
<ul>
<li><a href="#基本">Environment basics</a> introduces you to the basic properties of an environment and shows you how to create your own.</li>
<li><a href="#env-recursion">Recursing over environments</a> provides a function template for computing with environments, illustrating the idea with a useful function.</li>
<li><a href="#explicit-envs">Explicit environments</a> briefly discusses three places where environments are useful data structures for solving other problems.</li>
</ul>
<h3 id="prerequisites">Prerequisites</h3>
<p>這個章節利用了套件<code>rlang</code>裡的函數，來探索環境物件。</p>
<p>在<code>rlang</code>套件中,<code>env_</code>函數是設計用來和pipe一起工作的,這裡不深入。</p>
<div class="notices ms-5">
<div class="info"><p><code>global_env()</code>和<code>globalenv()</code>的執行結果一樣。</p>
<pre><code class="language-r">.GlobalEnv
#> <environment: R_GlobalEnv>
globalenv()
#> <environment: R_GlobalEnv>
global_env()
#> <environment: R_GlobalEnv>

.BaseNamespaceEnv
#> <environment: namespace:base>
current_env() #
#> <environment: R_GlobalEnv>
</code></pre>
</div>
</div>
<h2 id="基本">基本</h2>
<p>基本上一個 environment 類似名稱串列(named list),但是有4個例外:</p>
<ul>
<li>名稱唯一(就是變數唯一)</li>
<li>名稱沒有順序關係</li>
<li>會有一個parent</li>
<li>當改變的時候,不會自動複製 (Environments are not copied when modified).</li>
</ul>
<p>分別探索上面四點:</p>
<h3 id="提要">提要</h3>
<p>要建立environment, 使用 <code>rlang::env()</code>. 類似使用<code>list()</code>,也是一組名稱-值的配對。:</p>
<pre><code class="language-r">e1 &lt;- env(
  a = FALSE,
  b = &quot;a&quot;,
  c = 2.3,
  d = 1:3
)
</code></pre>
<div class="notices ms-5">
<div class="info">建立environment物件,利用函數 <code>new.env()</code> 不用管參數 <code>hash</code> 和 <code>size</code>。注意不能利用<code><-</code>同時定義和建立 parameters; 例如,
e1 <- env( <code>a <- FALSE</code> ) # error</div>
</div>
<p>environment物件可以想成是一個袋子,或是names集合。因為沒有次序關係</p>
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/bindings.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<p>就像在 <a href="#env-modify">names and values</a>, 討論的,這個物件是參考為基礎.(in C concept) 不會有copy on modifying。而且,環境物件可以自己指向自己(recursion)</p>
<pre><code class="language-r">e1$d &lt;- e1
</code></pre>
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/loop.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<p>沒有指派的環境變數,只會顯示記憶體位址:</p>
<pre><code class="language-r">e1
#&gt; &lt;environment: 0x0000000013c47d10&gt;
</code></pre>
<p>要知道內容可以使用 <code>env_print()</code> :</p>
<pre><code class="language-r">env_print(e1)
#&gt; &lt;environment: 0000000013C47D10&gt;
#&gt; parent: &lt;environment: global&gt;
#&gt; bindings:
#&gt;  * a: &lt;lgl&gt;
#&gt;  * b: &lt;chr&gt;
#&gt;  * c: &lt;dbl&gt;
#&gt;  * d: &lt;env&gt;
</code></pre>
<p>想要知道目前有哪些binding(名稱-值 配對)可以利用 <code>env_names()</code></p>
<pre><code class="language-r">env_names(e1)
#&gt; [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;
</code></pre>
<div class="notices ms-5">
<div class="info">要列出環境下的繫結，在R 3.2.0 以上,可以使用函數<code>names()</code> ,之前的版本則是 <code>ls()</code>, 但是要注意的是ls 的參數 <code>all.names</code> 內設是 <code>FALSE</code> 因此<code>.</code>開頭的看不到。.</div>
</div>
<h3 id="important-environments">Important environments</h3>
<p>另外參考 [Special environments]。
<code>current_env()</code> 可以知道目前程式碼的執行環境。例如,當我們互動執行RCODE的時候,環境通常是 [總體環境](#global environment),或者由函數<code>global_env()</code>可以得到。這個總體環境有時候就叫&quot;workspace&quot;，同時,這也是函數外面所有互動計算發生的地方。
環境物件的比較不能用<code>==</code>,只能用函數<code>identical()</code>。</p>
<pre><code class="language-r">identical(global_env(), current_env())
#&gt; [1] TRUE

global_env() == current_env()
#&gt; Error in global_env() == current_env(): 只有基元或串列類型才能做比較 (1)
</code></pre>
<div class="notices ms-5">
<div class="info"><ul>
<li><code>globalenv()</code> 和<code>.GlobalEnv</code>: 拿到global environmentand。</li>
<li><code>environment()</code>:拿到目前的環境</li>
</ul>
<p>global environment 的名稱為 <code>R_GlobalEnv</code> 。</p>
<pre><code class="language-r">global_env()
#> <environment: R_GlobalEnv>
current_env()
#> <environment: R_GlobalEnv>
.GlobalEnv
#> <environment: R_GlobalEnv>
</code></pre>
</div>
</div>
<h3 id="parents">Parents</h3>
<p>每一個環境物件都有一個 parent。 parent 也一個環境物件。在方塊圖中,parent以藍色圈表示,並用箭頭指向另一個環境物件。</p>
<p>這個parent用來建立 lexical scoping: 如果name沒有在某個環境物件找到,R會重複的在parent中找。</p>
<p>函數<code>env()</code>可以用來建立一個沒有名字的環境
You can set the parent environment by supplying an unnamed argument to <code>env()</code>. If you don't supply it, it defaults to the current environment.</p>
<pre><code class="language-r">e2a &lt;- env(d = 4, e = 5)
e2b &lt;- env(e2a, a = 1, b = 2, c = 3)
</code></pre>
<p><!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/parents.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<code>e2b</code>的parent 為<code>e2a</code>,<code>e2a</code>沒有parent。</p>
<p>函數 <code>env_parent()</code>可以用來找出某個環境物件的parent:</p>
<pre><code class="language-r">env_parent(e2b)
#&gt; &lt;environment: 0x0000000015418df8&gt;
env_parent(e2a)
#&gt; &lt;environment: R_GlobalEnv&gt;
</code></pre>
<div class="notices ms-5">
<div class="info">parent.env() === env_parent()</div>
</div>
<p>所有的環境物件中只有一個名稱為<code>R_EmptyEnv</code>的物件沒有parent(用空心藍色表示):</p>
<pre><code class="language-r">e2c &lt;- env(empty_env(), d = 4, e = 5)
e2d &lt;- env(e2c, a = 1, b = 2, c = 3)
</code></pre>
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/parents-empty.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<div class="notices ms-5">
<div class="info">emptyenv()  === empty_env()</div>
</div>
<p>試圖利用函數<code>env_parent()</code>找空環境物件的parent會發生錯誤:</p>
<pre><code class="language-r">env_parent(empty_env())
#&gt; Error: The empty environment has no parent
</code></pre>
<p>函數 <code>env_parents()</code>可以找出目前環境物件的所有祖先:這個函數會繼續直到遇上global environment 或是空環境物件。上述過程可以利用<code>last</code>環境物件控制。</p>
<pre><code class="language-r">env_parents(e2b)
#&gt; [[1]]   &lt;env: 0000000015418DF8&gt;
#&gt; [[2]] $ &lt;env: global&gt;

env_parents(e2d)
#&gt; [[1]]   &lt;env: 0000000015F16BB0&gt;
#&gt; [[2]] $ &lt;env: empty&gt;
</code></pre>
<div class="notices ms-5">
<div class="info">可以利用Use <code>parent.env()</code> 找到環境的parent，但是base中沒有可以找出所有祖先的函數。</div>
</div>
<h3 id="getting-and-setting">Getting and setting</h3>
<p>存取環境中元素的方法和list類似:使用 <code>$</code> 和 <code>[[</code>:</p>
<pre><code class="language-r">e3 &lt;- env(x = 1, y = 2)
e3$x
#&gt; [1] 1
e3$z &lt;- 3
e3[[&quot;z&quot;]]
#&gt; [1] 3
</code></pre>
<p>但是不能使用 <code>[[</code> +數字索引,也不能單獨使用 <code>[</code>:</p>
<pre><code class="language-r">e3[[1]]
#&gt; Error in e3[[1]]: 取子集環境時的引數不正確

e3[c(&quot;x&quot;, &quot;y&quot;)]
#&gt; Error in e3[c(&quot;x&quot;, &quot;y&quot;)]: 'environment' 類型的物件無法具有子集合
</code></pre>
<p>當環境中的繫結不存在時(簡單點,就是變數不存在時)<code>$</code> 和 <code>[[</code> 會傳回 <code>NULL</code> 但不會引發錯誤,如果要有錯誤警告,則利用 <code>env_get()</code> :</p>
<pre><code class="language-r">e3$xyz
#&gt; NULL

env_get(e3, &quot;xyz&quot;)
#&gt; Error in env_get(e3, &quot;xyz&quot;): 缺少引數 &quot;default&quot;，也沒有預設值
</code></pre>
<p>當繫結不存在,但是想要有預設值傳回時,可以利用參數 <code>default</code> .</p>
<pre><code class="language-r">env_get(e3, &quot;xyz&quot;, default = NA)
#&gt; [1] NA
</code></pre>
<p>另有兩種方式可以在環境物件加入繫結:</p>
<ul>
<li>
<p><code>env_poke()</code><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> takes a name (as string) and a value:</p>
<pre><code class="language-r">env_poke(e3, &quot;a&quot;, 100)
e3$a
#&gt; [1] 100
</code></pre>
</li>
<li>
<p><code>env_bind()</code> allows you to bind multiple values:</p>
<pre><code class="language-r">env_bind(e3, a = 10, b = 20)
env_names(e3)
#&gt; [1] &quot;x&quot; &quot;y&quot; &quot;z&quot; &quot;a&quot; &quot;b&quot;
</code></pre>
</li>
</ul>
<p><code>env_has()</code>: 是否環境中有繫結</p>
<pre><code class="language-r">env_has(e3, &quot;a&quot;)
#&gt;    a 
#&gt; TRUE
</code></pre>
<p>不能像是list中刪除元素的方式(指派<code>NULL</code>給元素)，而必須使用 <code>env_unbind()</code>:</p>
<pre><code class="language-r">e3$a &lt;- NULL
env_has(e3, &quot;a&quot;)
#&gt;    a 
#&gt; TRUE

env_unbind(e3, &quot;a&quot;)
env_has(e3, &quot;a&quot;)
#&gt;     a 
#&gt; FALSE
</code></pre>
<p>從一個物件Unbinding 解除名稱，並不會刪除物件，是否刪除物件是 garbage collector的工作.。可以參考 <a href="#gc">GC</a>.</p>
<div class="notices ms-5">
<div class="info">See <code>get()</code>, <code>assign()</code>, <code>exists()</code>, and <code>rm()</code>. These are designed interactively for use with the current environment, so working with other environments is a little clunky. Also beware the <code>inherits</code> argument: it defaults to <code>TRUE</code> meaning that the base equivalents will inspect the supplied environment and all its ancestors.</div>
</div>
<h3 id="advanced-bindings">Advanced bindings</h3>
<p>There are two more exotic variants of <code>env_bind()</code>:</p>
<ul>
<li>
<p><code>env_bind_exprs()</code> creates <strong>delayed bindings</strong>, which are evaluated the first time they are accessed. Behind the scenes, delayed bindings create promises, so behave in the same way as function arguments.</p>
<pre><code class="language-r">env_bind_exprs(current_env(), b = {Sys.sleep(1); 1})
#&gt; Warning: `env_bind_exprs()` is deprecated as of rlang 0.3.0.
#&gt; Please use `env_bind_lazy()` instead.
#&gt; This warning is displayed once per session.

system.time(print(b))
#&gt; [1] 1
#&gt; 使用者   系統   流逝 
#&gt;   0.00   0.00   1.01
system.time(print(b))
#&gt; [1] 1
#&gt; 使用者   系統   流逝 
#&gt;      0      0      0
</code></pre>
<p>Delayed bindings are used to implement <code>autoload()</code>, which makes R behave 
as if the package data is in memory, even though it's only loaded from 
disk when you ask for it.</p>
</li>
<li>
<p><code>env_bind_fns()</code> creates <strong>active bindings</strong> which are re-computed every time they're accessed:</p>
<pre><code class="language-r">env_bind_fns(current_env(), z1 = function(val) runif(1))    
#&gt; Warning: `env_bind_fns()` is deprecated as of rlang 0.3.0.
#&gt; Please use `env_bind_active()` instead.
#&gt; This warning is displayed once per session.
z1
#&gt; [1] 0.5319685
z1
#&gt; [1] 0.2939102
</code></pre>
<p>The argument to the function allows you to also override behaviour when the variable is set:</p>
<pre><code class="language-r">env_bind_fns(current_env(), z2 = function(val) {
  if (missing(val)) {
    2
  } else {
     stop(&quot;Don't touch z2!&quot;, call. = FALSE)
  }
})

z2
#&gt; [1] 2
z2 &lt;- 3
#&gt; Error: Don't touch z2!
</code></pre>
</li>
</ul>
<div class="notices ms-5">
<div class="info">See  <code>?delayedAssign()</code> and <code>?makeActiveBinding()</code>.</div>
</div>
<h3 id="exercises">Exercises</h3>
<ol>
<li>List three ways in which an environment differs from a list.</li>
<li>Create an environment as illustrated by this picture.
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/recursive-1.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve--></li>
<li>Create a pair of environments as illustrated by this picture.
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/recursive-2.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve--></li>
<li>Explain why <code>e[[1]]</code> and <code>e[c(&quot;a&quot;, &quot;b&quot;)]</code> don't make sense when <code>e</code> is
an environment.</li>
<li>Create a version of <code>env_poke()</code> that will only bind new names, never 
re-bind old names. Some programming languages only do this, and are known 
as <a href="http://en.wikipedia.org/wiki/Assignment_(computer_science)#Single_assignment">single assignment languages</a>.</li>
</ol>
<h2 id="recursing-over-environments">Recursing over environments</h2>
<p>If you want to operate on every ancestor of an environment, it's often convenient to write a recursive function. This section shows you how, applying your new knowledge of environments to write a function that given a name, finds the environment <code>where()</code> that name is defined, using R's regular scoping rules.</p>
<p>The definition of <code>where()</code> is straightforward. It has two arguments: the name to look for (as a string), and the environment in which to start the search. (We'll learn why <code>caller_env()</code> is a good default in <a href="#calling-environments">calling environments</a>.)</p>
<pre><code class="language-r">where &lt;- function(name, env = caller_env()) {
  if (identical(env, empty_env())) {
    # Base case
    stop(&quot;Can't find &quot;, name, call. = FALSE)
  } else if (env_has(env, name)) {
    # Success case
    env
  } else {
    # Recursive case
    where(name, env_parent(env))
  }
}
</code></pre>
<p>3個情況:</p>
<ul>
<li>The base case: 到達empty environment 沒有parent無法繼續,所以丟出error.</li>
<li>The successful case: 在env中找到name ，成功,所以傳回env。.</li>
<li>The recursive case: 在env中找不到,繼續在parent中找。.</li>
</ul>
<p>These three cases are illustrated with these three examples:</p>
<pre><code class="language-r">where(&quot;yyy&quot;)
#&gt; Error: Can't find yyy

x &lt;- 5
where(&quot;x&quot;)
#&gt; &lt;environment: R_GlobalEnv&gt;

where(&quot;mean&quot;)
#&gt; &lt;environment: base&gt;
</code></pre>
<p>想像有兩個環境物件(如圖):</p>
<pre><code class="language-r">e4a &lt;- env(empty_env(), a = 1, b = 2)
e4b &lt;- env(e4a, x = 10, a = 11)
</code></pre>
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/where-ex.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<ul>
<li><code>where(a, e4a)</code> will find <code>a</code> in <code>e4a</code>.</li>
<li><code>where(&quot;b&quot;, e4a)</code> doesn't find <code>b</code> in <code>e4a</code>, so it looks in its parent, <code>e4b</code>, and finds it there.</li>
<li><code>where(&quot;c&quot;, e4a)</code> looks in <code>e4a</code>, then <code>e4b</code>, then hits the empty environment and throws an error.</li>
</ul>
<p>It's natural to work with environments recursively, so <code>where()</code> provides a useful template. Removing the specifics of <code>where()</code> shows the structure more clearly:</p>
<pre><code class="language-r">f &lt;- function(..., env = caller_env()) {
  if (identical(env, empty_env())) {
    # base case
  } else if (success) {
    # success case
  } else {
    # recursive case
    f(..., env = env_parent(env))
  }
}
</code></pre>
<div class="notices ms-5">
<div class="info"><h3 id="iteration-vs-recursion">Iteration vs recursion</h3>
<p>也可以用迭代的方式</p>
<pre><code class="language-r">f2 <- function(..., env = caller_env()) {
  while (!identical(env, empty_env())) {
    if (success) {
      # success case
      return()
    }
    # inspect parent
    env <- env_parent(env)
  }

  # base case
}
</code></pre>
</div>
</div>
<h3 id="exercises-1">Exercises</h3>
<ol>
<li>
<p>Modify <code>where()</code> to return <em>all</em> environments that contain a binding for
<code>name</code>. Carefully think through what type of object the function will
need to return.</p>
</li>
<li>
<p>Write a function called <code>fget()</code> that finds only function objects. It 
should have two arguments, <code>name</code> and <code>env</code>, and should obey the regular 
scoping rules for functions: if there's an object with a matching name 
that's not a function, look in the parent. For an added challenge, also 
add an <code>inherits</code> argument which controls whether the function recurses up 
the parents or only looks in one environment.</p>
</li>
</ol>
<h2 id="function-envs">Special environments</h2>
<p>這裡討論 package environments. 然後探討當函數建立時,綁入函數的函數環境。還有當函數被呼叫時的執行環境(ephemeral)。</p>
<p><a href="package-environments">套裝環境</a>主要是看這些環境如何支援namespaces。同時,namespace讓package每次載入的時候,都有一樣的行為,而不售其他packages載入先後的影響。</p>
<h3 id="套件環境和搜尋路徑">套件環境和搜尋路徑</h3>
<p>每個套件經由<code>library()</code> 或 <code>require()</code> 接入成為<a href="#global-environment">總體環境</a>的parent。而最後一個<a href="#attach">接入</a>的套件,則是總體環境的第一個parent:</p>
<div class="notices ms-5">
<div class="info"><p>load 和 attach不一樣，當我們使用<code>require</code>或 <code>library</code>的時候,我們做的是<code>attach</code> 。就是在目前(使用者)環境串列中加入我們利用library載入的物件.</p>
<ul>
<li>attaching and .onAttach
<ul>
<li>thus means that a package is attached to the user space aka the global environment</li>
<li>usually this is done via library(pkg) and</li>
<li>you can use normal <code>fun()</code> syntax</li>
</ul>
</li>
<li>loading and .onLoad
<ul>
<li>thus means that package is (in any way) made available to the current R-session</li>
<li>(e.g. by loading/attaching another package that depends on it or by using pkg::fun() syntax the first time)</li>
<li>though you will not find functions in the global environment</li>
<li>you can use <code>pkg::fun()</code></li>
</ul>
</li>
</ul>
</div>
</div>
<p>例如找出總體環境的parent</p>
<pre><code class="language-r">env_parent(global_env())
#&gt; &lt;environment: package:rlang&gt;
#&gt; attr(,&quot;name&quot;)
#&gt; [1] &quot;package:rlang&quot;
#&gt; attr(,&quot;path&quot;)
#&gt; [1] &quot;C:/Users/linchao/Documents/R/win-library/4.1/rlang&quot;
</code></pre>
<p>找到是最近一次,使用指令library(packageA),裡面這個packageA。以此類推,下面找出在packageA之前的套件環境。</p>
<pre><code class="language-r">env_parent(env_parent(global_env()))
#&gt; &lt;environment: package:stats&gt;
#&gt; attr(,&quot;name&quot;)
#&gt; [1] &quot;package:stats&quot;
#&gt; attr(,&quot;path&quot;)
#&gt; [1] &quot;C:/Program Files/R/R-4.1.1/library/stats&quot;
</code></pre>
<p>如果一層一層parent回朔,就可以到每個套件被接入的順序,這也是R執行中會用到的 <strong>search path</strong> 因為這些環境的所有物件都可以經由 top-level interactive workspace找到。</p>
<pre><code class="language-r">search_envs()
#&gt;  [[1]] $ &lt;env: global&gt;
#&gt;  [[2]] $ &lt;env: package:rlang&gt;
#&gt;  [[3]] $ &lt;env: package:stats&gt;
#&gt;  [[4]] $ &lt;env: package:graphics&gt;
#&gt;  [[5]] $ &lt;env: package:grDevices&gt;
#&gt;  [[6]] $ &lt;env: package:utils&gt;
#&gt;  [[7]] $ &lt;env: package:datasets&gt;
#&gt;  [[8]] $ &lt;env: package:methods&gt;
#&gt;  [[9]] $ &lt;env: Autoloads&gt;
#&gt; [[10]] $ &lt;env: package:base&gt;
</code></pre>
<div class="notices ms-5">
<div class="info">函數 <code>search()</code>可以找出環境物件的名稱。</div>
</div>
<p>最後兩個環境物件都一樣:</p>
<ul>
<li>
<p><code>Autoloads</code> 環境物件,利用 delayed bindings來節省記憶體，也就是在需要的時候才載入(loading)package中的物件(例如大型資料集)。</p>
</li>
<li>
<p>base environment, <code>package:base</code> 或簡稱 <code>base</code>, 是base 套裝的環境物件。用來 載入其他套裝(bootstrap)。利用函數 <code>base_env()</code>存取.</p>
</li>
</ul>
<p>利用圖型表示:</p>
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/search-path.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<p>當利用 <code>library()</code> attach其他套件的時候, 總體環境的parent馬上改變:</p>
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/search-path-2.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<h3 id="the-function-environment">The function environment</h3>
<p>當函數被建立的時候,現有的環境會被繫結。稱為<em>function environment</em>, 主要用來支援lexical scoping. 在電腦語言中,當<code>函數紀錄它們的運作環境時</code>,我們說這個函數屬於 <code>closures</code>。,這也是為甚麼這個字眼經常在R語言中出現。.</p>
<p>利用函數 <code>fn_env()</code>可以得到函數的環境物件:</p>
<pre><code class="language-r">y &lt;- 1
f &lt;- function(x) x + y
fn_env(f)
#&gt; &lt;environment: R_GlobalEnv&gt;
</code></pre>
<div class="notices ms-5">
<div class="info">一樣利用函數 <code>environment(f)</code> 可以找到函數 <code>f</code>的環境.</div>
</div>
<p>在圖形中,函數被畫成類似子彈,而彈頭的部分繫結環境。</p>
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/bindings.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<p>在這個案例中,<code>f()</code>繫結的環境物件,就是繫結名稱<code>f</code>的環境。但並不一定總是這樣，例如在下一個例子中,<code>g</code>被繫結在新環境物件<code>e</code>中。但是函數<code>g()</code>繫結的是global environment。這之間的分別是我們如何找到<code>g</code>和<code>g</code>如何找到他的變數。</p>
<pre><code class="language-r">e &lt;- env()
e$g &lt;- function() 1
</code></pre>
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/binding-2.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<h3 id="namespaces">Namespaces</h3>
<p>在上面的圖形中,我們已經知道套件的parent會隨著之前套件載入的順序不同而不同。這就導致R程式設計者必須保證個別套件上如果使用別的套件的函數，必須是原始目的的那一個。<em>namespaces</em> 就是為此目的而產生: 每個套件必須的使用必須一致,而不管使用者如何載入套件.</p>
<p>以 <code>sd()</code>為例子:</p>
<pre><code class="language-r">sd
#&gt; function (x, na.rm = FALSE) 
#&gt; sqrt(var(if (is.vector(x) || is.factor(x)) x else as.double(x), 
#&gt;     na.rm = na.rm))
#&gt; &lt;bytecode: 0x000000001c9a2d28&gt;
#&gt; &lt;environment: namespace:stats&gt;
</code></pre>
<p><code>sd()</code> 必須使用函數 <code>var()</code>, 因此這個<code>var()</code>到底來自 global environment,還是其他接入(attached)的套件的這種問題必須避免。 R avoids this problem by taking advantage of the function vs. binding environment described above.</p>
<p>每個套件中的函數和一對環境物件有關:套件環境(之前學到的)還有 <em>namespace</em> 環境物件。</p>
<ul>
<li>package environment:  是套件的外部介面，這是R使用者如何在接入的套件中尋找函數的地方(或者可以利用 <code>::</code>) package enviromnent 的parent 由搜尋路徑決定(可以利用<code>search()</code>知道)決定(也就是載入的順序)</li>
<li>namespace environment:是套件的內部介面。package environment 控制我們如何找到函數,而namespace environment控制函數如何找到變數。</li>
</ul>
<p>在package environment的每個繫結也可以在namespace environment中找到。這樣可以確保每個函數可以使用套件中的其他函數。但是有些繫結只能在namespace 中找到(例如內部或非輸出物件),這種內部物件通常是用來隱藏一些繁瑣的且不需要給使用者看到的細節。;</p>
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/namespace-bind.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<p>每個namespace environment 有一樣的祖集合:</p>
<ul>
<li>每個namespace有 <em>imports</em> 的環境物件，其中包含了套件中用到的所有函數繫結。而所謂<a href="#imports-environment">輸入環境</a>實際由套裝開發人員在檔案<code>NAMESPACE</code>指定</li>
<li>明確的輸入每個<code>base</code>函數,很繁瑣,所以R直接設定<code>import enviroment</code>的parent是<code>base *namespae*</code>[^1]。</li>
</ul>
<div class="notices ms-5">
<div class="info">The base namespace contains the same bindings as the base environment, but it has different parent.</div>
</div>
<ul>
<li><em>base namespace</em> 的parent是總體環境(#global environment).參考下圖,這種設計導致在import environment中找不到繫結時,會開始再總體環境中尋找,而之前提過總體環境通常是互動環境下名稱搜尋的開始路徑,這也導致搜尋的方式受到套件載入順序的影響。因此,R提供了了<code>R CMD check</code>來警告此種情況的發生。(雖然有麻煩,但是由於S3 方法的dispatch 關係,此種方式仍然留著)</li>
</ul>
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/namespace-env.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<p>綜合上述,可以得到下圖::
<!--html_preserve--><figure  class="figure nopre "><img src="diagrams/environments/namespace.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve--></p>
<p>所以當 <code>sd()</code> 搜尋<code>var</code> 的值的時候,搜尋順序是受到開發者的指定(在檔案NAMESPACE利用import)，而不會受到套裝使用者的影響。這樣保證每次套件程式碼執行的時候,都一樣,而不會受到一般使用者載入套件的順序而影響。</p>
<p>注意在package和namespace兩種環境之間沒有直接的連結.連結是由<em>函數環境</em>定義。</p>
<h3 id="execution-environments">Execution environments</h3>
<p><strong>execution</strong> environment. 下面的函數第一次執行的時候會傳回甚麼?第2次呢?</p>
<pre><code class="language-r">g &lt;- function(x) {
  if (!env_has(current_env(), &quot;a&quot;)) {
    message(&quot;Defining a&quot;)
    a &lt;- 1
  } else {
    a &lt;- a + 1
  }
  a
}
</code></pre>
<p>再一次利用下面的調用,確認你的答案:</p>
<pre><code class="language-r">g(10)
#&gt; Defining a
#&gt; [1] 1
g(10)
#&gt; Defining a
#&gt; [1] 1
g(11)
#&gt; Defining a
#&gt; [1] 1
</code></pre>
<p>這個函數每次執行都傳回💯<code>一樣的答案</code>,參考 <a href="#fresh-start">a fresh start</a>. 每次函數被調用的時候,一個新的環境都會被建立來主導執行。這種環境稱為<em>執行環境</em>。而<em>執行環境</em>的parent為 function environment.</p>
<p>用另一個簡單點的例子說明.
(圖中,執行環境的parent間接表示:經由函數環境).</p>
<pre><code class="language-r">h &lt;- function(x) {
  # 1.
  a &lt;- 2 # 2.
  x + a
}
y &lt;- h(1) # 3.
</code></pre>
<!--html_preserve--><figure  class="figure nopre "><img src="diagrams/environments/execution.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<p>執行環境(execution environment)短暫存在,當函數執行完畢通常會被GC。在幾種情況下,會在記憶體存在比較久,第一種是回傳給另一個變數:</p>
<pre><code class="language-r">h2 &lt;- function(x) {
  a &lt;- x * 2
  current_env()
}

e &lt;- h2(x = 10)
env_print(e)
#&gt; &lt;environment: 000000001D3DEF08&gt;
#&gt; parent: &lt;environment: global&gt;
#&gt; bindings:
#&gt;  * a: &lt;dbl&gt;
#&gt;  * x: &lt;dbl&gt;
fn_env(h2)
#&gt; &lt;environment: R_GlobalEnv&gt;
</code></pre>
<p>Another way to capture it is to return an object with a binding to that environment, like a function. The following example illustrates that idea with a function factory, <code>plus()</code>. We use that factory to create a function called <code>plus_one()</code>.</p>
<p>There's a lot going on in the diagram because the enclosing environment of <code>plus_one()</code> is the execution environment of <code>plus()</code>.</p>
<pre><code class="language-r">plus &lt;- function(x) {
  function(y) x + y
}

plus_one &lt;- plus(1)
plus_one
#&gt; function(y) x + y
#&gt; &lt;environment: 0x000000001d7333a0&gt;
</code></pre>
<!--html_preserve--><figure  class="figure nopre "><img src="diagrams/environments/closure.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<p>What happens when we call <code>plus_one()</code>? Its execution environment will have the captured execution environment of <code>plus()</code> as its parent:</p>
<pre><code class="language-r">plus_one(2)
#&gt; [1] 3
</code></pre>
<!--html_preserve--><figure  class="figure nopre "><img src="diagrams/environments/closure-call.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<p>You'll learn more about function factories in <a href="#functional-programming">functional programming</a>.</p>
<h3 id="exercises-2">Exercises</h3>
<ol>
<li>
<p>How is <code>search_envs()</code> different to <code>env_parents(global_env())</code>?</p>
</li>
<li>
<p>Draw a diagram that shows the enclosing environments of this function:</p>
<pre><code class="language-r">f1 &lt;- function(x1) {
  f2 &lt;- function(x2) {
    f3 &lt;- function(x3) {
      x1 + x2 + x3
    }
    f3(3)
  }
  f2(2)
}
f1(1)
</code></pre>
</li>
<li>
<p>Write an enhanced version of <code>str()</code> that provides more information 
about functions. Show where the function was found and what environment 
it was defined in.</p>
</li>
</ol>
<h2 id="the-call-stack">The call stack</h2>
<p>還有另一種環境稱為 <strong>caller</strong> environment, 可以經由 <code>rlang::caller_env()</code>存取。. This provides the environment from which the function was called, and hence varies based on how the function is called, not how the function was created. As we saw above this is a useful default whenever you write a function that takes an environment as an argument.</p>
<div class="notices ms-5">
<div class="info"><code>parent.frame()</code> is equivalent to <code>caller_env()</code>; just note that it returns an environment, not a frame.</div>
</div>
<p>To fully understand the caller environment we need to discuss two related concepts: the <strong>call stack</strong>, which is made up of <strong>frames</strong>. Executing a function creates two types of context. You've learned about one already: the execution environment is a child of the function environment, which is determined by where the function was created. There's another type of context created by where the function was called: this is called the call stack.</p>
<p>There are also a couple of small wrinkles when it comes to custom evaluation. See <a href="#eval-frame">environments vs. frames</a> for more details.</p>
<h3 id="simple-call-stacks">Simple call stacks</h3>
<p>Let's illustrate this with a simple sequence of calls: <code>f()</code> calls <code>g()</code> calls <code>h()</code>.</p>
<pre><code class="language-r">f &lt;- function(x) {
  g(x = 2)
}
g &lt;- function(x) {
  h(x = 3)
}
h &lt;- function(x) {
  stop()
}
</code></pre>
<p>The way you most commonly see a call stack in R is by looking at the <code>traceback()</code> after an error has occured:</p>
<pre><code class="language-r">f(x = 1)
#&gt; Error:
traceback()
#&gt; 4: stop()
#&gt; 3: h(x = 3) 
#&gt; 2: g(x = 2)
#&gt; 1: f(x = 1)
</code></pre>
<p>Instead of <code>stop()</code> + <code>traceback()</code> to understand the call stack, we're going to use <code>lobstr::cst()</code> to print out the <strong>c</strong>all <strong>s</strong>tack <strong>t</strong>ree:</p>
<pre><code class="language-r">h &lt;- function(x) {
  lobstr::cst()
}
f(x = 1)
#&gt; ???
#&gt; ???f(x = 1)
#&gt;   ???g(x = 2)
#&gt;     ???h(x = 3)
#&gt;       ???lobstr::cst()
</code></pre>
<p>This shows us that <code>cst()</code> was called from <code>h()</code>, which was called from <code>g()</code>, which was called from <code>f()</code>. Note that the order is the opposite from <code>traceback()</code>. As the call stacks get more compliated, I think it's easier to understand the sequence of calls if you start from the beginning, rather than the end (i.e. <code>f()</code> calls <code>g()</code>; rather than <code>g()</code> was called by <code>f()</code>).</p>
<h3 id="lazy-evaluation">Lazy evaluation</h3>
<p>The call stack above is simple - while you get a hint that there's some tree-like structure involved, everything happens on a single branch. This is typical of a call stack when all arguments are eagerly evaluated.</p>
<p>Let's create a more complicated example that involves some lazy evaluation. We'll create a sequence of functions, <code>a()</code>, <code>b()</code>, <code>c()</code>, that pass along an argument <code>x</code>.</p>
<pre><code class="language-r">a &lt;- function(x) b(x)
b &lt;- function(x) c(x)
c &lt;- function(x) x

a(f())
#&gt; ???
#&gt; ???a(f())
#&gt; ??? ???b(x)
#&gt; ???   ???c(x)
#&gt; ???f()
#&gt;   ???g(x = 2)
#&gt;     ???h(x = 3)
#&gt;       ???lobstr::cst()
</code></pre>
<p><code>x</code> is lazily evaluated so this tree gets two branches. In the first branch <code>a()</code> calls <code>b()</code>, then <code>b()</code> calls <code>c()</code>. The second branch starts when <code>c()</code> evaluates its argument <code>x</code>. This argument is evaluated in a new branch because the environment in which it is evaluated is the global environment, not the environment of <code>c()</code>.</p>
<h3 id="frames">Frames</h3>
<p>Each element of the call stack is a <strong>frame</strong><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>, also known as an evaluation context.
The frame is an extremely important internal data structure, and R code can only access a small part of the data structure because it's so critical. A frame has three main components that are accessible from R:</p>
<ul>
<li>
<p>An expression (labelled with <code>expr</code>) giving the function call. This is
what <code>traceback()</code> prints out.</p>
</li>
<li>
<p>An environment (labelled with <code>env</code>), which is typically the execution 
environment of a function. There are two main exceptions: the environment of 
the global frame is the global environment, and calling <code>eval()</code> also 
generates frames, where the environment can be anything.</p>
</li>
<li>
<p>A parent, the previous call in the call stack (shown by a grey arrow).</p>
</li>
</ul>
<!--html_preserve--><figure  class="figure nopre  mx-auto"><img src="diagrams/environments/calling.png" class="figure-img w-100 " width="300px"/></figure><!--/html_preserve-->
<p>(To focus on the calling environments, I have omitted the bindings in the global environment from <code>f</code>, <code>g</code>, and <code>h</code> to the respective function objects.)</p>
<p>The frame also holds exit handlers created with <code>on.exit()</code>, restarts and handlers for the condition system, and which context to <code>return()</code> to when a function completes. These are important for the internal operation of R, but are not directly accessible.</p>
<h3 id="dynamic-scope">Dynamic scope</h3>
<p>Looking up variables in the calling stack rather than in the enclosing environment is called <strong>dynamic scoping</strong>. Few languages implement dynamic scoping (Emacs Lisp is a <a href="http://www.gnu.org/software/emacs/emacs-paper.html#SEC15">notable exception</a>.) This is because dynamic scoping makes it much harder to reason about how a function operates: not only do you need to know how it was defined, you also need to know the context in which it was called. Dynamic scoping is primarily useful for developing functions that aid interactive data analysis. It is one of the topics discussed in <a href="#nse">non-standard evaluation</a>.</p>
<h3 id="exercises-3">Exercises</h3>
<ol>
<li>Write a function that lists all the variables defined in the environment
in which it was called. It should return the same results as <code>ls()</code>.</li>
</ol>
<h2 id="explicit-envs">As data structures</h2>
<p>As well as powering scoping, environments are also useful data structures in their own right because they have reference semantics.  There are three common problems that they can help solve:</p>
<ul>
<li>
<p><strong>Avoiding copies of large data</strong>. Since environments have reference semantics, 
you'll never accidentally create a copy. This makes it a useful vessel for 
large objects. Bare environments are not that pleasant to work with;
I recommend using R6 objects instead. Learn more in [R6].</p>
</li>
<li>
<p><strong>Managing state within a package</strong>. Explicit environments are useful in 
packages because they allow you to maintain state across function calls. 
Normally, objects in a package are locked, so you can't modify them 
directly. Instead, you can do something like this:</p>
<pre><code class="language-r">my_env &lt;- new.env(parent = emptyenv())
my_env$a &lt;- 1

get_a &lt;- function() {
  my_env$a
}
set_a &lt;- function(value) {
  old &lt;- my_env$a
  my_env$a &lt;- value
  invisible(old)
}
</code></pre>
<p>Returning the old value from setter functions is a good pattern because 
it makes it easier to reset the previous value in conjunction with 
<code>on.exit()</code> (see more in <a href="#on-exit">on exit</a>).</p>
</li>
<li>
<p><strong>As a hashmap</strong>. A hashmap is a data structure that takes constant, O(1), 
time to find an object based on its name. Environments provide this 
behaviour by default, so can be used to simulate a hashmap. See the 
CRAN package hash for a complete development of this idea.</p>
</li>
</ul>
<h2 id="-"><code>&lt;&lt;-</code></h2>
<p>The ancestors of an environment have an important relationship to <code>&lt;&lt;-</code>. The regular assignment arrow, <code>&lt;-</code>, always creates a variable in the current environment. The deep assignment arrow, <code>&lt;&lt;-</code>, never creates a variable in the current environment, but instead modifies an existing variable found by walking up the parent environments.</p>
<pre><code class="language-r">x &lt;- 0
f &lt;- function() {
  x &lt;&lt;- 1
}
f()
x
#&gt; [1] 1
</code></pre>
<p>If <code>&lt;&lt;-</code> doesn't find an existing variable, it will create one in the global environment. This is usually undesirable, because global variables introduce non-obvious dependencies between functions. <code>&lt;&lt;-</code> is most often used in conjunction with a closure, as described in <a href="#closures">Closures</a>.</p>
<h3 id="exercises-4">Exercises</h3>
<ol>
<li>
<p>What does this function do? How does it differ from <code>&lt;&lt;-</code> and why
might you prefer it?</p>
<pre><code class="language-r">rebind &lt;- function(name, value, env = caller_env()) {
  if (identical(env, empty_env())) {
    stop(&quot;Can't find `&quot;, name, &quot;`&quot;, call. = FALSE)
  } else if (env_has(env, name)) {
    env_poke(env, name, value)
  } else {
    rebind(name, value, env_parent(env))
  }
}
rebind(&quot;a&quot;, 10)
#&gt; Error: Can't find `a`
a &lt;- 5
rebind(&quot;a&quot;, 10)
a
#&gt; [1] 10
</code></pre>
</li>
</ol>
<h2 id="env-answers">Quiz answers</h2>
<ol>
<li>
<p>There are four ways: every object in an environment must have a name;
order doesn't matter; environments have parents; environments have
reference semantics.</p>
</li>
<li>
<p>The parent of the global environment is the last package that you
loaded. The only environment that doesn't have a parent is the empty
environment.</p>
</li>
<li>
<p>The enclosing environment of a function is the environment where it
was created. It determines where a function looks for variables.</p>
</li>
<li>
<p>Use <code>caller_env()</code> or <code>parent.frame()</code>.</p>
</li>
<li>
<p><code>&lt;-</code> always creates a binding in the current environment; <code>&lt;&lt;-</code>
rebinds an existing name in a parent of the current environment.</p>
</li>
</ol>
<h3 id="term">term</h3>
<h5 id="global-environment">global environment :總體環境</h5>
<h5 id="package-environments">package environments</h5>
<h5 id="imports-environment">imports environment</h5>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>You might wonder why rlang has <code>env_poke()</code> instead of <code>env_set()</code>. 
This is for consistency: <code>_set()</code> functions return a modified copy; 
<code>_poke()</code> functions modify in place.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>NB: <code>?environment</code> uses frame in a different sense: &quot;Environments consist of a <em>frame</em>, or collection of named objects, and a pointer to an enclosing environment.&quot;. We avoid this sense of frame, which comes from S, because it's very specific and not widely used in base R. For example, the &quot;frame&quot; in <code>parent.frame()</code> is an execution context, not a collection of named objects.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
  </article><div class="collapse fs-6 pt-2" id="qnote-list">
    <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-white ">
        <span >
            
            <span class="fw-semibold">
                <button  class="btn btn-primary btn-inline" 
                   data-bs-toggle="collapse" data-bs-target="#qnote-edit"><span data-bs-toggle="tooltip" title="加入速記">加</span></button>
                <button id="qnote-gsave" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="存到硬碟"
                   onclick="qnSaveGoogle()">存</button>
                <label for="qnote-load" class="btn btn-primary btn-inline"  data-bs-toggle="tooltip" data-bs-placement="left" title="從檔案載入">載</label>   
                <input style="display:none" type="file" id="qnote-load" onchange="qnLoadGoogle(this)" />
                <button id="qnote-clear" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="清除全部速記"
                   onclick="cleanNotes()">清</button>
            </span>
        </span>
        <span class="fw-semibold collapse" id="qnote-edit"> 
            <input type="text" class="txtitle d-block w-100 h-25 " placeholder="抬頭" />
            <textarea class="txtBox  d-block w-100 h-75 " placeholder="本文"></textarea>
            
            <button id="qnote-add-item" onclick="addNote()" class="btn btn-primary">存</button> 
        </span>

    </div>
</div>

<link href="/blogR/css/quicknote.css?1641445339" rel="stylesheet">
<script src="/blogR/js/quicknote.js?1641445339"></script>
<div id="page-guide" class="bg-dark">  
  <a id="avator" href="/api/list" 
  class="btn btn-primary d-none"  data-bs-toggle="tooltip"  data-bs-placement="left" title=""><img style="padding:0px"class="img-fluid "></a>

  
    
          
          <a href="/blogR/rlang/10_00_dplyrbasic01.html" 
                   class="btn btn-primary" 
                   data-bs-toggle="tooltip" 
                   data-bs-placement="left" title=10.&#32;tidyr,&#32;dplyr&#32;basic>前</a>
                   
          
            <a href="/blogR/rlang/2_0_%E8%BC%B8%E5%87%BA%E8%BC%B8%E5%85%A5.html" 
               class="btn btn-primary" data-bs-toggle="tooltip" data-bs-placement="left" 
               title=2.0&#32;基本輸出輸入>後</a>            
          
          

  
<script src="/blogR/js/packhtml.js?1641445339"></script>    
<button class="btn btn-primary " onclick="packthis(this)"
data-bs-toggle="tooltip" data-bs-placement="left" title="打包成單一檔案">包</button>
<button class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="div#qnote-list">
  <span data-bs-toggle="tooltip" data-bs-placement="left" title="快速註記">速</span></button>
 
</div>
</div>


  <script src="/blogR/js/featherlight.min.js?1641445339"></script>
  <script src="/blogR/js/featherlight.gallery.min.js?1641445339"></script>
  <link href="/blogR/css/featherlight.min.css?1641445339" rel="stylesheet">
  <link href="/blogR/css/featherlight.gallery.min.css?1641445339" rel="stylesheet">
  
  <script src="/blogR/js/highlight.min.js"></script>
  
  <script src="/blogR/js/hugohelper.js?1641445339"></script>
  <link href="/blogR/css/rmd.css?1641445339" rel="stylesheet">
  <link href="/blogR/css/mystyle.css?1641445339" rel="stylesheet">    
  <script src='/blogR/js/variant.js?1641445339'></script>

<script>
  
   let idxfile = "https:\/\/airbone4.github.io\/blogR\/index.json"  
  
</script>
<script src='/blogR/js/localsearch.js?1641445339'></script>
  
      
          <script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script>
      
      <script>
          mermaid.initialize({ startOnLoad: true });
      </script>
  

  <script>
      MathJax = {
        tex: {
          inlineMath: [['\($', '$\)'], ['\\(', '\\)']],
          displayMath: [['$$','$$']  , ['\\[','\\]']] 
        },
        svg: {
          fontCache: 'global'
        }
      };
      
      
    
      </script>

      <script type="text/javascript" id="MathJax-script" async
      src='/blogR/js/tex-svg.js'>
      </script>



<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    jumpto = document.querySelector("#sidebar .active");
     if (jumpto!=null) jumpto.scrollIntoViewIfNeeded(true);
  
  });    
  
  </script>
</body>
</html>