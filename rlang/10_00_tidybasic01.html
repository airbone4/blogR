<!DOCTYPE html>
<html><head>
  <title>10. Tidy basic</title>  
      
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href='../images/favicon.ico'/>
      
    <link href="../css/atom-one-dark-reasonable.css?1635398991" rel="stylesheet">
    <link href="../css/syntax.css?1635398991" rel="stylesheet">
    <script src="../js/jquery-3.3.1.min.js?1635398991"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    
    <script src='../js/datatables.min.js'></script>    
    <link href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css" rel="stylesheet">    
    
    <link href="../css/fontawesome-all.min.css?1635398991" rel="stylesheet">
    
    <link href="../css/theme-mine.css?1635398991" rel="stylesheet">
    
    <link href="../css/theme.css?1635398991" rel="stylesheet">
    
    
    <link rel="stylesheet" href="../scss/notice.9533fa19b2db5be8a6e0b7e9e8e77f6ec4639fd599c204f25dfd15dca5c9e22c.css" integrity="sha256-lTP6GbLbW&#43;im4Lfp6Od/bsRjn9WZwgTyXf0V3KXJ4iw=">

    
  </head><body><div id="top-pane" class="navbar  fixed-top ">
  <div class="container-fluid">
  <span >
    <a  href='../' class="fs-5 accessory"><i class="fas fa-home"></i>R in Class</a>
    <span id="sidebar-toggle-span" class="fs-5"><i class="fas fa-align-justify"></i></span>
  </span><span >
      <span id="toc-menu">
    <label><i class="fas fa-list-alt" ></i> </label>    
<div id="variant-toc-content" >
    <div class="wrapper">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#tidy-basic-01">Tidy Basic 01</a>
      <ul>
        <li><a href="#spread-long-to-wide">spread :long to wide</a></li>
      </ul>
    </li>
    <li><a href="#dplyr">dplyr</a></li>
    <li><a href="#pipeline">pipeline</a>
      <ul>
        <li><a href="#basic-verbs">Basic verbs</a></li>
        <li><a href="#group-by">Group by</a></li>
        <li><a href="#summarize">summarize()</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    <hr class="p-0 m-0" />
    <div class="toa"></div>
</div>
</span>
<span class="fs-5 accessory" data-bs-toggle="tooltip" data-bs-placement="bottom" 
      title='最後修改October 19, 2021'>10. Tidy basic</span>
        
    

    </span>
  
  <span></span><span >
    <span >
    <label for="search-query" id="search-button"><i class="fas fa-search"></i></label>
    <input id="search-query" type="search" placeholder="搜尋" autocomplete="off">
</span>    
 
<div id="search-pane">
 <ol id="search-results"></ul>
</div>

    </span>
</div> 
</div>


<div id="content-wrapper"><nav id="sidebar">

  

    
    
    <ul class="nav flex-column topics" id="home-topics">
      
        
          
          

 


<li class="nav-item" data-bs-toggle="tooltip" title="Rlangs">
     

  <a class="nav-link" 
    href="../rlang.html"><i class="far fa-folder"></i>Rlangs  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_"  
  class="submenu collapse show" 
  data-bs-parent="#home-topics"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_0_requirement.html" data-bs-toggle="tooltip" title="1 Requirement">1 Requirement</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_1_%E7%B3%BB%E7%B5%B1.html" data-bs-toggle="tooltip" title="1.1 運作環境">1.1 運作環境</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_2_filesystem.html" data-bs-toggle="tooltip" title="1.2 檔案系統">1.2 檔案系統</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_3_%E5%9F%B7%E8%A1%8C.html" data-bs-toggle="tooltip" title="1.3 執行">1.3 執行</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_4_rpackages.html" data-bs-toggle="tooltip" title="1.4 R Package">1.4 R Package</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_5_%E7%B7%A8%E7%A2%BC.html" data-bs-toggle="tooltip" title="1.5 編碼">1.5 編碼</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/2_0_%E8%BC%B8%E5%87%BA%E8%BC%B8%E5%85%A5.html" data-bs-toggle="tooltip" title="2.0 基本輸出輸入">2.0 基本輸出輸入</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/2_1_%E8%AE%80%E6%AA%94%E5%AF%AB%E6%AA%94.html" data-bs-toggle="tooltip" title="2.1 讀檔寫檔">2.1 讀檔寫檔</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/2_2_data_explorer.html" data-bs-toggle="tooltip" title="2.2 資料探索">2.2 資料探索</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/2_3_data_explorer.html" data-bs-toggle="tooltip" title="2.3 data explorer">2.3 data explorer</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/3_quickview1.html" data-bs-toggle="tooltip" title="3. Quick view 1">3. Quick view 1</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/3_01_regular_expression.html" data-bs-toggle="tooltip" title="3.1 Regular expression syntax">3.1 Regular expression syntax</a></li>
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_1_1_type_%E5%9F%BA%E6%9C%AC.html" data-bs-toggle="tooltip" title="4.1 基本">4.1 基本</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_1_2_type%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" title="4.1.2 練習">4.1.2 練習</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_2_type_vector.html" data-bs-toggle="tooltip" title="4.2 向量">4.2 向量</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_3_type_matrix.html" data-bs-toggle="tooltip" title="4.3 矩陣">4.3 矩陣</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_4_type_list.html" data-bs-toggle="tooltip" title="4.4 串列 list">4.4 串列 list</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_11_json.html" data-bs-toggle="tooltip" title="4.4.1 json">4.4.1 json</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_5_type_string_function.html" data-bs-toggle="tooltip" title="4.5 字串">4.5 字串</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_6_topic_dataframe.html" data-bs-toggle="tooltip" title="4.6 資料集 data frame">4.6 資料集 data frame</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_7_type_more.html" data-bs-toggle="tooltip" title="4.7 data.frame, table, data,table">4.7 data.frame, table, data,table</a></li>
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/5_objectbasic.html" data-bs-toggle="tooltip" title="5 R的物件相關概念">5 R的物件相關概念</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/5_1_%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91s3.html" data-bs-toggle="tooltip" title="5.1 物件導向S3">5.1 物件導向S3</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/6_1_programming.html" data-bs-toggle="tooltip" title="6.1 Programming basic">6.1 Programming basic</a></li>
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/6_3_apply_family.html" data-bs-toggle="tooltip" title="6.3 function - apply family">6.3 function - apply family</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/7_1_function.html" data-bs-toggle="tooltip" title="7.1 R 函數的基本撰寫">7.1 R 函數的基本撰寫</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/7_2_function.html" data-bs-toggle="tooltip" title="7.2 更多R函數">7.2 更多R函數</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/7_3_function.html" data-bs-toggle="tooltip" title="7.3 R 函數定義的幾種分類">7.3 R 函數定義的幾種分類</a></li>
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/9_1_plot.html" data-bs-toggle="tooltip" title="9.1 基本繪圖">9.1 基本繪圖</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/9_2_%E5%A4%9A%E5%9C%96%E7%96%8A%E5%9C%96.html" data-bs-toggle="tooltip" title="9.2 多圖疊圖">9.2 多圖疊圖</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/9_3_plot.html" data-bs-toggle="tooltip" title="9.3 Plot more">9.3 Plot more</a></li>
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/11_00_sampling.html" data-bs-toggle="tooltip" title="11. sampling">11. sampling</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/11_environments.html" data-bs-toggle="tooltip" title="11 Environments">11 Environments</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/13_0_eco_01_intro.html" data-bs-toggle="tooltip" title="13. Econometrics">13. Econometrics</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/14_00_sim_1.html" data-bs-toggle="tooltip" title="14. simulation 1">14. simulation 1</a></li>
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/xxx.html" data-bs-toggle="tooltip" title="xxx">xxx</a></li>
    
  
    
  <li>

 


<li class="nav-item" data-bs-toggle="tooltip" title="暫時">
     

  <a class="nav-link" 
    href="../rlang/demo.html"><i class="far fa-folder"></i>暫時  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f03d3d24b564dd9c39af6eb86300021f" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_f03d3d24b564dd9c39af6eb86300021f"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_"> 
    

  
  
  
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/demo/citation.html" data-bs-toggle="tooltip" title="引用">引用</a></li>
    </ul>
  

</li>   
     
  
</li>
    
  <li>

 


<li class="nav-item" data-bs-toggle="tooltip" title="練習用">
     

  <a class="nav-link" 
    href="../rlang/hw.html"><i class="far fa-folder"></i>練習用  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_b4809f6375b9dda8660e4938c2644e82" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_b4809f6375b9dda8660e4938c2644e82"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/hw_basic.html" data-bs-toggle="tooltip" title="assignment-1">assignment-1</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/hw_regexp.html" data-bs-toggle="tooltip" title="regexpr">regexpr</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/hw_filesystem.html" data-bs-toggle="tooltip" title="檔案系統">檔案系統</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/dataset_class.html" data-bs-toggle="tooltip" title="資料集">資料集</a></li>
    </ul>
  

</li>   
     
  
</li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/resources.html" data-bs-toggle="tooltip" title="練習相關檔案">練習相關檔案</a></li>
    </ul>
  

</li>   
     
  

        
          
          

 


<li class="nav-item" data-bs-toggle="tooltip" title="基礎計量">
     

  <a class="nav-link" 
    href="../econometrics.html"><i class="far fa-folder"></i>基礎計量  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_c59a6b16a979dae063e00e4a916e3284" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_c59a6b16a979dae063e00e4a916e3284"  
  class="submenu collapse" 
  data-bs-parent="#home-topics"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../econometrics/1_t%E6%AA%A2%E5%AE%9A.html" data-bs-toggle="tooltip" title="1.0 t檢定">1.0 t檢定</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../econometrics/2_anova.html" data-bs-toggle="tooltip" title="2. ANOVA">2. ANOVA</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../econometrics/a_a_%E8%B3%87%E6%96%99%E8%99%95%E7%90%86.html" data-bs-toggle="tooltip" title="A.a 資料處理">A.a 資料處理</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../econometrics/a_b_mpg%E7%82%BA%E4%BE%8B%E7%9A%84ggplot.html" data-bs-toggle="tooltip" title="A.b mpg為例的ggplot">A.b mpg為例的ggplot</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../econometrics/lmm.html" data-bs-toggle="tooltip" title="lmm">lmm</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../econometrics/statatest.html" data-bs-toggle="tooltip" title="statatest">statatest</a></li>
    
  
    </ul>
  

</li>   
     
  

        
          
          

 


<li class="nav-item" data-bs-toggle="tooltip" title="專題">
     

  <a class="nav-link" 
    href="../topic.html"><i class="far fa-folder"></i>專題  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f7b6d4231ab239a316b7f2d9edf32817" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_f7b6d4231ab239a316b7f2d9edf32817"  
  class="submenu collapse" 
  data-bs-parent="#home-topics"> 
    

  
  
  
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/interesting.html" data-bs-toggle="tooltip" title="interesting">interesting</a></li>
    
  
    
  
    
  <li>

 


<li class="nav-item" data-bs-toggle="tooltip" title="實驗">
     

  <a class="nav-link" 
    href="../topic/simulation.html"><i class="far fa-folder"></i>實驗  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_e617bdc52da54290f99855ac9d5037aa" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_e617bdc52da54290f99855ac9d5037aa"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_f7b6d4231ab239a316b7f2d9edf32817"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/simulation/bays1.html" data-bs-toggle="tooltip" title="bays1">bays1</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/simulation/simulation_1.html" data-bs-toggle="tooltip" title="simulation_1">simulation_1</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/simulation/2_1_%E9%9A%A8%E6%A9%9F%E8%AE%8A%E6%95%B8.html" data-bs-toggle="tooltip" title="2.1 隨機變數">2.1 隨機變數</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/simulation/2_1_%E4%BA%82%E6%95%B8%E5%87%BD%E6%95%B8%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" title="2.1.1 亂數函數練習">2.1.1 亂數函數練習</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/simulation/mc_%E5%9F%BA%E6%9C%AC.html" data-bs-toggle="tooltip" title="MC_基本">MC_基本</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/simulation/poisson%E5%88%86%E9%85%8D.html" data-bs-toggle="tooltip" title="Poisson分配">Poisson分配</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/simulation/central.html" data-bs-toggle="tooltip" title="中央">中央</a></li>
    </ul>
  

</li>   
     
  
</li>
    
  
    </ul>
  

</li>   
     
  

          
        
  </ul> 

    
    

    <hr/>
    <section id="footer">
      最近3篇<br/><ul><li><a href="../rlang/4_7_type_more.html"> <i class="far fa-clock" ></i>4.7 data.frame, table, data,table[2021-10-28 PM 01:29]</a></li><li><a href="../rlang/4_6_topic_dataframe.html"> <i class="far fa-clock" ></i>4.6 資料集 data frame[2021-10-28 PM 12:41]</a></li><li><a href="../rlang/2_3_data_explorer.html"> <i class="far fa-clock" ></i>2.3 data explorer[2021-10-28 PM 12:30]</a></li></ul>
    </section>
  
</nav><article class="article mx-2 mt-3" id="body-inner">
    <pre><code class="language-r?preclass=.ms-5.w-75">需要安裝babynames,ggplot2
</code></pre>
<h2 id="tidy-basic-01">Tidy Basic 01</h2>
<pre><code class="language-{r　warning=FALSE}">require(tidyr)
require(dplyr) # data_frame
</code></pre>
<p>From <a href="http://stackoverflow.com/questions/1181060">http://stackoverflow.com/questions/1181060</a></p>
<pre><code class="language-r">require(tidyr)
## 載入需要的套件：tidyr
require(dplyr) # data_frame
## 載入需要的套件：dplyr
## 
## 載入套件：'dplyr'
## 下列物件被遮斷自 'package:stats':
## 
##     filter, lag
## 下列物件被遮斷自 'package:base':
## 
##     intersect, setdiff, setequal, union
stocks &lt;- data_frame(
  time = as.Date('2009-01-01') + 0:9,
  X = rnorm(10, 0, 1),
  Y = rnorm(10, 0, 2),
  Z = rnorm(10, 0, 4)
)
## Warning: `data_frame()` was deprecated in tibble 1.1.0.
## Please use `tibble()` instead.
dset1 &lt;- head(stocks)
knitr::kable(dset1, format = &quot;html&quot;)
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> time </th>
   <th style="text-align:right;"> X </th>
   <th style="text-align:right;"> Y </th>
   <th style="text-align:right;"> Z </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2009-01-01 </td>
   <td style="text-align:right;"> 1.7466618 </td>
   <td style="text-align:right;"> -3.2970526 </td>
   <td style="text-align:right;"> -0.5940520 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-02 </td>
   <td style="text-align:right;"> 1.9982107 </td>
   <td style="text-align:right;"> -0.4771810 </td>
   <td style="text-align:right;"> 4.5655655 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-03 </td>
   <td style="text-align:right;"> -1.2540109 </td>
   <td style="text-align:right;"> -3.4423611 </td>
   <td style="text-align:right;"> -1.7403562 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-04 </td>
   <td style="text-align:right;"> 0.9000006 </td>
   <td style="text-align:right;"> 3.0270732 </td>
   <td style="text-align:right;"> 3.4421530 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-05 </td>
   <td style="text-align:right;"> 0.3126585 </td>
   <td style="text-align:right;"> -0.4567188 </td>
   <td style="text-align:right;"> 0.5428854 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-06 </td>
   <td style="text-align:right;"> 0.3388131 </td>
   <td style="text-align:right;"> -0.2354290 </td>
   <td style="text-align:right;"> 0.4567758 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">gather(stocks, stock, price, -time)
## # A tibble: 30 x 3
##    time       stock   price
##    &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;
##  1 2009-01-01 X      1.75  
##  2 2009-01-02 X      2.00  
##  3 2009-01-03 X     -1.25  
##  4 2009-01-04 X      0.900 
##  5 2009-01-05 X      0.313 
##  6 2009-01-06 X      0.339 
##  7 2009-01-07 X     -0.0629
##  8 2009-01-08 X      0.820 
##  9 2009-01-09 X      0.597 
## 10 2009-01-10 X      1.45  
## # ... with 20 more rows
stocks %&gt;% gather(stock, price, -time)
## # A tibble: 30 x 3
##    time       stock   price
##    &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;
##  1 2009-01-01 X      1.75  
##  2 2009-01-02 X      2.00  
##  3 2009-01-03 X     -1.25  
##  4 2009-01-04 X      0.900 
##  5 2009-01-05 X      0.313 
##  6 2009-01-06 X      0.339 
##  7 2009-01-07 X     -0.0629
##  8 2009-01-08 X      0.820 
##  9 2009-01-09 X      0.597 
## 10 2009-01-10 X      1.45  
## # ... with 20 more rows
dset1 &lt;- head(stocks)
knitr::kable(dset1, format = &quot;html&quot;)
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> time </th>
   <th style="text-align:right;"> X </th>
   <th style="text-align:right;"> Y </th>
   <th style="text-align:right;"> Z </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2009-01-01 </td>
   <td style="text-align:right;"> 1.7466618 </td>
   <td style="text-align:right;"> -3.2970526 </td>
   <td style="text-align:right;"> -0.5940520 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-02 </td>
   <td style="text-align:right;"> 1.9982107 </td>
   <td style="text-align:right;"> -0.4771810 </td>
   <td style="text-align:right;"> 4.5655655 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-03 </td>
   <td style="text-align:right;"> -1.2540109 </td>
   <td style="text-align:right;"> -3.4423611 </td>
   <td style="text-align:right;"> -1.7403562 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-04 </td>
   <td style="text-align:right;"> 0.9000006 </td>
   <td style="text-align:right;"> 3.0270732 </td>
   <td style="text-align:right;"> 3.4421530 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-05 </td>
   <td style="text-align:right;"> 0.3126585 </td>
   <td style="text-align:right;"> -0.4567188 </td>
   <td style="text-align:right;"> 0.5428854 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-06 </td>
   <td style="text-align:right;"> 0.3388131 </td>
   <td style="text-align:right;"> -0.2354290 </td>
   <td style="text-align:right;"> 0.4567758 </td>
  </tr>
</tbody>
</table>
<p>設定css</p>
<pre><code class="language-r">writeLines(&quot;td, th { padding : 6px } th { background-color : brown ; color : white; border : 1px solid white; } td { color : brown ; border : 1px solid brown }&quot;, con = &quot;tableStyle.css&quot;)
</code></pre>
<pre><code class="language-r">stocks &lt;- data_frame(
  time = as.Date('2009-01-01') + 0:9,
  X = rnorm(10, 0, 1),
  Y = rnorm(10, 0, 2),
  Z = rnorm(10, 0, 4)
)
dset1 &lt;- head(stocks)
knitr::kable(dset1, format = &quot;html&quot;)
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> time </th>
   <th style="text-align:right;"> X </th>
   <th style="text-align:right;"> Y </th>
   <th style="text-align:right;"> Z </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2009-01-01 </td>
   <td style="text-align:right;"> -1.5473958 </td>
   <td style="text-align:right;"> -2.6653152 </td>
   <td style="text-align:right;"> 5.0664180 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-02 </td>
   <td style="text-align:right;"> -1.6783992 </td>
   <td style="text-align:right;"> 3.9679772 </td>
   <td style="text-align:right;"> 2.4829285 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-03 </td>
   <td style="text-align:right;"> -0.0171502 </td>
   <td style="text-align:right;"> 3.2551838 </td>
   <td style="text-align:right;"> 4.5475526 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-04 </td>
   <td style="text-align:right;"> -0.3322107 </td>
   <td style="text-align:right;"> -3.2740602 </td>
   <td style="text-align:right;"> 0.1281389 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-05 </td>
   <td style="text-align:right;"> 0.9772671 </td>
   <td style="text-align:right;"> 0.4093655 </td>
   <td style="text-align:right;"> -3.7127948 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-06 </td>
   <td style="text-align:right;"> -1.7022721 </td>
   <td style="text-align:right;"> -3.2012991 </td>
   <td style="text-align:right;"> 5.0255970 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">
demo&lt;-gather(stocks, stock, price, -time)

dset1 &lt;- head(demo)
knitr::kable(dset1, format = &quot;html&quot;)
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> time </th>
   <th style="text-align:left;"> stock </th>
   <th style="text-align:right;"> price </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2009-01-01 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> -1.5473958 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-02 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> -1.6783992 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-03 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> -0.0171502 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-04 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> -0.3322107 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-05 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> 0.9772671 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-06 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> -1.7022721 </td>
  </tr>
</tbody>
</table>
## long and wide data
### gather: wide to long
<pre><code class="language-r">wide &lt;- data_frame(
  time = as.Date('2009-01-01') + 0:9,
  X = rnorm(10, 0, 1),
  Y = rnorm(10, 0, 2),
  Z = rnorm(10, 0, 4)
)

long &lt;- gather(wide,stock,price,-time)
head(long)
## # A tibble: 6 x 3
##   time       stock  price
##   &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;
## 1 2009-01-01 X      2.83 
## 2 2009-01-02 X     -2.18 
## 3 2009-01-03 X     -0.261
## 4 2009-01-04 X      0.397
## 5 2009-01-05 X     -0.225
## 6 2009-01-06 X     -0.617
</code></pre>
<h3 id="spread-long-to-wide">spread :long to wide</h3>
<pre><code class="language-r">wide2 &lt;-spread(long,stock,price)
head(wide2)
## # A tibble: 6 x 4
##   time            X       Y      Z
##   &lt;date&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 2009-01-01  2.83   0.361   2.04 
## 2 2009-01-02 -2.18  -2.02    1.50 
## 3 2009-01-03 -0.261  6.31    2.46 
## 4 2009-01-04  0.397  1.64    0.158
## 5 2009-01-05 -0.225 -0.0264 -0.610
## 6 2009-01-06 -0.617  2.21   -1.27
</code></pre>
<p>更多參考:
<a href="http://www.cookbook-r.com/Manipulating_data/Converting_data_between_wide_and_long_format/">cookbook for R</a></p>
<h2 id="dplyr">dplyr</h2>
<p>函數名 功能</p>
<ul>
<li>
<p>row_number 排序,如果數值一樣,則靠前出現的元素排名在前,例如(3,3) 則 1,2</p>
</li>
<li>
<p>min_rank 排序,如果數值一樣,則都是同一等級，但是，佔用下一名次。例如</p>
<pre><code class="language-r">data&lt;-c(3,3,4)  
data
## [1] 3 3 4
min_rank(data)
## [1] 1 1 3
</code></pre>
</li>
<li>
<p>dense_rank 排序,如果數值一樣,則都是同一等級，但是，<code>不</code>佔用下一名次</p>
<pre><code class="language-r">data&lt;-c(3,3,4)  
data
## [1] 3 3 4
dense_rank(data)
## [1] 1 1 2
</code></pre>
</li>
<li>
<p>percent_rank 按百分比的排名</p>
<pre><code class="language-r">percent_rank = (min_rank(x) - 1)/(sum(!is.na(x)) - 1)   
</code></pre>
</li>
<li>
<p>cume_dist 累計分佈</p>
</li>
<li>
<p>ntile : floor(n * (row_number(x) - 1)/len + 1)</p>
<pre><code class="language-r">data&lt;-round(runif(10)*10)
pr&lt;-percent_rank(data)
cd&lt;-cume_dist(data)
mr&lt;-min_rank(data)
df&lt;-data.frame(data,pr,mr,cd)
arrange(df,data)
##    data        pr mr  cd
## 1     3 0.0000000  1 0.1
## 2     4 0.1111111  2 0.4
## 3     4 0.1111111  2 0.4
## 4     4 0.1111111  2 0.4
## 5     5 0.4444444  5 0.6
## 6     5 0.4444444  5 0.6
## 7     7 0.6666667  7 0.7
## 8     8 0.7777778  8 0.9
## 9     8 0.7777778  8 0.9
## 10    9 1.0000000 10 1.0
</code></pre>
</li>
</ul>
<p>note:</p>
<p>(2,3,3,3,3,4,5,6,6,9)</p>
<table>
<thead>
<tr>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>4</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<div class="notices m-auto w-75">
    <div class="info">
        arrange(dataframe, col1, col2, col3)<br>
vs.<br>
dataframe[order(dataframe$col1, dataframe$col2, dataframe$col3), ]
vs.<br>
with(dataframe, dataframe[order(col1, col2, col3), ])
    </div>
</div>

<div class="notices m-auto w-75">
    <div class="info">
        <p>想要由大到小,例如分數等級</p>
<pre><code class="language-r">data
##  [1] 5 7 9 4 5 8 4 3 8 4
row_number(desc(data))
##  [1]  5  4  1  7  6  2  8 10  3  9
</code></pre>

    </div>
</div>

<div class="notices m-auto w-75">
    <div class="info">
        <p>Percentile
The nth percentile of an observation variable is the value that cuts off the first n percent of the data values when it is sorted in ascending order.</p>
<p>Problem
Find the 32nd, 57th and 98th percentiles of runiform(200).</p>
<pre><code class="language-r">data&lt;-runif(200) 
quantile(data, c(.32, .57, .98)) 

</code></pre>

    </div>
</div>

<h2 id="pipeline">pipeline</h2>
<pre><code class="language-r">library(babynames)
library(dplyr)
babynames #<!--html_preserve--><div data-nopre class="expand">
    <div data-nopre class="expand-label" onclick="vexpand(this)">
        <i data-nopre style="font-size:x-small;color:yellow" class="fa fa-chevron-right"></i>
        <span data-nopre >展開</span>
    </div><!--html_preserve--><div data-nopre class="expand-content" style="overflow-x:auto"><!--html_preserve--><h2 id="-a-tibble-1924665-x-5"># A tibble: 1,924,665 x 5</h2>
<h2 id="year-sex---name----------n---prop">year sex   name          n   prop</h2>
<h2 id="dbl-chr-chr-----int--dbl"><dbl> <chr> <chr>     <int>  <dbl></h2>
<h2 id="1--1880-f-----mary-------7065-00724">1  1880 F     Mary       7065 0.0724</h2>
<h2 id="2--1880-f-----anna-------2604-00267">2  1880 F     Anna       2604 0.0267</h2>
<h2 id="3--1880-f-----emma-------2003-00205">3  1880 F     Emma       2003 0.0205</h2>
<h2 id="4--1880-f-----elizabeth--1939-00199">4  1880 F     Elizabeth  1939 0.0199</h2>
<h2 id="5--1880-f-----minnie-----1746-00179">5  1880 F     Minnie     1746 0.0179</h2>
<h2 id="6--1880-f-----margaret---1578-00162">6  1880 F     Margaret   1578 0.0162</h2>
<h2 id="7--1880-f-----ida--------1472-00151">7  1880 F     Ida        1472 0.0151</h2>
<h2 id="8--1880-f-----alice------1414-00145">8  1880 F     Alice      1414 0.0145</h2>
<h2 id="9--1880-f-----bertha-----1320-00135">9  1880 F     Bertha     1320 0.0135</h2>
<h2 id="10--1880-f-----sarah------1288-00132">10  1880 F     Sarah      1288 0.0132</h2>
<h2 id="--with-1924655-more-rows"># ... with 1,924,655 more rows</h2>
<p>#<!--html_preserve--></div><!--/html_preserve--><!--html_preserve--></div><!--/html_preserve-->
</code></pre>
<h3 id="basic-verbs">Basic verbs</h3>
<pre><code class="language-r">babynames %&gt;% select(-prop)
## # A tibble: 1,924,665 x 4
##     year sex   name          n
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;
##  1  1880 F     Mary       7065
##  2  1880 F     Anna       2604
##  3  1880 F     Emma       2003
##  4  1880 F     Elizabeth  1939
##  5  1880 F     Minnie     1746
##  6  1880 F     Margaret   1578
##  7  1880 F     Ida        1472
##  8  1880 F     Alice      1414
##  9  1880 F     Bertha     1320
## 10  1880 F     Sarah      1288
## # ... with 1,924,655 more rows
babynames %&gt;% select(year:n)
## # A tibble: 1,924,665 x 4
##     year sex   name          n
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;
##  1  1880 F     Mary       7065
##  2  1880 F     Anna       2604
##  3  1880 F     Emma       2003
##  4  1880 F     Elizabeth  1939
##  5  1880 F     Minnie     1746
##  6  1880 F     Margaret   1578
##  7  1880 F     Ida        1472
##  8  1880 F     Alice      1414
##  9  1880 F     Bertha     1320
## 10  1880 F     Sarah      1288
## # ... with 1,924,655 more rows
# starts_with(), ends_with(), contains()

babynames %&gt;% filter(name == &quot;Hadley&quot;)
## # A tibble: 163 x 5
##     year sex   name       n      prop
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;     &lt;dbl&gt;
##  1  1906 M     Hadley     6 0.0000416
##  2  1908 M     Hadley    16 0.0000962
##  3  1909 M     Hadley    14 0.0000792
##  4  1910 M     Hadley     5 0.0000240
##  5  1911 M     Hadley     9 0.0000373
##  6  1912 M     Hadley    11 0.0000244
##  7  1913 M     Hadley    10 0.0000186
##  8  1914 M     Hadley    15 0.0000220
##  9  1915 M     Hadley    14 0.0000159
## 10  1916 M     Hadley    14 0.0000152
## # ... with 153 more rows
babynames %&gt;% filter(year == 1900, sex == &quot;F&quot;)
## # A tibble: 2,224 x 5
##     year sex   name          n   prop
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;
##  1  1900 F     Mary      16706 0.0526
##  2  1900 F     Helen      6343 0.0200
##  3  1900 F     Anna       6114 0.0192
##  4  1900 F     Margaret   5304 0.0167
##  5  1900 F     Ruth       4765 0.0150
##  6  1900 F     Elizabeth  4096 0.0129
##  7  1900 F     Florence   3920 0.0123
##  8  1900 F     Ethel      3896 0.0123
##  9  1900 F     Marie      3856 0.0121
## 10  1900 F     Lillian    3414 0.0107
## # ... with 2,214 more rows
babynames %&gt;% filter(year == 2013, sex == &quot;F&quot;)
## # A tibble: 19,231 x 5
##     year sex   name          n    prop
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;
##  1  2013 F     Sophia    21213 0.0110 
##  2  2013 F     Emma      20936 0.0109 
##  3  2013 F     Olivia    18414 0.00957
##  4  2013 F     Isabella  17631 0.00916
##  5  2013 F     Ava       15249 0.00793
##  6  2013 F     Mia       13147 0.00683
##  7  2013 F     Emily     13124 0.00682
##  8  2013 F     Abigail   12405 0.00645
##  9  2013 F     Madison   10591 0.00551
## 10  2013 F     Elizabeth  9448 0.00491
## # ... with 19,221 more rows

babynames %&gt;%
  mutate(
    first = tolower(substr(name, 1, 1)),
    last = substr(name, nchar(name), nchar(name))
  )
## # A tibble: 1,924,665 x 7
##     year sex   name          n   prop first last 
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
##  1  1880 F     Mary       7065 0.0724 m     y    
##  2  1880 F     Anna       2604 0.0267 a     a    
##  3  1880 F     Emma       2003 0.0205 e     a    
##  4  1880 F     Elizabeth  1939 0.0199 e     h    
##  5  1880 F     Minnie     1746 0.0179 m     e    
##  6  1880 F     Margaret   1578 0.0162 m     t    
##  7  1880 F     Ida        1472 0.0151 i     a    
##  8  1880 F     Alice      1414 0.0145 a     e    
##  9  1880 F     Bertha     1320 0.0135 b     a    
## 10  1880 F     Sarah      1288 0.0132 s     h    
## # ... with 1,924,655 more rows

babynames %&gt;%
  arrange(desc(prop))
## # A tibble: 1,924,665 x 5
##     year sex   name        n   prop
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt;
##  1  1880 M     John     9655 0.0815
##  2  1881 M     John     8769 0.0810
##  3  1880 M     William  9532 0.0805
##  4  1883 M     John     8894 0.0791
##  5  1881 M     William  8524 0.0787
##  6  1882 M     John     9557 0.0783
##  7  1884 M     John     9388 0.0765
##  8  1882 M     William  9298 0.0762
##  9  1886 M     John     9026 0.0758
## 10  1885 M     John     8756 0.0755
## # ... with 1,924,655 more rows

babynames %&gt;%
  summarise(n = sum(n))
## # A tibble: 1 x 1
##           n
##       &lt;int&gt;
## 1 348120517
</code></pre>
<h3 id="group-by">Group by</h3>
<p>分組指令不會影響到原來的資料</p>
<pre><code class="language-r">head(mtcars)
##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
str(mtcars)
## 'data.frame':	32 obs. of  11 variables:
##  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
##  $ disp: num  160 160 108 258 360 ...
##  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
##  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
##  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
##  $ qsec: num  16.5 17 18.6 19.4 17 ...
##  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
##  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
##  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
##  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...
by_cyl &lt;- mtcars %&gt;% group_by(cyl)
head(by_cyl)
## # A tibble: 6 x 11
## # Groups:   cyl [3]
##     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  21       6   160   110  3.9   2.62  16.5     0     1     4     4
## 2  21       6   160   110  3.9   2.88  17.0     0     1     4     4
## 3  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1
## 4  21.4     6   258   110  3.08  3.22  19.4     1     0     3     1
## 5  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2
## 6  18.1     6   225   105  2.76  3.46  20.2     1     0     3     1
str(by_cyl)
## grouped_df [32 x 11] (S3: grouped_df/tbl_df/tbl/data.frame)
##  $ mpg : num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##  $ cyl : num [1:32] 6 6 4 6 8 6 8 4 4 6 ...
##  $ disp: num [1:32] 160 160 108 258 360 ...
##  $ hp  : num [1:32] 110 110 93 110 175 105 245 62 95 123 ...
##  $ drat: num [1:32] 3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
##  $ wt  : num [1:32] 2.62 2.88 2.32 3.21 3.44 ...
##  $ qsec: num [1:32] 16.5 17 18.6 19.4 17 ...
##  $ vs  : num [1:32] 0 0 1 1 0 1 0 1 1 1 ...
##  $ am  : num [1:32] 1 1 1 0 0 0 0 0 0 0 ...
##  $ gear: num [1:32] 4 4 4 3 3 3 3 4 4 4 ...
##  $ carb: num [1:32] 4 4 1 1 2 1 4 2 2 4 ...
##  - attr(*, &quot;groups&quot;)= tibble [3 x 2] (S3: tbl_df/tbl/data.frame)
##   ..$ cyl  : num [1:3] 4 6 8
##   ..$ .rows: list&lt;int&gt; [1:3] 
##   .. ..$ : int [1:11] 3 8 9 18 19 20 21 26 27 28 ...
##   .. ..$ : int [1:7] 1 2 4 6 10 11 30
##   .. ..$ : int [1:14] 5 7 12 13 14 15 16 17 22 23 ...
##   .. ..@ ptype: int(0) 
##   ..- attr(*, &quot;.drop&quot;)= logi TRUE
</code></pre>
<p>但是分組結果會影響其他dplyr指令的計算結果:</p>
<pre><code class="language-r">by_cyl %&gt;% summarise(
  disp = mean(disp),
  hp = mean(hp)
)
## # A tibble: 3 x 3
##     cyl  disp    hp
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     4  105.  82.6
## 2     6  183. 122. 
## 3     8  353. 209.
by_cyl %&gt;% filter(disp == max(disp))
## # A tibble: 3 x 11
## # Groups:   cyl [3]
##     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
## 2  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
## 3  10.4     8  472    205  2.93  5.25  18.0     0     0     3     4
</code></pre>
<h3 id="summarize">summarize()</h3>
<p>What other summary functions can we use inside the summarize() verb? Any function in R that takes a vector of values and returns just one. Here are just a few:</p>
<ul>
<li>mean(): the mean AKA the average</li>
<li>sd(): the standard deviation, which is a measure of spread</li>
<li>min() and max(): the minimum and maximum values respectively</li>
<li>IQR(): Interquartile range</li>
<li>sum(): the sum</li>
<li>n(): a count of the number of rows/observations in each group. This particular summary function will make more sense when group_by() is covered in Section 5.5.</li>
</ul>
<h4 id="實驗-pipeline-vs-no-pipeline">實驗 pipeline vs no pipeline</h4>
<p>產生資料</p>
<pre><code class="language-r">year=c(1990,	1991,	1990,	1991,	1990,	1991,	1990,	1991,	1990,	1991) 
sex=c(&quot;f&quot;,	&quot;f&quot;,	&quot;f&quot;,	&quot;f&quot;,	&quot;f&quot;,	&quot;m&quot;,	&quot;m&quot;,	&quot;m&quot;,	&quot;m&quot;,	&quot;m&quot;)
#value=c(1,	2,	3,	4,	5,	1,	2,	3,	4,	5)
value=c(1,	2,	3,	4,	5,	6,	7,	8,	9,	10)
df&lt;-data.frame(sex,year,value)
head(df)
##   sex year value
## 1   f 1990     1
## 2   f 1991     2
## 3   f 1990     3
## 4   f 1991     4
## 5   f 1990     5
## 6   m 1991     6
</code></pre>
<h4 id="不用-pipeline">不用 pipeline</h4>
<pre><code class="language-r">
df&lt;-group_by(df,sex)
ndf&lt;-mutate(df,rank=min_rank(value))
arrange(ndf,sex)
## # A tibble: 10 x 4
## # Groups:   sex [2]
##    sex    year value  rank
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
##  1 f      1990     1     1
##  2 f      1991     2     2
##  3 f      1990     3     3
##  4 f      1991     4     4
##  5 f      1990     5     5
##  6 m      1991     6     1
##  7 m      1990     7     2
##  8 m      1991     8     3
##  9 m      1990     9     4
## 10 m      1991    10     5
</code></pre>
<h4 id="使用-pipeline">使用 pipeline</h4>
<pre><code class="language-r">ndf&lt;-df %&gt;%
  group_by(sex) %&gt;%
  mutate(rank = min_rank(value)) 

arrange(ndf,sex)
## # A tibble: 10 x 4
## # Groups:   sex [2]
##    sex    year value  rank
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
##  1 f      1990     1     1
##  2 f      1991     2     2
##  3 f      1990     3     3
##  4 f      1991     4     4
##  5 f      1990     5     5
##  6 m      1991     6     1
##  7 m      1990     7     2
##  8 m      1991     8     3
##  9 m      1990     9     4
## 10 m      1991    10     5
</code></pre>
<p>問題:</p>
<ol>
<li>
<p>如何知道min-rank(value)中的value 是全局或是欄位?
hint: rm(value)</p>
</li>
<li>
<p>會出現甚麼結果</p>
<p>df %&gt;%
group_by(sex) %&gt;%str()</p>
<pre><code class="language-r">nb &lt;-babynames %&gt;%
  group_by(name)
</code></pre>
<pre><code class="language-r">babynames %&gt;%
  group_by(name) %&gt;%
  summarise(n = sum(n))
## # A tibble: 97,310 x 2
##    name          n
##    &lt;chr&gt;     &lt;int&gt;
##  1 Aaban       107
##  2 Aabha        35
##  3 Aabid        10
##  4 Aabir         5
##  5 Aabriella    32
##  6 Aada          5
##  7 Aadam       254
##  8 Aadan       130
##  9 Aadarsh     199
## 10 Aaden      4658
## # ... with 97,300 more rows

babynames %&gt;%
  filter(name %in% c(&quot;John&quot;, &quot;Mary&quot;, &quot;William&quot;)) %&gt;%
  group_by(name, sex) %&gt;%
  summarise(n = sum(n))
## `summarise()` has grouped output by 'name'. You can override using the `.groups` argument.
## # A tibble: 6 x 3
## # Groups:   name [3]
##   name    sex         n
##   &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;
## 1 John    F       21676
## 2 John    M     5115466
## 3 Mary    F     4123200
## 4 Mary    M       15160
## 5 William F       15949
## 6 William M     4102604

babynames %&gt;%
  group_by(year, sex) %&gt;%
  mutate(rank = min_rank(desc(n))) %&gt;%
  tail()
## # A tibble: 6 x 6
## # Groups:   year, sex [1]
##    year sex   name       n       prop  rank
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;      &lt;dbl&gt; &lt;int&gt;
## 1  2017 M     Zyhier     5 0.00000255 12171
## 2  2017 M     Zykai      5 0.00000255 12171
## 3  2017 M     Zykeem     5 0.00000255 12171
## 4  2017 M     Zylin      5 0.00000255 12171
## 5  2017 M     Zylis      5 0.00000255 12171
## 6  2017 M     Zyrie      5 0.00000255 12171
</code></pre>
</li>
</ol>
<h4 id="combining-to-answer-more-complex-questions">Combining to answer more complex questions</h4>
<hr>
<h5 id="how-many-hadleys">How many Hadley's?</h5>
<pre><code class="language-r">
babynames %&gt;%
  filter(name == &quot;Hadley&quot;) %&gt;%
  group_by(sex) %&gt;%
  summarise(n = sum(n))
## # A tibble: 2 x 2
##   sex       n
##   &lt;chr&gt; &lt;int&gt;
## 1 F     26708
## 2 M      1883
</code></pre>
<h5 id="the-travesty">The travesty</h5>
<pre><code class="language-r">
library(ggplot2)
babynames %&gt;%
  filter(name == &quot;Hadley&quot;) %&gt;%
  ggplot(aes(year, n)) + 
    geom_line(aes(colour = sex))
</code></pre>
<p><img src="../rlang/10_00_TidyBasic01_files/figure-html/unnamed-chunk-22-1.png" width="768" /></p>

  </article><div class="collapse fs-6 pt-2" id="qnote-list">
    <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-white ">
        <span >
            
            <span class="fw-semibold">
                <button  class="btn btn-primary btn-inline" 
                   data-bs-toggle="collapse" data-bs-target="#qnote-edit"><span data-bs-toggle="tooltip" title="加入速記">加</span></button>
                <button id="qnote-gsave" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="存到硬碟"
                   onclick="qnSaveGoogle()">存</button>
                <label for="qnote-load" class="btn btn-primary btn-inline"  data-bs-toggle="tooltip" data-bs-placement="left" title="從檔案載入">載</label>   
                <input style="display:none" type="file" id="qnote-load" onchange="qnLoadGoogle(this)" />
                <button id="qnote-clear" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="清除全部速記"
                   onclick="cleanNotes()">清</button>
            </span>
        </span>
        <span class="fw-semibold collapse" id="qnote-edit"> 
            <input type="text" class="txtitle d-block w-100 h-25 " placeholder="抬頭" />
            <textarea class="txtBox  d-block w-100 h-75 " placeholder="本文"></textarea>
            
            <button id="qnote-add-item" onclick="addNote()" class="btn btn-primary">存</button> 
        </span>

    </div>
</div>

<link href="../css/quicknote.css?1635398991" rel="stylesheet">
<script src="../js/quicknote.js?1635398991"></script>
<div id="page-guide" class="bg-dark">  
  
    
          
          <a href="../rlang/1_2_filesystem.html" 
                   class="btn btn-primary" 
                   data-bs-toggle="tooltip" 
                   data-bs-placement="left" title=1.2&#32;檔案系統>前</a>
                   
          
            <a href="../rlang/11_00_sampling.html" 
               class="btn btn-primary" data-bs-toggle="tooltip" data-bs-placement="left" 
               title=11.&#32;sampling>後</a>            
          
          

  
<script src="../js/packhtml.js?1635398991"></script>    
<button class="btn btn-primary " onclick="packthis(this)"
data-bs-toggle="tooltip" data-bs-placement="left" title="打包成單一檔案">包</button>
<button class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="div#qnote-list">
  <span data-bs-toggle="tooltip" data-bs-placement="left" title="快速註記">速</span></button>
 
</div>
  </div>


  <script src="../js/featherlight.min.js?1635398991"></script>
  <script src="../js/featherlight.gallery.min.js?1635398991"></script>
  <link href="../css/featherlight.min.css?1635398991" rel="stylesheet">
  <link href="../css/featherlight.gallery.min.css?1635398991" rel="stylesheet">

  <script src="../js/highlight.pack.js?1635398991"></script>
  
  <script src="../js/hugohelper.js?1635398991"></script>

  <link href="../css/rmd.css?1635398991" rel="stylesheet">
  <link href="../css/mystyle.css?1635398991" rel="stylesheet">    
  <script src='../js/variant.js?1635398991'></script>

<script>
  
    let idxfile = "\/blogR\/index.json"  
  
</script>
<script src='../js/localsearch.js?1635398991'></script>
    


  
      
          <script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script>
      
      <script>
          mermaid.initialize({ startOnLoad: true });
      </script>
  

  <script>
    
      MathJax = {
        tex: {
          inlineMath: [['\($', '$\)'], ['\\(', '\\)']],
          displayMath: [['$$','$$']  , ['\\[','\\]']] 
        },
        svg: {
          fontCache: 'global'
        }
      };
      
      
    
      </script>
      <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
        src="https://example.com/mathjax/MathJax.js?config=TeX-AMS_CHTML">
      </script>



<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    jumpto = document.querySelector("#sidebar .active");
     if (jumpto!=null) jumpto.scrollIntoViewIfNeeded(true);
  
  });    
  
  </script>
</body>
</html>