<!DOCTYPE html>
<html><head>
  <title>10. TidyBasic01</title>  
      
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href='../images/favicon.ico'/>
      
    <script src="../js/jquery-3.3.1.min.js?1632367358"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    
    <script src='../js/datatables.min.js'></script>    
    <link href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css" rel="stylesheet">    
    
    <link href="../css/fontawesome-all.min.css?1632367358" rel="stylesheet">
    <link href="../css/atom-one-dark-reasonable.css?1632367358" rel="stylesheet">
    <link href="../css/syntax.css?1632367358" rel="stylesheet">
    
    <link href="../css/theme-mine.css?1632367358" rel="stylesheet">
    
    <link href="../css/theme.css?1632367358" rel="stylesheet">
    
    
    <link rel="stylesheet" href="../scss/notice.32c96872d0db2364b666008c0f71550ae9c2554b32a9475a28780f3696539df4.css" integrity="sha256-MsloctDbI2S2ZgCMD3FVCunCVUsyqUdaKHgPNpZTnfQ=">

    
  </head><body><div id="top-pane" class="navbar  fixed-top ">
  <div class="container-fluid">
  <span >
    <a  href='../' class="fs-5 accessory"><i class="fas fa-home"></i>R in Class</a>
    <span id="sidebar-toggle-span" class="fs-5"><i class="fas fa-align-justify"></i></span>
  </span><span >
      <span id="toc-menu">
    <label><i class="fas fa-list-alt" ></i> </label>    
<div id="variant-toc-content" >
    <div class="wrapper">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#title-tidy-basic-01">title: Tidy basic 01</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#spread-long-to-wide">spread :long to wide</a></li>
      </ul>
    </li>
    <li><a href="#dplyr">dplyr</a></li>
    <li><a href="#other">other</a>
      <ul>
        <li><a href="#basic-verbs">Basic verbs</a></li>
        <li><a href="#group-by">Group by</a></li>
        <li><a href="#summarize">summarize()</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    <hr class="p-0 m-0" />
    <div class="toa"></div>
</div>
</span>
<span class="fs-5 accessory" data-bs-toggle="tooltip" data-bs-placement="bottom" 
      title='最後修改September 16, 2021'>10. TidyBasic01</span>
        
    

    </span>
  
  <span></span><span >
    <span >
    <label for="search-query" id="search-button"><i class="fas fa-search"></i></label>
    <input id="search-query" type="search" placeholder="搜尋" autocomplete="off">
</span>    
 
<div id="search-pane">
 <ol id="search-results"></ul>
</div>

    </span>
</div> 
</div>


<div id="content-wrapper"><nav id="sidebar">

  

    
    
    <ul class="nav flex-column topics" id="home-topics">
      
        
          
          

 


<li class="nav-item" data-bs-toggle="tooltip" title="Rlangs">
     

  <a class="nav-link" 
    href="../rlang.html"><i class="far fa-folder"></i>Rlangs  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_"  
  class="submenu collapse show" 
  data-bs-parent="#home-topics"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_0_requirement.html" data-bs-toggle="tooltip" title="1 Requirement">1 Requirement</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_1_%E7%B3%BB%E7%B5%B1.html" data-bs-toggle="tooltip" title="1.1 運作環境">1.1 運作環境</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_2_filesystem.html" data-bs-toggle="tooltip" title="1.2 檔案系統">1.2 檔案系統</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/1_3_%E5%9F%B7%E8%A1%8C.html" data-bs-toggle="tooltip" title="1.3 執行">1.3 執行</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/2_1_%E8%AE%80%E6%AA%94%E5%AF%AB%E6%AA%94.html" data-bs-toggle="tooltip" title="2.1 讀檔寫檔">2.1 讀檔寫檔</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/2_2_data_explorer.html" data-bs-toggle="tooltip" title="2.2 data explorer">2.2 data explorer</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/2_3_data_explorer.html" data-bs-toggle="tooltip" title="2.3 data explorer">2.3 data explorer</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/3_quickview1.html" data-bs-toggle="tooltip" title="3. Quick view 1">3. Quick view 1</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/3_01_regular_expression.html" data-bs-toggle="tooltip" title="3.1 Regular expression syntax">3.1 Regular expression syntax</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/3_02_regular%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" title="3.02.regular練習">3.02.regular練習</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_1_1_type_basic.html" data-bs-toggle="tooltip" title="4.1.1 type basic">4.1.1 type basic</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_1_2_type%E7%B7%B4%E7%BF%92.html" data-bs-toggle="tooltip" title="4.1.2_type練習">4.1.2_type練習</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_1_3_type_list.html" data-bs-toggle="tooltip" title="4.1.3 type list">4.1.3 type list</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_1_4_type_more.html" data-bs-toggle="tooltip" title="4.1.4 type more">4.1.4 type more</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_2_type_post.html" data-bs-toggle="tooltip" title="4.2 type post">4.2 type post</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_3_a_type_matrix.html" data-bs-toggle="tooltip" title="4.3-a type matrix">4.3-a type matrix</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_3_type_matrix.html" data-bs-toggle="tooltip" title="4.3 type matrix">4.3 type matrix</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_4_type_string_function.html" data-bs-toggle="tooltip" title="4.4 type string">4.4 type string</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_4_1_json.html" data-bs-toggle="tooltip" title="4.4.1 json">4.4.1 json</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/4_5_type_vector.html" data-bs-toggle="tooltip" title="4.5 type vector">4.5 type vector</a></li>
    
  
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/6_programming_1.html" data-bs-toggle="tooltip" title="6. Programming 1">6. Programming 1</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/7_function_1.html" data-bs-toggle="tooltip" title="7 Function basic">7 Function basic</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/7_1_apply_family.html" data-bs-toggle="tooltip" title="7.1 function - apply family">7.1 function - apply family</a></li>
    
  
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/9_plot01.html" data-bs-toggle="tooltip" title="9. Plot 01">9. Plot 01</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/9_1_plot02.html" data-bs-toggle="tooltip" title="9.1 Plot more">9.1 Plot more</a></li>
    
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/11_00_sampling.html" data-bs-toggle="tooltip" title="11. sampling">11. sampling</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/11_environments.html" data-bs-toggle="tooltip" title="11 Environments">11 Environments</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/13_0_eco_01_intro.html" data-bs-toggle="tooltip" title="13. Econometrics">13. Econometrics</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/14_00_sim_1.html" data-bs-toggle="tooltip" title="14. simulation 1">14. simulation 1</a></li>
    
  
    
  <li>

 


<li class="nav-item" data-bs-toggle="tooltip" title="暫時">
     

  <a class="nav-link" 
    href="../rlang/demo.html"><i class="far fa-folder"></i>暫時  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f03d3d24b564dd9c39af6eb86300021f" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_f03d3d24b564dd9c39af6eb86300021f"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_"> 
    

  
  
  
  
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/demo/citation.html" data-bs-toggle="tooltip" title="引用">引用</a></li>
    </ul>
  

</li>   
     
  
</li>
    
  <li>

 


<li class="nav-item" data-bs-toggle="tooltip" title="練習用">
     

  <a class="nav-link" 
    href="../rlang/hw.html"><i class="far fa-folder"></i>練習用  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_b4809f6375b9dda8660e4938c2644e82" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_b4809f6375b9dda8660e4938c2644e82"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/hw_basic.html" data-bs-toggle="tooltip" title="assignment-1">assignment-1</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/hw_regexp.html" data-bs-toggle="tooltip" title="regexpr">regexpr</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/hw_filesystem.html" data-bs-toggle="tooltip" title="檔案系統">檔案系統</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/hw/dataset_class.html" data-bs-toggle="tooltip" title="資料集">資料集</a></li>
    </ul>
  

</li>   
     
  
</li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../rlang/resources.html" data-bs-toggle="tooltip" title="練習相關檔案">練習相關檔案</a></li>
    </ul>
  

</li>   
     
  

        
          
          

 


<li class="nav-item" data-bs-toggle="tooltip" title="基礎計量">
     

  <a class="nav-link" 
    href="../economics.html"><i class="far fa-folder"></i>基礎計量  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_730f0eb5dc4c58ad3a9e95566d43ba9e" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_730f0eb5dc4c58ad3a9e95566d43ba9e"  
  class="submenu collapse" 
  data-bs-parent="#home-topics"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../economics/mc_%E5%9F%BA%E6%9C%AC.html" data-bs-toggle="tooltip" title="MC_基本">MC_基本</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../economics/mpg.html" data-bs-toggle="tooltip" title="mpg">mpg</a></li>
    
  
        <li class="nav-item">
          
          <a class="nav-link" href="../economics/%E5%89%8D%E7%BD%AE.html" data-bs-toggle="tooltip" title="前置準備">前置準備</a></li>
    </ul>
  

</li>   
     
  

        
          
          

 


<li class="nav-item" data-bs-toggle="tooltip" title="專題">
     

  <a class="nav-link" 
    href="../topic.html"><i class="far fa-folder"></i>專題  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_f7b6d4231ab239a316b7f2d9edf32817" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_f7b6d4231ab239a316b7f2d9edf32817"  
  class="submenu collapse" 
  data-bs-parent="#home-topics"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/interesting.html" data-bs-toggle="tooltip" title="interesting">interesting</a></li>
    
  
    
  
    
  <li>

 


<li class="nav-item" data-bs-toggle="tooltip" title="實驗">
     

  <a class="nav-link" 
    href="../topic/experiment.html"><i class="far fa-folder"></i>實驗  </a>
    <span class="ps-1" data-bs-toggle="collapse" data-bs-target="#menu_item_0978ab1a6384269bbc2979cd5798a24f" aria-expanded="false">
      <i class="fas fa-caret-up pairicon-open"></i>
      <i class="fas fa-caret-down pairicon-close"></i>
    </span>
   
  <ul id="menu_item_0978ab1a6384269bbc2979cd5798a24f"  
  class="submenu collapse" 
  data-bs-parent="#menu_item_f7b6d4231ab239a316b7f2d9edf32817"> 
    

  
  
  
  
        <li class="nav-item">
          
          <a class="nav-link" href="../topic/experiment/central.html" data-bs-toggle="tooltip" title="中央">中央</a></li>
    </ul>
  

</li>   
     
  
</li>
    
  
    </ul>
  

</li>   
     
  

          
        
  </ul> 

    
    

    <hr/>
    <section id="footer">
      最近3篇<br/><ul><li><a href="../rlang/1_2_filesystem.html"> <i class="far fa-clock" ></i>1.2 檔案系統[2021-09-23 AM 11:21]</a></li><li><a href="../rlang/2_1_%E8%AE%80%E6%AA%94%E5%AF%AB%E6%AA%94.html"> <i class="far fa-clock" ></i>2.1 讀檔寫檔[2021-09-23 AM 12:15]</a></li><li><a href="../rlang/4_1_1_type_basic.html"> <i class="far fa-clock" ></i>4.1.1 type basic[2021-09-22 PM 10:32]</a></li></ul>
    </section>
  
</nav><article class="article mx-2 mt-3" id="body-inner">
    <pre><code class="language-r">需要安裝babynames,ggplot2
</code></pre>
<hr>
<h2 id="title-tidy-basic-01">title: Tidy basic 01</h2>
<h1 id="tidy-basic-01">Tidy Basic 01</h1>
<pre><code class="language-{r　warning=FALSE}">require(tidyr)
require(dplyr) # data_frame
</code></pre>
<p>From <a href="http://stackoverflow.com/questions/1181060">http://stackoverflow.com/questions/1181060</a></p>
<pre><code class="language-r">require(tidyr)
#&gt; 載入需要的套件：tidyr
require(dplyr) # data_frame
#&gt; 載入需要的套件：dplyr
#&gt; 
#&gt; 載入套件：'dplyr'
#&gt; 下列物件被遮斷自 'package:stats':
#&gt; 
#&gt;     filter, lag
#&gt; 下列物件被遮斷自 'package:base':
#&gt; 
#&gt;     intersect, setdiff, setequal, union
stocks &lt;- data_frame(
  time = as.Date('2009-01-01') + 0:9,
  X = rnorm(10, 0, 1),
  Y = rnorm(10, 0, 2),
  Z = rnorm(10, 0, 4)
)
#&gt; Warning: `data_frame()` was deprecated in tibble 1.1.0.
#&gt; Please use `tibble()` instead.
dset1 &lt;- head(stocks)
knitr::kable(dset1, format = &quot;html&quot;)
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> time </th>
   <th style="text-align:right;"> X </th>
   <th style="text-align:right;"> Y </th>
   <th style="text-align:right;"> Z </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2009-01-01 </td>
   <td style="text-align:right;"> 1.5516570 </td>
   <td style="text-align:right;"> -1.057305 </td>
   <td style="text-align:right;"> -0.9062304 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-02 </td>
   <td style="text-align:right;"> -0.3658073 </td>
   <td style="text-align:right;"> 1.278667 </td>
   <td style="text-align:right;"> -4.5910050 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-03 </td>
   <td style="text-align:right;"> -0.7272649 </td>
   <td style="text-align:right;"> 4.045900 </td>
   <td style="text-align:right;"> 7.1110281 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-04 </td>
   <td style="text-align:right;"> 1.0913697 </td>
   <td style="text-align:right;"> 1.297943 </td>
   <td style="text-align:right;"> 9.5256600 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-05 </td>
   <td style="text-align:right;"> 0.5851491 </td>
   <td style="text-align:right;"> -1.756840 </td>
   <td style="text-align:right;"> 7.3349250 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-06 </td>
   <td style="text-align:right;"> -1.4582033 </td>
   <td style="text-align:right;"> 0.132446 </td>
   <td style="text-align:right;"> 3.3220130 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">gather(stocks, stock, price, -time)
#&gt; # A tibble: 30 x 3
#&gt;    time       stock  price
#&gt;    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;
#&gt;  1 2009-01-01 X      1.55 
#&gt;  2 2009-01-02 X     -0.366
#&gt;  3 2009-01-03 X     -0.727
#&gt;  4 2009-01-04 X      1.09 
#&gt;  5 2009-01-05 X      0.585
#&gt;  6 2009-01-06 X     -1.46 
#&gt;  7 2009-01-07 X     -0.551
#&gt;  8 2009-01-08 X      0.333
#&gt;  9 2009-01-09 X      0.980
#&gt; 10 2009-01-10 X     -0.523
#&gt; # ... with 20 more rows
stocks %&gt;% gather(stock, price, -time)
#&gt; # A tibble: 30 x 3
#&gt;    time       stock  price
#&gt;    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;
#&gt;  1 2009-01-01 X      1.55 
#&gt;  2 2009-01-02 X     -0.366
#&gt;  3 2009-01-03 X     -0.727
#&gt;  4 2009-01-04 X      1.09 
#&gt;  5 2009-01-05 X      0.585
#&gt;  6 2009-01-06 X     -1.46 
#&gt;  7 2009-01-07 X     -0.551
#&gt;  8 2009-01-08 X      0.333
#&gt;  9 2009-01-09 X      0.980
#&gt; 10 2009-01-10 X     -0.523
#&gt; # ... with 20 more rows
dset1 &lt;- head(stocks)
knitr::kable(dset1, format = &quot;html&quot;)
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> time </th>
   <th style="text-align:right;"> X </th>
   <th style="text-align:right;"> Y </th>
   <th style="text-align:right;"> Z </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2009-01-01 </td>
   <td style="text-align:right;"> 1.5516570 </td>
   <td style="text-align:right;"> -1.057305 </td>
   <td style="text-align:right;"> -0.9062304 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-02 </td>
   <td style="text-align:right;"> -0.3658073 </td>
   <td style="text-align:right;"> 1.278667 </td>
   <td style="text-align:right;"> -4.5910050 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-03 </td>
   <td style="text-align:right;"> -0.7272649 </td>
   <td style="text-align:right;"> 4.045900 </td>
   <td style="text-align:right;"> 7.1110281 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-04 </td>
   <td style="text-align:right;"> 1.0913697 </td>
   <td style="text-align:right;"> 1.297943 </td>
   <td style="text-align:right;"> 9.5256600 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-05 </td>
   <td style="text-align:right;"> 0.5851491 </td>
   <td style="text-align:right;"> -1.756840 </td>
   <td style="text-align:right;"> 7.3349250 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-06 </td>
   <td style="text-align:right;"> -1.4582033 </td>
   <td style="text-align:right;"> 0.132446 </td>
   <td style="text-align:right;"> 3.3220130 </td>
  </tr>
</tbody>
</table>
<p>設定css</p>
<pre><code class="language-r">writeLines(&quot;td, th { padding : 6px } th { background-color : brown ; color : white; border : 1px solid white; } td { color : brown ; border : 1px solid brown }&quot;, con = &quot;tableStyle.css&quot;)
</code></pre>
<pre><code class="language-r">stocks &lt;- data_frame(
  time = as.Date('2009-01-01') + 0:9,
  X = rnorm(10, 0, 1),
  Y = rnorm(10, 0, 2),
  Z = rnorm(10, 0, 4)
)
dset1 &lt;- head(stocks)
knitr::kable(dset1, format = &quot;html&quot;)
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> time </th>
   <th style="text-align:right;"> X </th>
   <th style="text-align:right;"> Y </th>
   <th style="text-align:right;"> Z </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2009-01-01 </td>
   <td style="text-align:right;"> -0.4432398 </td>
   <td style="text-align:right;"> 3.6429839 </td>
   <td style="text-align:right;"> 8.9376297 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-02 </td>
   <td style="text-align:right;"> -1.2284601 </td>
   <td style="text-align:right;"> 0.9313461 </td>
   <td style="text-align:right;"> 1.7838838 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-03 </td>
   <td style="text-align:right;"> -1.8414540 </td>
   <td style="text-align:right;"> -1.4044010 </td>
   <td style="text-align:right;"> 4.9042674 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-04 </td>
   <td style="text-align:right;"> 1.6615898 </td>
   <td style="text-align:right;"> -2.8345610 </td>
   <td style="text-align:right;"> 3.8159852 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-05 </td>
   <td style="text-align:right;"> 1.2735337 </td>
   <td style="text-align:right;"> 1.0441848 </td>
   <td style="text-align:right;"> -2.5711460 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-06 </td>
   <td style="text-align:right;"> -1.0495124 </td>
   <td style="text-align:right;"> -2.4416584 </td>
   <td style="text-align:right;"> 0.4092309 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">
demo&lt;-gather(stocks, stock, price, -time)

dset1 &lt;- head(demo)
knitr::kable(dset1, format = &quot;html&quot;)
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> time </th>
   <th style="text-align:left;"> stock </th>
   <th style="text-align:right;"> price </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2009-01-01 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> -0.4432398 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-02 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> -1.2284601 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-03 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> -1.8414540 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-04 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> 1.6615898 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-05 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> 1.2735337 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2009-01-06 </td>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> -1.0495124 </td>
  </tr>
</tbody>
</table>
## long and wide data
### gather: wide to long
<pre><code class="language-r">wide &lt;- data_frame(
  time = as.Date('2009-01-01') + 0:9,
  X = rnorm(10, 0, 1),
  Y = rnorm(10, 0, 2),
  Z = rnorm(10, 0, 4)
)

long &lt;- gather(wide,stock,price,-time)
head(long)
#&gt; # A tibble: 6 x 3
#&gt;   time       stock  price
#&gt;   &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 2009-01-01 X      0.201
#&gt; 2 2009-01-02 X     -0.898
#&gt; 3 2009-01-03 X     -0.306
#&gt; 4 2009-01-04 X      0.738
#&gt; 5 2009-01-05 X      0.378
#&gt; 6 2009-01-06 X      1.14
</code></pre>
<h3 id="spread-long-to-wide">spread :long to wide</h3>
<pre><code class="language-r">wide2 &lt;-spread(long,stock,price)
head(wide2)
#&gt; # A tibble: 6 x 4
#&gt;   time            X      Y      Z
#&gt;   &lt;date&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 2009-01-01  0.201  0.185 -0.871
#&gt; 2 2009-01-02 -0.898  0.941 -0.862
#&gt; 3 2009-01-03 -0.306  0.750 -1.80 
#&gt; 4 2009-01-04  0.738  1.17  -1.38 
#&gt; 5 2009-01-05  0.378 -1.85   3.55 
#&gt; 6 2009-01-06  1.14  -2.68   4.11
</code></pre>
<p>更多參考:
<a href="http://www.cookbook-r.com/Manipulating_data/Converting_data_between_wide_and_long_format/">cookbook for R</a></p>
<h2 id="dplyr">dplyr</h2>
<p>函數名 功能</p>
<ul>
<li>
<p>row_number 排序,如果數值一樣,則靠前出現的元素排名在前,例如(3,3) 則 1,2</p>
</li>
<li>
<p>min_rank 排序,如果數值一樣,則都是同一等級，但是，佔用下一名次。例如</p>
</li>
</ul>
<pre><code class="language-r">data&lt;-c(3,3,4)  
data
#&gt; [1] 3 3 4
min_rank(data)
#&gt; [1] 1 1 3
</code></pre>
<ul>
<li>dense_rank 排序,如果數值一樣,則都是同一等級，但是，<code>不</code>佔用下一名次</li>
</ul>
<pre><code class="language-r">data&lt;-c(3,3,4)  
data
#&gt; [1] 3 3 4
dense_rank(data)
#&gt; [1] 1 1 2
</code></pre>
<ul>
<li>
<p>percent_rank 按百分比的排名<br>
percent_rank = (min_rank(x) - 1)/(sum(!is.na(x)) - 1)</p>
</li>
<li>
<p>cume_dist 累計分佈</p>
</li>
<li>
<p>ntile : floor(n * (row_number(x) - 1)/len + 1)</p>
</li>
</ul>
<pre><code class="language-r">data&lt;-round(runif(10)*10)
pr&lt;-percent_rank(data)
cd&lt;-cume_dist(data)
mr&lt;-min_rank(data)
df&lt;-data.frame(data,pr,mr,cd)
arrange(df,data)
#&gt;    data        pr mr  cd
#&gt; 1     1 0.0000000  1 0.1
#&gt; 2     3 0.1111111  2 0.5
#&gt; 3     3 0.1111111  2 0.5
#&gt; 4     3 0.1111111  2 0.5
#&gt; 5     3 0.1111111  2 0.5
#&gt; 6     5 0.5555556  6 0.7
#&gt; 7     5 0.5555556  6 0.7
#&gt; 8     6 0.7777778  8 0.8
#&gt; 9     9 0.8888889  9 0.9
#&gt; 10   10 1.0000000 10 1.0
</code></pre>
<p>note:</p>
<p>(2,3,3,3,3,4,5,6,6,9)</p>
<table>
<thead>
<tr>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>4</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>::: sidebar</p>
<p>arrange(dataframe, col1, col2, col3)<br>
vs.<br>
dataframe[order(dataframe$col1, dataframe$col2, dataframe$col3), ]
vs.<br>
with(dataframe, dataframe[order(col1, col2, col3), ])<br>
:::</p>
<p>::: sidebar
想要由大到小,例如分數等級</p>
<pre><code class="language-r">data
#&gt;  [1]  3  3  5 10  6  9  5  3  3  1
row_number(desc(data))
#&gt;  [1]  6  7  4  1  3  2  5  8  9 10
</code></pre>
<p>:::</p>
<p>::: sidebar 
Percentile
The nth percentile of an observation variable is the value that cuts off the first n percent of the data values when it is sorted in ascending order.</p>
<p>Problem
Find the 32nd, 57th and 98th percentiles of runiform(200).</p>
<pre><code class="language-r">data&lt;-runif(200) 
quantile(data, c(.32, .57, .98)) 

</code></pre>
<p>:::</p>
<h2 id="other">other</h2>
<pre><code class="language-r">library(babynames)
babynames
#&gt; # A tibble: 1,924,665 x 5
#&gt;     year sex   name          n   prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;
#&gt;  1  1880 F     Mary       7065 0.0724
#&gt;  2  1880 F     Anna       2604 0.0267
#&gt;  3  1880 F     Emma       2003 0.0205
#&gt;  4  1880 F     Elizabeth  1939 0.0199
#&gt;  5  1880 F     Minnie     1746 0.0179
#&gt;  6  1880 F     Margaret   1578 0.0162
#&gt;  7  1880 F     Ida        1472 0.0151
#&gt;  8  1880 F     Alice      1414 0.0145
#&gt;  9  1880 F     Bertha     1320 0.0135
#&gt; 10  1880 F     Sarah      1288 0.0132
#&gt; # ... with 1,924,655 more rows
</code></pre>
<h3 id="basic-verbs">Basic verbs</h3>
<pre><code class="language-r">babynames %&gt;% select(-prop)
#&gt; # A tibble: 1,924,665 x 4
#&gt;     year sex   name          n
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;
#&gt;  1  1880 F     Mary       7065
#&gt;  2  1880 F     Anna       2604
#&gt;  3  1880 F     Emma       2003
#&gt;  4  1880 F     Elizabeth  1939
#&gt;  5  1880 F     Minnie     1746
#&gt;  6  1880 F     Margaret   1578
#&gt;  7  1880 F     Ida        1472
#&gt;  8  1880 F     Alice      1414
#&gt;  9  1880 F     Bertha     1320
#&gt; 10  1880 F     Sarah      1288
#&gt; # ... with 1,924,655 more rows
babynames %&gt;% select(year:n)
#&gt; # A tibble: 1,924,665 x 4
#&gt;     year sex   name          n
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;
#&gt;  1  1880 F     Mary       7065
#&gt;  2  1880 F     Anna       2604
#&gt;  3  1880 F     Emma       2003
#&gt;  4  1880 F     Elizabeth  1939
#&gt;  5  1880 F     Minnie     1746
#&gt;  6  1880 F     Margaret   1578
#&gt;  7  1880 F     Ida        1472
#&gt;  8  1880 F     Alice      1414
#&gt;  9  1880 F     Bertha     1320
#&gt; 10  1880 F     Sarah      1288
#&gt; # ... with 1,924,655 more rows
# starts_with(), ends_with(), contains()

babynames %&gt;% filter(name == &quot;Hadley&quot;)
#&gt; # A tibble: 163 x 5
#&gt;     year sex   name       n      prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;     &lt;dbl&gt;
#&gt;  1  1906 M     Hadley     6 0.0000416
#&gt;  2  1908 M     Hadley    16 0.0000962
#&gt;  3  1909 M     Hadley    14 0.0000792
#&gt;  4  1910 M     Hadley     5 0.0000240
#&gt;  5  1911 M     Hadley     9 0.0000373
#&gt;  6  1912 M     Hadley    11 0.0000244
#&gt;  7  1913 M     Hadley    10 0.0000186
#&gt;  8  1914 M     Hadley    15 0.0000220
#&gt;  9  1915 M     Hadley    14 0.0000159
#&gt; 10  1916 M     Hadley    14 0.0000152
#&gt; # ... with 153 more rows
babynames %&gt;% filter(year == 1900, sex == &quot;F&quot;)
#&gt; # A tibble: 2,224 x 5
#&gt;     year sex   name          n   prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;
#&gt;  1  1900 F     Mary      16706 0.0526
#&gt;  2  1900 F     Helen      6343 0.0200
#&gt;  3  1900 F     Anna       6114 0.0192
#&gt;  4  1900 F     Margaret   5304 0.0167
#&gt;  5  1900 F     Ruth       4765 0.0150
#&gt;  6  1900 F     Elizabeth  4096 0.0129
#&gt;  7  1900 F     Florence   3920 0.0123
#&gt;  8  1900 F     Ethel      3896 0.0123
#&gt;  9  1900 F     Marie      3856 0.0121
#&gt; 10  1900 F     Lillian    3414 0.0107
#&gt; # ... with 2,214 more rows
babynames %&gt;% filter(year == 2013, sex == &quot;F&quot;)
#&gt; # A tibble: 19,231 x 5
#&gt;     year sex   name          n    prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;
#&gt;  1  2013 F     Sophia    21213 0.0110 
#&gt;  2  2013 F     Emma      20936 0.0109 
#&gt;  3  2013 F     Olivia    18414 0.00957
#&gt;  4  2013 F     Isabella  17631 0.00916
#&gt;  5  2013 F     Ava       15249 0.00793
#&gt;  6  2013 F     Mia       13147 0.00683
#&gt;  7  2013 F     Emily     13124 0.00682
#&gt;  8  2013 F     Abigail   12405 0.00645
#&gt;  9  2013 F     Madison   10591 0.00551
#&gt; 10  2013 F     Elizabeth  9448 0.00491
#&gt; # ... with 19,221 more rows

babynames %&gt;%
  mutate(
    first = tolower(substr(name, 1, 1)),
    last = substr(name, nchar(name), nchar(name))
  )
#&gt; # A tibble: 1,924,665 x 7
#&gt;     year sex   name          n   prop first last 
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
#&gt;  1  1880 F     Mary       7065 0.0724 m     y    
#&gt;  2  1880 F     Anna       2604 0.0267 a     a    
#&gt;  3  1880 F     Emma       2003 0.0205 e     a    
#&gt;  4  1880 F     Elizabeth  1939 0.0199 e     h    
#&gt;  5  1880 F     Minnie     1746 0.0179 m     e    
#&gt;  6  1880 F     Margaret   1578 0.0162 m     t    
#&gt;  7  1880 F     Ida        1472 0.0151 i     a    
#&gt;  8  1880 F     Alice      1414 0.0145 a     e    
#&gt;  9  1880 F     Bertha     1320 0.0135 b     a    
#&gt; 10  1880 F     Sarah      1288 0.0132 s     h    
#&gt; # ... with 1,924,655 more rows

babynames %&gt;%
  arrange(desc(prop))
#&gt; # A tibble: 1,924,665 x 5
#&gt;     year sex   name        n   prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt;
#&gt;  1  1880 M     John     9655 0.0815
#&gt;  2  1881 M     John     8769 0.0810
#&gt;  3  1880 M     William  9532 0.0805
#&gt;  4  1883 M     John     8894 0.0791
#&gt;  5  1881 M     William  8524 0.0787
#&gt;  6  1882 M     John     9557 0.0783
#&gt;  7  1884 M     John     9388 0.0765
#&gt;  8  1882 M     William  9298 0.0762
#&gt;  9  1886 M     John     9026 0.0758
#&gt; 10  1885 M     John     8756 0.0755
#&gt; # ... with 1,924,655 more rows

babynames %&gt;%
  summarise(n = sum(n))
#&gt; # A tibble: 1 x 1
#&gt;           n
#&gt;       &lt;int&gt;
#&gt; 1 348120517
</code></pre>
<h3 id="group-by">Group by</h3>
<p>分組指令不會影響到原來的資料</p>
<pre><code class="language-r">head(mtcars)
#&gt;                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
#&gt; Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
#&gt; Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
#&gt; Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
#&gt; Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
#&gt; Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
#&gt; Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
str(mtcars)
#&gt; 'data.frame':	32 obs. of  11 variables:
#&gt;  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
#&gt;  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
#&gt;  $ disp: num  160 160 108 258 360 ...
#&gt;  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
#&gt;  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
#&gt;  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
#&gt;  $ qsec: num  16.5 17 18.6 19.4 17 ...
#&gt;  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
#&gt;  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
#&gt;  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
#&gt;  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...
by_cyl &lt;- mtcars %&gt;% group_by(cyl)
head(by_cyl)
#&gt; # A tibble: 6 x 11
#&gt; # Groups:   cyl [3]
#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1  21       6   160   110  3.9   2.62  16.5     0     1     4     4
#&gt; 2  21       6   160   110  3.9   2.88  17.0     0     1     4     4
#&gt; 3  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1
#&gt; 4  21.4     6   258   110  3.08  3.22  19.4     1     0     3     1
#&gt; 5  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2
#&gt; 6  18.1     6   225   105  2.76  3.46  20.2     1     0     3     1
str(by_cyl)
#&gt; grouped_df [32 x 11] (S3: grouped_df/tbl_df/tbl/data.frame)
#&gt;  $ mpg : num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
#&gt;  $ cyl : num [1:32] 6 6 4 6 8 6 8 4 4 6 ...
#&gt;  $ disp: num [1:32] 160 160 108 258 360 ...
#&gt;  $ hp  : num [1:32] 110 110 93 110 175 105 245 62 95 123 ...
#&gt;  $ drat: num [1:32] 3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
#&gt;  $ wt  : num [1:32] 2.62 2.88 2.32 3.21 3.44 ...
#&gt;  $ qsec: num [1:32] 16.5 17 18.6 19.4 17 ...
#&gt;  $ vs  : num [1:32] 0 0 1 1 0 1 0 1 1 1 ...
#&gt;  $ am  : num [1:32] 1 1 1 0 0 0 0 0 0 0 ...
#&gt;  $ gear: num [1:32] 4 4 4 3 3 3 3 4 4 4 ...
#&gt;  $ carb: num [1:32] 4 4 1 1 2 1 4 2 2 4 ...
#&gt;  - attr(*, &quot;groups&quot;)= tibble [3 x 2] (S3: tbl_df/tbl/data.frame)
#&gt;   ..$ cyl  : num [1:3] 4 6 8
#&gt;   ..$ .rows: list&lt;int&gt; [1:3] 
#&gt;   .. ..$ : int [1:11] 3 8 9 18 19 20 21 26 27 28 ...
#&gt;   .. ..$ : int [1:7] 1 2 4 6 10 11 30
#&gt;   .. ..$ : int [1:14] 5 7 12 13 14 15 16 17 22 23 ...
#&gt;   .. ..@ ptype: int(0) 
#&gt;   ..- attr(*, &quot;.drop&quot;)= logi TRUE
</code></pre>
<p>但是分組結果會影響其他dplyr指令的計算結果:</p>
<pre><code class="language-r">by_cyl %&gt;% summarise(
  disp = mean(disp),
  hp = mean(hp)
)
#&gt; # A tibble: 3 x 3
#&gt;     cyl  disp    hp
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     4  105.  82.6
#&gt; 2     6  183. 122. 
#&gt; 3     8  353. 209.
by_cyl %&gt;% filter(disp == max(disp))
#&gt; # A tibble: 3 x 11
#&gt; # Groups:   cyl [3]
#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
#&gt; 2  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
#&gt; 3  10.4     8  472    205  2.93  5.25  18.0     0     0     3     4
</code></pre>
<h3 id="summarize">summarize()</h3>
<p>What other summary functions can we use inside the summarize() verb? Any function in R that takes a vector of values and returns just one. Here are just a few:</p>
<p>mean(): the mean AKA the average<br>
sd(): the standard deviation, which is a measure of spread<br>
min() and max(): the minimum and maximum values respectively<br>
IQR(): Interquartile range<br>
sum(): the sum<br>
n(): a count of the number of rows/observations in each group. This particular summary function will make more sense when group_by() is covered in Section 5.5.</p>
<h4 id="實驗-pipeline-vs-no-pipeline">實驗 pipeline vs no pipeline</h4>
<p>產生資料</p>
<pre><code class="language-r">year=c(1990,	1991,	1990,	1991,	1990,	1991,	1990,	1991,	1990,	1991) 
sex=c(&quot;f&quot;,	&quot;f&quot;,	&quot;f&quot;,	&quot;f&quot;,	&quot;f&quot;,	&quot;m&quot;,	&quot;m&quot;,	&quot;m&quot;,	&quot;m&quot;,	&quot;m&quot;)
#value=c(1,	2,	3,	4,	5,	1,	2,	3,	4,	5)
value=c(1,	2,	3,	4,	5,	6,	7,	8,	9,	10)
df&lt;-data.frame(sex,year,value)
head(df)
#&gt;   sex year value
#&gt; 1   f 1990     1
#&gt; 2   f 1991     2
#&gt; 3   f 1990     3
#&gt; 4   f 1991     4
#&gt; 5   f 1990     5
#&gt; 6   m 1991     6
</code></pre>
<h4 id="不用-pipeline">不用 pipeline</h4>
<pre><code class="language-r">
df&lt;-group_by(df,sex)
ndf&lt;-mutate(df,rank=min_rank(value))
arrange(ndf,sex)
#&gt; # A tibble: 10 x 4
#&gt; # Groups:   sex [2]
#&gt;    sex    year value  rank
#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
#&gt;  1 f      1990     1     1
#&gt;  2 f      1991     2     2
#&gt;  3 f      1990     3     3
#&gt;  4 f      1991     4     4
#&gt;  5 f      1990     5     5
#&gt;  6 m      1991     6     1
#&gt;  7 m      1990     7     2
#&gt;  8 m      1991     8     3
#&gt;  9 m      1990     9     4
#&gt; 10 m      1991    10     5
</code></pre>
<h4 id="使用-pipeline">使用 pipeline</h4>
<pre><code class="language-r">ndf&lt;-df %&gt;%
  group_by(sex) %&gt;%
  mutate(rank = min_rank(value)) 

arrange(ndf,sex)
#&gt; # A tibble: 10 x 4
#&gt; # Groups:   sex [2]
#&gt;    sex    year value  rank
#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
#&gt;  1 f      1990     1     1
#&gt;  2 f      1991     2     2
#&gt;  3 f      1990     3     3
#&gt;  4 f      1991     4     4
#&gt;  5 f      1990     5     5
#&gt;  6 m      1991     6     1
#&gt;  7 m      1990     7     2
#&gt;  8 m      1991     8     3
#&gt;  9 m      1990     9     4
#&gt; 10 m      1991    10     5
</code></pre>
<p>問題:</p>
<ol>
<li>如何知道min-rank(value)中的value 是全局或是欄位?
hint: rm(value)</li>
<li>會出現甚麼結果</li>
</ol>
<p>df %&gt;%
group_by(sex) %&gt;%str()</p>
<pre><code class="language-r">nb &lt;-babynames %&gt;%
  group_by(name)
</code></pre>
<pre><code class="language-r">
babynames %&gt;%
  group_by(name) %&gt;%
  summarise(n = sum(n))
#&gt; # A tibble: 97,310 x 2
#&gt;    name          n
#&gt;    &lt;chr&gt;     &lt;int&gt;
#&gt;  1 Aaban       107
#&gt;  2 Aabha        35
#&gt;  3 Aabid        10
#&gt;  4 Aabir         5
#&gt;  5 Aabriella    32
#&gt;  6 Aada          5
#&gt;  7 Aadam       254
#&gt;  8 Aadan       130
#&gt;  9 Aadarsh     199
#&gt; 10 Aaden      4658
#&gt; # ... with 97,300 more rows
  
babynames %&gt;%
  filter(name %in% c(&quot;John&quot;, &quot;Mary&quot;, &quot;William&quot;)) %&gt;%
  group_by(name, sex) %&gt;%
  summarise(n = sum(n))
#&gt; `summarise()` has grouped output by 'name'. You can override using the `.groups` argument.
#&gt; # A tibble: 6 x 3
#&gt; # Groups:   name [3]
#&gt;   name    sex         n
#&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;
#&gt; 1 John    F       21676
#&gt; 2 John    M     5115466
#&gt; 3 Mary    F     4123200
#&gt; 4 Mary    M       15160
#&gt; 5 William F       15949
#&gt; 6 William M     4102604

babynames %&gt;%
  group_by(year, sex) %&gt;%
  mutate(rank = min_rank(desc(n))) %&gt;%
  tail()
#&gt; # A tibble: 6 x 6
#&gt; # Groups:   year, sex [1]
#&gt;    year sex   name       n       prop  rank
#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;      &lt;dbl&gt; &lt;int&gt;
#&gt; 1  2017 M     Zyhier     5 0.00000255 12171
#&gt; 2  2017 M     Zykai      5 0.00000255 12171
#&gt; 3  2017 M     Zykeem     5 0.00000255 12171
#&gt; 4  2017 M     Zylin      5 0.00000255 12171
#&gt; 5  2017 M     Zylis      5 0.00000255 12171
#&gt; 6  2017 M     Zyrie      5 0.00000255 12171
</code></pre>
<h4 id="combining-to-answer-more-complex-questions">Combining to answer more complex questions</h4>
<hr>
<h5 id="how-many-hadleys">How many Hadley's?</h5>
<pre><code class="language-r">
babynames %&gt;%
  filter(name == &quot;Hadley&quot;) %&gt;%
  group_by(sex) %&gt;%
  summarise(n = sum(n))
#&gt; # A tibble: 2 x 2
#&gt;   sex       n
#&gt;   &lt;chr&gt; &lt;int&gt;
#&gt; 1 F     26708
#&gt; 2 M      1883
</code></pre>
<h5 id="the-travesty">The travesty</h5>
<pre><code class="language-r">
library(ggplot2)
babynames %&gt;%
  filter(name == &quot;Hadley&quot;) %&gt;%
  ggplot(aes(year, n)) + 
    geom_line(aes(colour = sex))
</code></pre>
<p><img src="../rlang/10_00_TidyBasic01_files/figure-html/unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;" /></p>

  </article><div class="collapse fs-6 pt-2" id="qnote-list">
    <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-white ">
        <span >
            
            <span class="fw-semibold">
                <button  class="btn btn-primary btn-inline" 
                   data-bs-toggle="collapse" data-bs-target="#qnote-edit"><span data-bs-toggle="tooltip" title="加入速記">加</span></button>
                <button id="qnote-gsave" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="存到硬碟"
                   onclick="qnSaveGoogle()">存</button>
                <label for="qnote-load" class="btn btn-primary btn-inline"  data-bs-toggle="tooltip" data-bs-placement="left" title="從檔案載入">載</label>   
                <input style="display:none" type="file" id="qnote-load" onchange="qnLoadGoogle(this)" />
                <button id="qnote-clear" class="btn btn-primary btn-inline" 
                   data-bs-toggle="tooltip" data-bs-placement="left" title="清除全部速記"
                   onclick="cleanNotes()">清</button>
            </span>
        </span>
        <span class="fw-semibold collapse" id="qnote-edit"> 
            <input type="text" class="txtitle d-block w-100 h-25 " placeholder="抬頭" />
            <textarea class="txtBox  d-block w-100 h-75 " placeholder="本文"></textarea>
            
            <button id="qnote-add-item" onclick="addNote()" class="btn btn-primary">存</button> 
        </span>

    </div>
</div>

<link href="../css/quicknote.css?1632367358" rel="stylesheet">
<script src="../js/quicknote.js?1632367358"></script>
<div id="page-guide" class="bg-dark">  
  
    
          
          <a href="../rlang/9_plot01.html" 
                   class="btn btn-primary" 
                   data-bs-toggle="tooltip" 
                   data-bs-placement="left" title=9.&#32;Plot&#32;01>前</a>
                   
          
            <a href="../rlang/11_00_sampling.html" 
               class="btn btn-primary" data-bs-toggle="tooltip" data-bs-placement="left" 
               title=11.&#32;sampling>後</a>            
          
          

  
<script src="../js/packhtml.js?1632367358"></script>    
<button class="btn btn-primary " onclick="packthis(this)"
data-bs-toggle="tooltip" data-bs-placement="left" title="打包成單一檔案">包</button>
<button class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="div#qnote-list">
  <span data-bs-toggle="tooltip" data-bs-placement="left" title="快速註記">速</span></button>
 
</div>
  </div>


  <script src="../js/featherlight.min.js?1632367358"></script>
  <script src="../js/featherlight.gallery.min.js?1632367358"></script>
  <link href="../css/featherlight.min.css?1632367358" rel="stylesheet">
  <link href="../css/featherlight.gallery.min.css?1632367358" rel="stylesheet">

  <script src="../js/highlight.pack.js?1632367358"></script>
  
  <script src="../js/hugohelper.js?1632367358"></script>

  <link href="../css/rmd.css?1632367358" rel="stylesheet">
  <link href="../css/mystyle.css?1632367358" rel="stylesheet">    
  <script src='../js/variant.js?1632367358'></script>

<script>
let idxfile = "\/index.json"  
</script>
<script src='../js/localsearch.js?1632367358'></script>
    


  
      
          <script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script>
      
      <script>
          mermaid.initialize({ startOnLoad: true });
      </script>
  

  <script>
    
      MathJax = {
        tex: {
          inlineMath: [['\($', '$\)'], ['\\(', '\\)']],
          displayMath: [['$$','$$']]  
        },
        svg: {
          fontCache: 'global'
        }
      };
    
      </script>
      <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
      </script>



<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    jumpto = document.querySelector("#sidebar .active");
     if (jumpto!=null) jumpto.scrollIntoViewIfNeeded(true);
  
  });    
  
  </script>
</body>
</html>